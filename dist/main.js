/*
Task Consolidator v2.0.0
Obsidian Plugin for consolidated task management
*/

var We=Object.defineProperty;var Ft=Object.getOwnPropertyDescriptor;var Vt=Object.getOwnPropertyNames;var Bt=Object.prototype.hasOwnProperty;var Ut=(c,s)=>{for(var e in s)We(c,e,{get:s[e],enumerable:!0})},Ht=(c,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of Vt(s))!Bt.call(c,i)&&i!==e&&We(c,i,{get:()=>s[i],enumerable:!(t=Ft(s,i))||t.enumerable});return c};var _t=c=>Ht(We({},"__esModule",{value:!0}),c);var as={};Ut(as,{default:()=>Ye});module.exports=_t(as);var M=require("obsidian");var A=["Requested","Staged","In-Progress","In-Review","Completed"],H=["high","medium","low"],ut=["daily","weekly","monthly","yearly","custom"],ie=[{id:"unassigned",title:"Unassigned",stage:null},{id:"requested",title:"Requested",stage:"Requested"},{id:"staged",title:"Staged",stage:"Staged"},{id:"in-progress",title:"In-Progress",stage:"In-Progress"},{id:"in-review",title:"In-Review",stage:"In-Review"},{id:"completed",title:"Completed",stage:"Completed"}],ve=["dueDate","owner","priority","project","created","stage"],ye=["none","dueDate","owner","project","stage","priority"],pt=["YYYY-MM-DD","MM/DD/YYYY","DD-MM-YYYY","locale"],ht=["full","filename","hidden"],gt=["panel","kanban","calendar"],K="task-consolidator-view",ae=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],re=["sun","mon","tue","wed","thu","fri","sat"],X=["january","february","march","april","may","june","july","august","september","october","november","december"],ft=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],J={MAX_TASK_TEXT_LENGTH:1e3,MAX_OWNER_LENGTH:50,MAX_PROJECT_LENGTH:100,MAX_TAG_LENGTH:50,MAX_TAGS_COUNT:20,MAX_LINE_LENGTH:2e3},x={TASK_LINE:/^(\s*)-\s+\[([ xX])\]\s+(.+)$/,METADATA:/^\*\*(.+?):\*\*\s*(.*)$/,DATE:/^\d{4}-\d{2}-\d{2}$/,DATE_WITH_PREFIX:/^(?:Due\s+)?(\d{4}-\d{2}-\d{2})$/i,COMPLETED_DATE:/\s*\[done:(\d{4}-\d{2}-\d{2})\]\s*$/,CREATED_DATE:/\s*\[created:(\d{4}-\d{2}-\d{2})\]\s*$/,PRIORITY:/\[priority:(high|medium|low)\]/i,RECURRENCE:/\[repeat:([^\]]+)\]/i,TAGS:/#([\w\-_]+)/g,QUICK_OWNER:/@([\w\s\-.']+?)(?=\s+[#!@]|\s*$)/,QUICK_PROJECT:/^#([\w\-_]+)/,QUICK_DATE:/!([\w\-/]+)/,BLOCKED_BY:/\[blocked-by:([^\]]+)\]/gi,BLOCKS:/\[blocks:([^\]]+)\]/gi,ESTIMATE:/\[estimate:([^\]]+)\]/i,TIME_LOGGED:/\[logged:([^\]]+)\]/i},P={OWNER:/@([\w\s\-.']+?)(?=\s+[@#!^+]|\s*$)/,PROJECT:/\s#([\w\-_]+)(?=\s|$)/,DATE:/!([\w\-/\s]+?)(?=\s+[@#!^+]|\s*$)/,PRIORITY:/\^(high|med|medium|low|h|m|l)/i,TAG:/\+([\w\-_]+)/g},F={ENTER:"Enter",SPACE:" ",ESCAPE:"Escape",TAB:"Tab",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",HOME:"Home",END:"End",DELETE:"Delete",BACKSPACE:"Backspace",QUESTION_MARK:"?",SLASH:"/"},ne={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"},mt={none:"\u{1F4CC}",dueDate:"\u{1F4C5}",owner:"\u{1F464}",project:"\u{1F4C1}",stage:"\u{1F4CB}",priority:"\u26A1"};var U={sortBy:"dueDate",groupBy:"dueDate",showCompleted:!0,completedTasksLimit:0,dateFormat:"YYYY-MM-DD",firstDayOfWeek:0,defaultView:"panel",requireMetadataFormat:!1,metadataDelimiter:"|",customStages:[],excludedFolders:[],excludedPatterns:[],autoRefresh:!0,refreshDebounceMs:300,parentCompletionBehavior:"manual",confirmDestructiveActions:!0,recurringAutoCreate:!0,recurringCreateDaysBefore:1,compactMode:!1,showFilePath:"filename",taskCountInRibbon:!1,showOverdueIndicator:!0,showDueTodayIndicator:!0,defaultTargetFile:"",quickAddHotkey:"Ctrl+Shift+T",defaultOwner:"",defaultProject:"",filterOwner:"",filterDueDate:"",filterProject:"",filterPriority:"",filterStage:"",filterTags:[],searchQuery:"",collapsedGroups:{},kanbanFilterProject:"",debugMode:!1,maxTasksToRender:0,enableVirtualScrolling:!0,enableTaskCache:!0,enableDailyNoteIntegration:!0,dailyNoteFolder:"",dailyNoteDateFormat:"YYYY-MM-DD",dailyNoteTasksHeading:"## Tasks",autoLinkTasksToDailyNote:!1,showDailyNoteButton:!0,enableNotifications:!0,notifyOnStartup:!0,notifyOverdueTasks:!0,notifyDueToday:!0,notifyUpcoming:!0,upcomingDays:3,reminderCheckIntervalMinutes:30,showNotificationBadge:!0,lastNotificationCheck:0,enableTimeTracking:!0,taskTemplates:[],savedFilters:[],enableComments:!0,workspaces:[],activeWorkspaceId:"",enableSmartSuggestions:!0};function kt(c){var s,e,t,i,a,r,o,n;return{...U,...c,customStages:(s=c.customStages)!=null?s:U.customStages,excludedFolders:(e=c.excludedFolders)!=null?e:U.excludedFolders,excludedPatterns:(t=c.excludedPatterns)!=null?t:U.excludedPatterns,filterTags:(i=c.filterTags)!=null?i:U.filterTags,collapsedGroups:(a=c.collapsedGroups)!=null?a:U.collapsedGroups,taskTemplates:(r=c.taskTemplates)!=null?r:U.taskTemplates,savedFilters:(o=c.savedFilters)!=null?o:U.savedFilters,workspaces:(n=c.workspaces)!=null?n:U.workspaces}}var f=require("obsidian");var Yt=/[.*+?^${}()|[\]\\]/g,Wt=/\*\*/g;function Tt(c){return c.replace(Yt,"\\$&")}function vt(c){return c.replace(Wt,"").replace(/\|/g,"-").replace(/:/g,"-").replace(/\[/g,"(").replace(/\]/g,")").replace(/\n/g," ").replace(/\r/g,"").trim()}function Ge(c){return c&&vt(c).replace(/<[^>]*>/g,"").replace(/[^\w\s\-.']/gu,"").substring(0,50).trim()||null}function Ke(c){return c&&vt(c).replace(/[^\w\s\-_]/gu,"").substring(0,100).trim()||null}function qe(c){return c.replace(/\n/g," ").replace(/\r/g,"").replace(/\t/g," ").replace(/\s+/g," ").substring(0,1e3).trim()}function yt(c){let s=c.replace(/\t/g,"  ").length;return Math.floor(s/2)}function q(c){return c.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,s=>s.toUpperCase()).trim()}function oe(c,s){return c===null&&s===null?0:c===null?1:s===null?-1:c.localeCompare(s)}function Dt(c){if(!c.children||c.children.length===0)return null;let s=c.children.length;return{completed:c.children.filter(t=>t.completed).length,total:s}}var De=class extends f.PluginSettingTab{constructor(s,e){super(s,e),this.plugin=e}display(){let{containerEl:s}=this;s.empty(),s.createEl("h1",{text:"Task Consolidator Settings"}),this.renderDisplaySection(s),this.renderDetectionSection(s),this.renderBehaviorSection(s),this.renderRecurringSection(s),this.renderAppearanceSection(s),this.renderQuickAddSection(s),this.renderDailyNoteSection(s),this.renderNotificationSection(s),this.renderFeaturesSection(s),this.renderAdvancedSection(s),this.renderResetSection(s)}renderDisplaySection(s){s.createEl("h2",{text:"Display"}),new f.Setting(s).setName("Default Sort Order").setDesc("How tasks should be sorted by default").addDropdown(e=>{for(let t of ve)e.addOption(t,q(t));e.setValue(this.plugin.settings.sortBy),e.onChange(async t=>{this.plugin.settings.sortBy=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Default Group By").setDesc("How tasks should be grouped by default").addDropdown(e=>{for(let t of ye)e.addOption(t,q(t));e.setValue(this.plugin.settings.groupBy),e.onChange(async t=>{this.plugin.settings.groupBy=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Completed Tasks").setDesc("Show the completed tasks section by default").addToggle(e=>{e.setValue(this.plugin.settings.showCompleted),e.onChange(async t=>{this.plugin.settings.showCompleted=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Completed Tasks Limit").setDesc("Limit completed tasks display (0 = unlimited, or last N days)").addText(e=>{e.setValue(String(this.plugin.settings.completedTasksLimit)),e.setPlaceholder("0"),e.onChange(async t=>{let i=parseInt(t,10);this.plugin.settings.completedTasksLimit=isNaN(i)?0:Math.max(0,i),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Date Format").setDesc("Format for displaying dates").addDropdown(e=>{for(let t of pt)e.addOption(t,t);e.setValue(this.plugin.settings.dateFormat),e.onChange(async t=>{this.plugin.settings.dateFormat=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("First Day of Week").setDesc("Which day starts the week").addDropdown(e=>{e.addOption("0","Sunday"),e.addOption("1","Monday"),e.setValue(String(this.plugin.settings.firstDayOfWeek)),e.onChange(async t=>{this.plugin.settings.firstDayOfWeek=parseInt(t,10),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Default View").setDesc("Default view when opening Task Consolidator").addDropdown(e=>{for(let t of gt)e.addOption(t,q(t));e.setValue(this.plugin.settings.defaultView),e.onChange(async t=>{this.plugin.settings.defaultView=t,await this.plugin.saveSettings()})})}renderDetectionSection(s){s.createEl("h2",{text:"Task Detection"}),new f.Setting(s).setName("Require Metadata Format").setDesc("Only detect tasks with **metadata:** format").addToggle(e=>{e.setValue(this.plugin.settings.requireMetadataFormat),e.onChange(async t=>{this.plugin.settings.requireMetadataFormat=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Metadata Delimiter").setDesc("Character used to separate metadata fields (default: |)").addText(e=>{e.setValue(this.plugin.settings.metadataDelimiter),e.setPlaceholder("|"),e.onChange(async t=>{this.plugin.settings.metadataDelimiter=t||"|",await this.plugin.saveSettings()})}),new f.Setting(s).setName("Custom Stages").setDesc("Additional workflow stages (comma-separated)").addText(e=>{e.setValue(this.plugin.settings.customStages.join(", ")),e.setPlaceholder("Review, QA, Deploy"),e.onChange(async t=>{this.plugin.settings.customStages=t.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Excluded Folders").setDesc("Folders to exclude from task scanning (comma-separated)").addText(e=>{e.setValue(this.plugin.settings.excludedFolders.join(", ")),e.setPlaceholder("Templates, Archive"),e.onChange(async t=>{this.plugin.settings.excludedFolders=t.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Excluded Patterns").setDesc("File patterns to exclude (glob format, comma-separated)").addText(e=>{e.setValue(this.plugin.settings.excludedPatterns.join(", ")),e.setPlaceholder("*.template.md, _*"),e.onChange(async t=>{this.plugin.settings.excludedPatterns=t.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()})})}renderBehaviorSection(s){s.createEl("h2",{text:"Behavior"}),new f.Setting(s).setName("Auto Refresh").setDesc("Automatically refresh tasks when files change").addToggle(e=>{e.setValue(this.plugin.settings.autoRefresh),e.onChange(async t=>{this.plugin.settings.autoRefresh=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Refresh Debounce (ms)").setDesc("Delay before refreshing after file change").addText(e=>{e.setValue(String(this.plugin.settings.refreshDebounceMs)),e.setPlaceholder("300"),e.onChange(async t=>{let i=parseInt(t,10);this.plugin.settings.refreshDebounceMs=isNaN(i)?300:Math.max(100,i),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Parent Task Completion").setDesc("How completing a parent task affects children").addDropdown(e=>{e.addOption("manual","Manual - No automatic behavior"),e.addOption("auto","Auto - Complete parent when all children done"),e.addOption("cascade","Cascade - Complete children when parent done"),e.setValue(this.plugin.settings.parentCompletionBehavior),e.onChange(async t=>{this.plugin.settings.parentCompletionBehavior=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Confirm Destructive Actions").setDesc("Show confirmation dialogs for bulk delete operations").addToggle(e=>{e.setValue(this.plugin.settings.confirmDestructiveActions),e.onChange(async t=>{this.plugin.settings.confirmDestructiveActions=t,await this.plugin.saveSettings()})})}renderRecurringSection(s){s.createEl("h2",{text:"Recurring Tasks"}),new f.Setting(s).setName("Auto-Create Next Occurrence").setDesc("Automatically create next occurrence when completing recurring task").addToggle(e=>{e.setValue(this.plugin.settings.recurringAutoCreate),e.onChange(async t=>{this.plugin.settings.recurringAutoCreate=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Create Days Before").setDesc("Days before due date to create next occurrence (0 = on completion)").addText(e=>{e.setValue(String(this.plugin.settings.recurringCreateDaysBefore)),e.setPlaceholder("1"),e.onChange(async t=>{let i=parseInt(t,10);this.plugin.settings.recurringCreateDaysBefore=isNaN(i)?1:Math.max(0,i),await this.plugin.saveSettings()})})}renderAppearanceSection(s){s.createEl("h2",{text:"Appearance"}),new f.Setting(s).setName("Compact Mode").setDesc("Use smaller, denser task display").addToggle(e=>{e.setValue(this.plugin.settings.compactMode),e.onChange(async t=>{this.plugin.settings.compactMode=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show File Path").setDesc("How to display file paths in task list").addDropdown(e=>{for(let t of ht)e.addOption(t,q(t));e.setValue(this.plugin.settings.showFilePath),e.onChange(async t=>{this.plugin.settings.showFilePath=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Task Count in Ribbon").setDesc("Show active task count as badge on ribbon icon").addToggle(e=>{e.setValue(this.plugin.settings.taskCountInRibbon),e.onChange(async t=>{this.plugin.settings.taskCountInRibbon=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Overdue Indicator").setDesc("Highlight overdue tasks with red accent").addToggle(e=>{e.setValue(this.plugin.settings.showOverdueIndicator),e.onChange(async t=>{this.plugin.settings.showOverdueIndicator=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Due Today Indicator").setDesc("Highlight tasks due today with amber accent").addToggle(e=>{e.setValue(this.plugin.settings.showDueTodayIndicator),e.onChange(async t=>{this.plugin.settings.showDueTodayIndicator=t,await this.plugin.saveSettings()})})}renderQuickAddSection(s){s.createEl("h2",{text:"Quick Add"}),new f.Setting(s).setName("Default Target File").setDesc("Default file for new tasks created via Quick Add").addDropdown(e=>{e.addOption("","None");let t=this.app.vault.getMarkdownFiles().sort((i,a)=>i.path.localeCompare(a.path));for(let i of t)e.addOption(i.path,i.path);e.setValue(this.plugin.settings.defaultTargetFile),e.onChange(async i=>{this.plugin.settings.defaultTargetFile=i,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Default Owner").setDesc("Default owner for new tasks").addText(e=>{e.setValue(this.plugin.settings.defaultOwner),e.setPlaceholder("Your name"),e.onChange(async t=>{this.plugin.settings.defaultOwner=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Default Project").setDesc("Default project for new tasks").addText(e=>{e.setValue(this.plugin.settings.defaultProject),e.setPlaceholder("Project name"),e.onChange(async t=>{this.plugin.settings.defaultProject=t,await this.plugin.saveSettings()})})}renderDailyNoteSection(s){s.createEl("h2",{text:"Daily Notes"}),new f.Setting(s).setName("Enable Daily Note Integration").setDesc("Allow tasks to be linked to and created in daily notes").addToggle(e=>{e.setValue(this.plugin.settings.enableDailyNoteIntegration),e.onChange(async t=>{this.plugin.settings.enableDailyNoteIntegration=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Daily Notes Folder").setDesc("Folder where daily notes are stored (leave empty for vault root)").addText(e=>{e.setValue(this.plugin.settings.dailyNoteFolder),e.setPlaceholder("Daily Notes"),e.onChange(async t=>{this.plugin.settings.dailyNoteFolder=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Daily Note Date Format").setDesc("Format for daily note filenames (e.g., YYYY-MM-DD)").addText(e=>{e.setValue(this.plugin.settings.dailyNoteDateFormat),e.setPlaceholder("YYYY-MM-DD"),e.onChange(async t=>{this.plugin.settings.dailyNoteDateFormat=t||"YYYY-MM-DD",await this.plugin.saveSettings()})}),new f.Setting(s).setName("Tasks Heading").setDesc("Heading under which to add tasks in daily notes").addText(e=>{e.setValue(this.plugin.settings.dailyNoteTasksHeading),e.setPlaceholder("## Tasks"),e.onChange(async t=>{this.plugin.settings.dailyNoteTasksHeading=t||"## Tasks",await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Daily Note Button").setDesc("Show button to open/create today's daily note").addToggle(e=>{e.setValue(this.plugin.settings.showDailyNoteButton),e.onChange(async t=>{this.plugin.settings.showDailyNoteButton=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Auto-Link Tasks to Daily Note").setDesc("Automatically add link to daily note when creating tasks").addToggle(e=>{e.setValue(this.plugin.settings.autoLinkTasksToDailyNote),e.onChange(async t=>{this.plugin.settings.autoLinkTasksToDailyNote=t,await this.plugin.saveSettings()})})}renderNotificationSection(s){s.createEl("h2",{text:"Notifications & Reminders"}),new f.Setting(s).setName("Enable Notifications").setDesc("Show notifications for upcoming and overdue tasks").addToggle(e=>{e.setValue(this.plugin.settings.enableNotifications),e.onChange(async t=>{this.plugin.settings.enableNotifications=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Notify on Startup").setDesc("Show task summary when Obsidian starts").addToggle(e=>{e.setValue(this.plugin.settings.notifyOnStartup),e.onChange(async t=>{this.plugin.settings.notifyOnStartup=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Notify Overdue Tasks").setDesc("Include overdue tasks in notifications").addToggle(e=>{e.setValue(this.plugin.settings.notifyOverdueTasks),e.onChange(async t=>{this.plugin.settings.notifyOverdueTasks=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Notify Due Today").setDesc("Include tasks due today in notifications").addToggle(e=>{e.setValue(this.plugin.settings.notifyDueToday),e.onChange(async t=>{this.plugin.settings.notifyDueToday=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Notify Upcoming Tasks").setDesc("Include upcoming tasks in startup notification").addToggle(e=>{e.setValue(this.plugin.settings.notifyUpcoming),e.onChange(async t=>{this.plugin.settings.notifyUpcoming=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Upcoming Days").setDesc('Number of days to consider as "upcoming"').addText(e=>{e.setValue(String(this.plugin.settings.upcomingDays)),e.setPlaceholder("3"),e.onChange(async t=>{let i=parseInt(t,10);this.plugin.settings.upcomingDays=isNaN(i)?3:Math.max(1,i),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Reminder Interval (minutes)").setDesc("How often to check and remind about tasks (0 = disabled)").addText(e=>{e.setValue(String(this.plugin.settings.reminderCheckIntervalMinutes)),e.setPlaceholder("30"),e.onChange(async t=>{let i=parseInt(t,10);this.plugin.settings.reminderCheckIntervalMinutes=isNaN(i)?30:Math.max(0,i),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Notification Badge").setDesc("Show count of urgent tasks as badge").addToggle(e=>{e.setValue(this.plugin.settings.showNotificationBadge),e.onChange(async t=>{this.plugin.settings.showNotificationBadge=t,await this.plugin.saveSettings()})})}renderFeaturesSection(s){s.createEl("h2",{text:"Features"}),new f.Setting(s).setName("Enable Time Tracking").setDesc("Parse [estimate:2h] and [logged:1h30m] metadata from tasks").addToggle(e=>{e.setValue(this.plugin.settings.enableTimeTracking),e.onChange(async t=>{this.plugin.settings.enableTimeTracking=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Enable Comments").setDesc("Allow adding comments/notes to tasks").addToggle(e=>{e.setValue(this.plugin.settings.enableComments),e.onChange(async t=>{this.plugin.settings.enableComments=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Enable Smart Suggestions").setDesc("Show suggestions based on task patterns when adding tasks").addToggle(e=>{e.setValue(this.plugin.settings.enableSmartSuggestions),e.onChange(async t=>{this.plugin.settings.enableSmartSuggestions=t,await this.plugin.saveSettings()})})}renderAdvancedSection(s){s.createEl("h2",{text:"Advanced"}),new f.Setting(s).setName("Debug Mode").setDesc("Enable debug logging to console").addToggle(e=>{e.setValue(this.plugin.settings.debugMode),e.onChange(async t=>{this.plugin.settings.debugMode=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Enable Task Cache").setDesc("Cache parsed tasks for better performance").addToggle(e=>{e.setValue(this.plugin.settings.enableTaskCache),e.onChange(async t=>{this.plugin.settings.enableTaskCache=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Enable Virtual Scrolling").setDesc("Use virtual scrolling for large task lists").addToggle(e=>{e.setValue(this.plugin.settings.enableVirtualScrolling),e.onChange(async t=>{this.plugin.settings.enableVirtualScrolling=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Max Tasks to Render").setDesc("Maximum tasks to render at once (0 = unlimited)").addText(e=>{e.setValue(String(this.plugin.settings.maxTasksToRender)),e.setPlaceholder("0"),e.onChange(async t=>{let i=parseInt(t,10);this.plugin.settings.maxTasksToRender=isNaN(i)?0:Math.max(0,i),await this.plugin.saveSettings()})})}renderResetSection(s){s.createEl("h2",{text:"Reset"}),new f.Setting(s).setName("Clear All Filters").setDesc("Reset owner, date, project, and stage filters").addButton(e=>{e.setButtonText("Clear Filters"),e.onClick(async()=>{this.plugin.settings.filterOwner="",this.plugin.settings.filterDueDate="",this.plugin.settings.filterProject="",this.plugin.settings.filterStage="",this.plugin.settings.filterPriority="",this.plugin.settings.filterTags=[],this.plugin.settings.searchQuery="",await this.plugin.saveSettings(),new f.Notice("Filters cleared")})}),new f.Setting(s).setName("Reset All Settings").setDesc("Reset all settings to default values").addButton(e=>{e.setButtonText("Reset to Defaults"),e.setWarning(),e.onClick(async()=>{let t=this.plugin.settings.collapsedGroups;this.plugin.settings={...U,collapsedGroups:t},await this.plugin.saveSettings(),this.display(),new f.Notice("Settings reset to defaults")})})}};var Gt=/^\d{4}-\d{2}-\d{2}$/,Kt=/^[\w\s\-.']+$/u,qt=/^[\w\s\-_]+$/u;function we(c){if(c==null||c==="")return{isValid:!0,sanitizedValue:void 0};let s=c.trim();if(!Gt.test(s))return{isValid:!1,error:"Date must be in YYYY-MM-DD format"};let[e,t,i]=s.split("-").map(Number),a=new Date(e,t-1,i);return a.getFullYear()!==e||a.getMonth()!==t-1||a.getDate()!==i?{isValid:!1,error:"Invalid date value"}:{isValid:!0,sanitizedValue:s}}function le(c){if(c==null)return{isValid:!1,error:"Task text is required"};let s=c.trim();return s.length===0?{isValid:!1,error:"Task text cannot be empty"}:s.length>J.MAX_TASK_TEXT_LENGTH?{isValid:!1,error:`Task text exceeds maximum length of ${J.MAX_TASK_TEXT_LENGTH} characters`}:{isValid:!0,sanitizedValue:s}}function be(c){if(c==null||c==="")return{isValid:!0,sanitizedValue:void 0};let s=c.trim();return s.length>J.MAX_OWNER_LENGTH?{isValid:!1,error:`Owner name exceeds maximum length of ${J.MAX_OWNER_LENGTH} characters`}:Kt.test(s)?{isValid:!0,sanitizedValue:s}:{isValid:!1,error:"Owner name contains invalid characters"}}function Se(c){if(c==null||c==="")return{isValid:!0,sanitizedValue:void 0};let s=c.trim();return s.length>J.MAX_PROJECT_LENGTH?{isValid:!1,error:`Project name exceeds maximum length of ${J.MAX_PROJECT_LENGTH} characters`}:qt.test(s)?{isValid:!0,sanitizedValue:s}:{isValid:!1,error:"Project name contains invalid characters"}}function wt(c,s=[]){if(c==null||c==="")return{isValid:!0,sanitizedValue:void 0};let e=c.trim(),t=[...A,...s];return t.includes(e)?{isValid:!0,sanitizedValue:e}:{isValid:!1,error:`Invalid stage. Valid stages are: ${t.join(", ")}`}}function bt(c,s){return c==null?{isValid:!1,error:"Line number is required"}:!Number.isInteger(c)||c<0?{isValid:!1,error:"Line number must be a non-negative integer"}:s!==void 0&&c>=s?{isValid:!1,error:"Line number exceeds file length"}:{isValid:!0}}function zt(c){let s=c.toLowerCase().trim();if(ut.includes(s))return{type:s,rawString:c};let e=s.match(/^every\s+(\d+)\s+(day|days|week|weeks|month|months|year|years)$/);if(e){let i=parseInt(e[1],10),a=e[2],r="custom";return a.startsWith("day")?r="daily":a.startsWith("week")?r="weekly":a.startsWith("month")?r="monthly":a.startsWith("year")&&(r="yearly"),{type:r,interval:i,rawString:c}}let t=s.match(/^every\s+((?:mon|tue|wed|thu|fri|sat|sun)(?:day)?(?:,\s*(?:mon|tue|wed|thu|fri|sat|sun)(?:day)?)*)$/);if(t){let i={sun:0,sunday:0,mon:1,monday:1,tue:2,tuesday:2,wed:3,wednesday:3,thu:4,thursday:4,fri:5,friday:5,sat:6,saturday:6};return{type:"weekly",daysOfWeek:t[1].split(",").map(r=>r.trim()).map(r=>i[r.replace(/day$/,"")]).filter(r=>r!==void 0),rawString:c}}return s==="weekdays"?{type:"weekly",daysOfWeek:[1,2,3,4,5],rawString:c}:s==="weekends"?{type:"weekly",daysOfWeek:[0,6],rawString:c}:null}function Qt(c,s=[]){let e={owner:null,dueDate:null,stage:null,project:null,priority:null,tags:[],recurrence:null,completedDate:null,createdDate:null,blockedBy:[],blocks:[],estimate:null,timeLogged:null},t=[...A,...s],i="|";if(c.includes(i)){let a=c.split(i).map(r=>r.trim()).filter(r=>r);for(let r of a){let o=r.match(x.DATE_WITH_PREFIX);if(o){let l=we(o[1]);l.isValid&&l.sanitizedValue&&(e.dueDate=l.sanitizedValue);continue}if(t.includes(r)){e.stage=r;continue}let n=r.toLowerCase();if(H.includes(n)){e.priority=n;continue}if(!e.owner){let l=be(r);if(l.isValid&&l.sanitizedValue){e.owner=l.sanitizedValue;continue}}if(!e.project){let l=Se(r);l.isValid&&l.sanitizedValue&&(e.project=l.sanitizedValue)}}}else x.DATE.test(c)?e.dueDate=c:t.includes(c)?e.stage=c:H.includes(c.toLowerCase())?e.priority=c.toLowerCase():e.owner=c;return e}function Xt(c){let s=c,e={tags:[],blockedBy:[],blocks:[],estimate:null,timeLogged:null},t=s.match(x.COMPLETED_DATE);t&&(e.completedDate=t[1],s=s.replace(x.COMPLETED_DATE,"").trim());let i=s.match(x.CREATED_DATE);i&&(e.createdDate=i[1],s=s.replace(x.CREATED_DATE,"").trim());let a=s.match(x.PRIORITY);a&&(e.priority=a[1].toLowerCase(),s=s.replace(x.PRIORITY,"").trim());let r=s.match(x.RECURRENCE);r&&(e.recurrence=zt(r[1]),s=s.replace(x.RECURRENCE,"").trim());let o=[...s.matchAll(x.BLOCKED_BY)];for(let g of o)if(g[1]){let p=g[1].split(",").map(h=>h.trim()).filter(h=>h);e.blockedBy.push(...p)}s=s.replace(x.BLOCKED_BY,"").trim();let n=[...s.matchAll(x.BLOCKS)];for(let g of n)if(g[1]){let p=g[1].split(",").map(h=>h.trim()).filter(h=>h);e.blocks.push(...p)}s=s.replace(x.BLOCKS,"").trim();let l=s.match(x.ESTIMATE);l&&(e.estimate=l[1].trim(),s=s.replace(x.ESTIMATE,"").trim());let d=s.match(x.TIME_LOGGED);d&&(e.timeLogged=d[1].trim(),s=s.replace(x.TIME_LOGGED,"").trim());let u=s.matchAll(x.TAGS);for(let g of u)g[1]&&e.tags.push(g[1].toLowerCase());return s=s.replace(x.TAGS,"").trim(),s=s.replace(/\s+/g," ").trim(),{cleanText:s,metadata:e}}function ze(c,s,e,t=[]){var p,h,b,v,k,N,S,T,$,he,D,j,B,W,it,at,rt,nt,ot,lt,ct,dt;let i=c.match(x.TASK_LINE);if(!i)return null;let a=(p=i[1])!=null?p:"",r=((h=i[2])==null?void 0:h.toLowerCase())==="x",o=(b=i[3])!=null?b:"",{cleanText:n,metadata:l}=Xt(o);o=n;let d={owner:null,dueDate:null,stage:null,project:null,priority:(v=l.priority)!=null?v:null,tags:(k=l.tags)!=null?k:[],recurrence:(N=l.recurrence)!=null?N:null,completedDate:(S=l.completedDate)!=null?S:null,createdDate:(T=l.createdDate)!=null?T:null,blockedBy:($=l.blockedBy)!=null?$:[],blocks:(he=l.blocks)!=null?he:[],estimate:(D=l.estimate)!=null?D:null,timeLogged:(j=l.timeLogged)!=null?j:null},u=o,g=o.match(x.METADATA);if(g){let Rt=g[1].trim();u=(W=(B=g[2])==null?void 0:B.trim())!=null?W:"";let G=Qt(Rt,t);d={...d,...G,priority:(it=d.priority)!=null?it:G.priority,tags:[...new Set([...d.tags,...G.tags])],recurrence:(at=d.recurrence)!=null?at:G.recurrence,completedDate:(rt=d.completedDate)!=null?rt:G.completedDate,createdDate:(nt=d.createdDate)!=null?nt:G.createdDate,blockedBy:[...new Set([...d.blockedBy,...G.blockedBy])],blocks:[...new Set([...d.blocks,...G.blocks])]}}return{id:`${s.path}:${e}`,file:s,lineNumber:e,text:u,completed:r,dueDate:d.dueDate,owner:d.owner,stage:d.stage,project:d.project,completedDate:d.completedDate,rawLine:c,priority:d.priority,tags:d.tags,recurrence:d.recurrence,parentId:null,children:[],depth:yt(a),indent:a,createdDate:d.createdDate,blockedBy:d.blockedBy,blocks:d.blocks,estimate:(lt=(ot=d.estimate)!=null?ot:l.estimate)!=null?lt:null,timeLogged:(dt=(ct=d.timeLogged)!=null?ct:l.timeLogged)!=null?dt:null}}async function Qe(c,s,e){let t=[];try{let a=(await c.vault.read(s)).split(`
`);for(let r=0;r<a.length;r++){let o=a[r],n=ze(o,s,r,e.customStages);n&&t.push(n)}}catch(i){console.error(`Error parsing tasks from ${s.path}:`,i)}return t}function St(c){let s=[...c].sort((i,a)=>i.file.path!==a.file.path?i.file.path.localeCompare(a.file.path):i.lineNumber-a.lineNumber),e=[],t=[];for(let i of s){for(i.children=[],i.parentId=null;t.length>0&&(t[t.length-1].file.path!==i.file.path||t[t.length-1].depth>=i.depth);)t.pop();if(t.length>0&&i.depth>0){let a=t[t.length-1];i.parentId=a.id,a.children.push(i)}else e.push(i);t.push(i)}return e}function m(c){let s=c.getFullYear(),e=String(c.getMonth()+1).padStart(2,"0"),t=String(c.getDate()).padStart(2,"0");return`${s}-${e}-${t}`}function R(c){let s=c.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!s)return null;let[,e,t,i]=s,a=parseInt(e,10),r=parseInt(t,10)-1,o=parseInt(i,10),n=new Date(a,r,o);return n.getFullYear()!==a||n.getMonth()!==r||n.getDate()!==o?null:n}function w(){let c=new Date;return new Date(c.getFullYear(),c.getMonth(),c.getDate())}function y(c,s){let e=new Date(c);return e.setDate(e.getDate()+s),e}function ge(c,s){return y(c,s*7)}function z(c,s){let e=new Date(c);return e.setMonth(e.getMonth()+s),e}function xe(c,s){let e=new Date(c);return e.setFullYear(e.getFullYear()+s),e}function Z(c,s=0){let e=new Date(c),t=e.getDay(),i=(t<s?7:0)+t-s;return e.setDate(e.getDate()-i),e}function Et(c,s=0){let e=Z(c,s);return y(e,6)}function Jt(c){return new Date(c.getFullYear(),c.getMonth()+1,0)}function Ct(c){let s=w();return c.getFullYear()===s.getFullYear()&&c.getMonth()===s.getMonth()&&c.getDate()===s.getDate()}function Zt(c){return c<w()}function E(c){if(!c)return!1;let s=R(c);return s?Zt(s)&&!Ct(s):!1}function I(c){if(!c)return!1;let s=R(c);return s?Ct(s):!1}function Xe(c,s=0){if(!c)return!1;let e=R(c);if(!e)return!1;let t=w(),i=Z(t,s),a=Et(t,s);return e>=i&&e<=a}function xt(c,s=w()){let e=new Date(s),t=e.getDay(),i=(c-t+7)%7||7;return e.setDate(e.getDate()+i),e}function es(c,s=w()){let e=new Date(s),t=e.getDay(),i=(c-t+7)%7;return i<7&&(i+=7),e.setDate(e.getDate()+i),e}function fe(c){let s=c.toLowerCase().trim(),e=w();if(/^\d{4}-\d{2}-\d{2}$/.test(s)){let n=R(s);return n?m(n):null}let t=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(t){let[,n,l,d]=t,u=new Date(parseInt(d,10),parseInt(n,10)-1,parseInt(l,10));if(!isNaN(u.getTime()))return m(u)}let i=s.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(i){let[,n,l,d]=i,u=new Date(parseInt(d,10),parseInt(l,10)-1,parseInt(n,10));if(!isNaN(u.getTime()))return m(u)}if(s==="today")return m(e);if(s==="tomorrow")return m(y(e,1));if(s==="yesterday")return m(y(e,-1));let a=s.match(/^in\s+(\d+)\s+(day|days|week|weeks|month|months|year|years)$/);if(a){let n=parseInt(a[1],10),l=a[2];if(l.startsWith("day"))return m(y(e,n));if(l.startsWith("week"))return m(ge(e,n));if(l.startsWith("month"))return m(z(e,n));if(l.startsWith("year"))return m(xe(e,n))}let r=s.match(/^(\d+)\s+(day|days|week|weeks|month|months|year|years)\s+from\s+(now|today)$/);if(r){let n=parseInt(r[1],10),l=r[2];if(l.startsWith("day"))return m(y(e,n));if(l.startsWith("week"))return m(ge(e,n));if(l.startsWith("month"))return m(z(e,n));if(l.startsWith("year"))return m(xe(e,n))}for(let n=0;n<ae.length;n++){let l=ae[n],d=re[n];if(s===`next ${l}`||s===`next ${d}`)return m(es(n,e));if(s===`this ${l}`||s===`this ${d}`)return e.getDay()===n?m(e):m(xt(n,e))}for(let n=0;n<ae.length;n++){let l=ae[n],d=re[n];if(s===l||s===d)return m(xt(n,e))}if(s==="next week")return m(ge(e,1));if(s==="next month")return m(z(e,1));if(s==="end of week"||s==="eow")return m(Et(e));if(s==="end of month"||s==="eom")return m(Jt(e));if(s==="start of next week"||s==="beginning of next week"){let n=y(Z(e),7);return m(n)}if(s==="start of next month"||s==="beginning of next month"){let n=new Date(e.getFullYear(),e.getMonth()+1,1);return m(n)}if(s==="weekday"||s==="next weekday"){let n=y(e,1);for(;n.getDay()===0||n.getDay()===6;)n=y(n,1);return m(n)}if(s==="next business day"||s==="business day"){let n=y(e,1);for(;n.getDay()===0||n.getDay()===6;)n=y(n,1);return m(n)}for(let n=0;n<X.length;n++){let l=X[n],d=ft[n],u=s.match(new RegExp(`^(${l}|${d})\\s+(\\d{1,2})(?:(?:st|nd|rd|th))?(?:\\s+(\\d{4}))?$`));if(u){let g=parseInt(u[2],10),p=u[3]?parseInt(u[3],10):e.getFullYear(),h=new Date(p,n,g);if(h.getMonth()!==n)continue;if(!u[3]&&h<e&&h.setFullYear(h.getFullYear()+1),!isNaN(h.getTime()))return m(h)}}let o=s.match(/^the\s+(\d{1,2})(?:st|nd|rd|th)?(?:\s+of\s+(this\s+month|next\s+month))?$/);if(o){let n=parseInt(o[1],10),l=o[2],d=e.getMonth(),u=e.getFullYear();l==="next month"&&(d+=1,d>11&&(d=0,u+=1));let g=new Date(u,d,n);if(!l&&g<=e&&g.setMonth(g.getMonth()+1),g.getDate()===n)return m(g)}return null}function ts(c,s="YYYY-MM-DD"){if(!c)return"";let e=R(c);if(!e)return c;switch(s){case"MM/DD/YYYY":return`${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")}/${e.getFullYear()}`;case"DD-MM-YYYY":return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${e.getFullYear()}`;case"locale":return e.toLocaleDateString();case"YYYY-MM-DD":default:return c}}function ee(c){if(!c)return"";let s=R(c);if(!s)return c;let e=w(),t=s.getTime()-e.getTime(),i=Math.round(t/(1e3*60*60*24));if(i===0)return"Today";if(i===1)return"Tomorrow";if(i===-1)return"Yesterday";if(i>1&&i<=7){let a=ae[s.getDay()];return a.charAt(0).toUpperCase()+a.slice(1)}return i<-1&&i>=-7?`${Math.abs(i)} days ago`:i>7&&i<=14?"Next week":ts(c)}var Ee=class{constructor(s,e){this.cache=new Map;this.allTasks=[];this.isInitialized=!1;this.stats={totalFiles:0,cachedFiles:0,totalTasks:0,completedTasks:0,incompleteTasks:0,hits:0,misses:0,lastRefresh:0};this.app=s,this.settings=e}updateSettings(s){this.settings=s}async initialize(){await this.refreshAll(),this.isInitialized=!0}get initialized(){return this.isInitialized}getAllTasks(){return this.allTasks}getCacheStats(){let s=0,e=0;for(let t of this.allTasks)t.completed?s++:e++;return{...this.stats,completedTasks:s,incompleteTasks:e}}async refreshFile(s){if(!this.shouldParseFile(s)){this.cache.delete(s.path),this.rebuildAllTasks();return}let e={tasks:await Qe(this.app,s,this.settings),lastModified:s.stat.mtime};this.cache.set(s.path,e),this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size}removeFile(s){this.cache.delete(s),this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size}renameFile(s,e){let t=this.cache.get(s);t&&(this.cache.delete(s),this.cache.set(e,t))}async refreshAll(){this.cache.clear();let s=this.app.vault.getMarkdownFiles();this.stats.totalFiles=s.length;for(let e of s){if(!this.shouldParseFile(e))continue;let t=this.cache.get(e.path);if(t&&t.lastModified===e.stat.mtime){this.stats.hits++;continue}this.stats.misses++;try{let i={tasks:await Qe(this.app,e,this.settings),lastModified:e.stat.mtime};this.cache.set(e.path,i)}catch(i){console.error(`Task Consolidator: Error parsing file ${e.path}:`,i)}}this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size,this.stats.lastRefresh=Date.now()}shouldParseFile(s){var t,i;if(!s.path.endsWith(".md"))return!1;let e=(i=(t=s.parent)==null?void 0:t.path)!=null?i:"";for(let a of this.settings.excludedFolders){let r=a.replace(/\\/g,"/");if(e===r||e.startsWith(`${r}/`))return!1}for(let a of this.settings.excludedPatterns){let r=a.replace(/\\/g,"/");if(this.matchGlob(s.path,r))return!1}return!0}matchGlob(s,e){let t=e.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${t}$`).test(s)}rebuildAllTasks(){let s=[];for(let e of this.cache.values())s.push(...e.tasks);this.allTasks=St(s),this.stats.totalTasks=this.allTasks.length}getTasksForFile(s){var t;let e=this.cache.get(s);return(t=e==null?void 0:e.tasks)!=null?t:[]}getFilteredTasks(s){let e=[...this.allTasks];s.showCompleted===!1?e=e.filter(i=>!i.completed):s.completed!==void 0&&(e=e.filter(i=>i.completed===s.completed)),s.owner&&(e=e.filter(i=>i.owner===s.owner)),s.project&&(e=e.filter(i=>i.project===s.project)),s.stage&&(e=e.filter(i=>i.stage===s.stage)),s.priority&&(e=e.filter(i=>i.priority===s.priority)),s.tags&&s.tags.length>0&&(e=e.filter(i=>s.tags.every(a=>i.tags.includes(a)))),s.filePath&&(e=e.filter(i=>i.file.path.includes(s.filePath)));let t=s.searchText||s.search;if(t){let i=Tt(t),a=new RegExp(i,"i");e=e.filter(r=>a.test(r.text)||r.owner&&a.test(r.owner)||r.project&&a.test(r.project))}if(s.dueDateFilter)switch(s.dueDateFilter){case"today":e=e.filter(i=>I(i.dueDate));break;case"thisWeek":e=e.filter(i=>Xe(i.dueDate,this.settings.firstDayOfWeek));break;case"overdue":e=e.filter(i=>E(i.dueDate));break;case"noDueDate":e=e.filter(i=>!i.dueDate);break}return s.dueDateRange&&(e=e.filter(i=>i.dueDate?i.dueDate>=s.dueDateRange.start&&i.dueDate<=s.dueDateRange.end:!1)),s.dueDate&&(e=e.filter(i=>i.dueDate===s.dueDate)),e}clear(){this.cache.clear(),this.allTasks=[],this.stats={totalFiles:0,cachedFiles:0,totalTasks:0,completedTasks:0,incompleteTasks:0,hits:0,misses:0,lastRefresh:0},this.isInitialized=!1}getTaskStats(){var t,i;let s=this.allTasks,e={total:s.length,completed:0,active:0,overdue:0,dueToday:0,dueThisWeek:0,byStage:{Requested:0,Staged:0,"In-Progress":0,"In-Review":0,Completed:0,unassigned:0},byOwner:{},byProject:{},byPriority:{high:0,medium:0,low:0}};for(let a of s)a.completed?e.completed++:(e.active++,E(a.dueDate)&&e.overdue++,I(a.dueDate)&&e.dueToday++,Xe(a.dueDate,this.settings.firstDayOfWeek)&&e.dueThisWeek++),a.stage&&A.includes(a.stage)?e.byStage[a.stage]++:e.byStage.unassigned++,a.owner&&(e.byOwner[a.owner]=((t=e.byOwner[a.owner])!=null?t:0)+1),a.project&&(e.byProject[a.project]=((i=e.byProject[a.project])!=null?i:0)+1),a.priority&&e.byPriority[a.priority]++;return e}getUniqueOwners(){let s=new Set;for(let e of this.allTasks)e.owner&&s.add(e.owner);return[...s].sort()}getUniqueProjects(){let s=new Set;for(let e of this.allTasks)e.project&&s.add(e.project);return[...s].sort()}getUniqueDueDates(){let s=new Set;for(let e of this.allTasks)e.dueDate&&s.add(e.dueDate);return[...s].sort()}getUniqueTags(){let s=new Set;for(let e of this.allTasks)for(let t of e.tags)s.add(t);return[...s].sort()}};var V=require("obsidian");var Je=class extends V.Modal{constructor(e,t,i){super(e);this.resolved=!1;this.taskText=t,this.resolve=i}onOpen(){let{contentEl:e}=this;e.createEl("h3",{text:"Delete Task?"}),e.createEl("p",{text:this.taskText});let t=e.createDiv({cls:"modal-button-container"});new V.ButtonComponent(t).setButtonText("Cancel").onClick(()=>{this.resolved=!0,this.resolve(!1),this.close()}),new V.ButtonComponent(t).setButtonText("Delete").setWarning().onClick(()=>{this.resolved=!0,this.resolve(!0),this.close()})}onClose(){this.resolved||this.resolve(!1),this.contentEl.empty()}},Ce=class{constructor(s,e){this.undoStack=[];this.maxUndoEntries=50;this.app=s,this.settings=e}updateSettings(s){this.settings=s}async toggleTask(s){let e=!s.completed;return this.updateTask(s,{completed:e,stage:e?"Completed":s.stage==="Completed"?null:s.stage})}async updateTask(s,e){var t,i,a;try{let r=this.app.vault.getAbstractFileByPath(s.file.path);if(!r||!(r instanceof V.TFile))return{success:!1,error:"File not found"};let n=(await this.app.vault.read(r)).split(`
`),l=bt(s.lineNumber,n.length);if(!l.isValid)return{success:!1,error:l.error};let d=n[s.lineNumber];if(d!==s.rawLine)return{success:!1,error:"Task has been modified. Please refresh and try again."};let u=this.buildUpdatedLine(s,e);this.pushUndo({filePath:s.file.path,lineNumber:s.lineNumber,originalLine:d,newLine:u,timestamp:Date.now()}),n[s.lineNumber]=u;let g=n.join(`
`);return await this.app.vault.modify(r,g),e.completed&&s.recurrence&&!s.completed&&await this.createNextRecurrence(s),{success:!0,task:{...s,rawLine:u,completed:(t=e.completed)!=null?t:s.completed,text:(i=e.text)!=null?i:s.text,owner:e.owner!==void 0?e.owner:s.owner,dueDate:e.dueDate!==void 0?e.dueDate:s.dueDate,stage:e.stage!==void 0?e.stage:s.stage,project:e.project!==void 0?e.project:s.project,priority:e.priority!==void 0?e.priority:s.priority,tags:(a=e.tags)!=null?a:s.tags}}}catch(r){let o=r instanceof Error?r.message:"Unknown error";return console.error("Error updating task:",r),{success:!1,error:o}}}buildUpdatedLine(s,e){var h,b;let t=(h=e.completed)!=null?h:s.completed,i=t?"x":" ",a=e.owner!==void 0?Ge(e.owner):s.owner,r=e.dueDate!==void 0?e.dueDate:s.dueDate,o=e.stage!==void 0?e.stage:s.stage,n=e.project!==void 0?Ke(e.project):s.project,l=e.priority!==void 0?e.priority:s.priority,d=e.text!==void 0?qe(e.text):s.text,u=e.tags!==void 0?e.tags:s.tags,g=[];a&&g.push(a),r&&g.push(r),o&&g.push(o),n&&g.push(n);let p=d;if(g.length>0&&(p=`**${g.join(" | ")}:** ${d}`),l&&(p+=` [priority:${l}]`),s.recurrence&&(p+=` [repeat:${(b=s.recurrence.rawString)!=null?b:s.recurrence.type}]`),u.length>0&&(p+=" "+u.map(v=>`#${v}`).join(" ")),s.estimate&&(p+=` [estimate:${s.estimate}]`),s.timeLogged&&(p+=` [logged:${s.timeLogged}]`),t&&!s.completed){let v=m(w());p+=` [done:${v}]`}else s.completedDate&&t&&(p+=` [done:${s.completedDate}]`);return s.createdDate&&(p+=` [created:${s.createdDate}]`),`${s.indent}- [${i}] ${p}`}async createTask(s,e,t={}){var i;try{let a=le(e);if(!a.isValid)return{success:!1,error:a.error};if(t.owner){let h=be(t.owner);if(!h.isValid)return{success:!1,error:h.error}}if(t.dueDate){let h=we(t.dueDate);if(!h.isValid)return{success:!1,error:h.error}}if(t.project){let h=Se(t.project);if(!h.isValid)return{success:!1,error:h.error}}if(t.stage){let h=wt(t.stage,this.settings.customStages);if(!h.isValid)return{success:!1,error:h.error}}let r=[];t.owner&&r.push(Ge(t.owner)),t.dueDate&&r.push(t.dueDate),t.stage&&r.push(t.stage),t.project&&r.push(Ke(t.project));let o=qe(e);r.length>0&&(o=`**${r.join(" | ")}:** ${o}`),t.priority&&(o+=` [priority:${t.priority}]`),t.tags&&t.tags.length>0&&(o+=" "+t.tags.map(h=>`#${h}`).join(" "));let n=m(w());o+=` [created:${n}]`;let l=`- [ ] ${o}`,u=(await this.app.vault.read(s)).split(`
`),g=(i=t.atLine)!=null?i:u.length;if(g<0||g>u.length)return{success:!1,error:`Line number ${g} is out of range (0-${u.length})`};u.splice(g,0,l);let p=u.join(`
`);return await this.app.vault.modify(s,p),new V.Notice("Task created"),{success:!0}}catch(a){let r=a instanceof Error?a.message:"Unknown error";return console.error("Error creating task:",a),{success:!1,error:r}}}confirmDelete(s){return new Promise(e=>{new Je(this.app,s.text,e).open()})}async deleteTask(s){try{if(this.settings.confirmDestructiveActions&&!await this.confirmDelete(s))return{success:!1,error:"Delete cancelled"};let t=(await this.app.vault.read(s.file)).split(`
`);if(t[s.lineNumber]!==s.rawLine)return{success:!1,error:"Task has been modified. Please refresh and try again."};this.pushUndo({filePath:s.file.path,lineNumber:s.lineNumber,originalLine:s.rawLine,newLine:"",timestamp:Date.now()}),t.splice(s.lineNumber,1);let i=t.join(`
`);return await this.app.vault.modify(s.file,i),{success:!0}}catch(e){let t=e instanceof Error?e.message:"Unknown error";return console.error("Error deleting task:",e),{success:!1,error:t}}}async createNextRecurrence(s){var t,i,a;if(!s.recurrence||!this.settings.recurringAutoCreate)return;let e=this.calculateNextDueDate(s.dueDate,s.recurrence);e&&(s.recurrence.endDate&&e>s.recurrence.endDate||(await this.createTask(s.file,s.text,{owner:(t=s.owner)!=null?t:void 0,dueDate:e,project:(i=s.project)!=null?i:void 0,stage:"Requested",priority:(a=s.priority)!=null?a:void 0,tags:s.tags}),new V.Notice("Created next occurrence for recurring task")))}calculateNextDueDate(s,e){var a;let t=s?new Date(s):w(),i=(a=e.interval)!=null?a:1;switch(e.type){case"daily":return m(y(t,i));case"weekly":if(e.daysOfWeek&&e.daysOfWeek.length>0){let r=t.getDay(),o=[...e.daysOfWeek].sort((d,u)=>d-u),n=o.find(d=>d>r);if(n!==void 0){let d=n-r;return m(y(t,d))}n=o[0];let l=7-r+n;return m(y(t,l))}return m(ge(t,i));case"monthly":return m(z(t,i));case"yearly":return m(xe(t,i));case"custom":return m(y(t,i));default:return null}}pushUndo(s){this.undoStack.push(s),this.undoStack.length>this.maxUndoEntries&&this.undoStack.shift()}async undo(){let s=this.undoStack.pop();if(!s)return{success:!1,error:"Nothing to undo"};try{let e=this.app.vault.getAbstractFileByPath(s.filePath);if(!e||!(e instanceof V.TFile))return{success:!1,error:"File not found"};let i=(await this.app.vault.read(e)).split(`
`);s.newLine===""?i.splice(s.lineNumber,0,s.originalLine):i[s.lineNumber]=s.originalLine;let a=i.join(`
`);return await this.app.vault.modify(e,a),new V.Notice("Undo successful"),{success:!0}}catch(e){let t=e instanceof Error?e.message:"Unknown error";return console.error("Error undoing:",e),{success:!1,error:t}}}canUndo(){return this.undoStack.length>0}clearUndoStack(){this.undoStack=[]}async updateTaskStage(s,e){let t={stage:e};return e==="Completed"?t.completed=!0:s.completed&&(t.completed=!1),this.updateTask(s,t)}async bulkUpdate(s,e){let t={successful:0,failed:0,errors:[]};for(let i of s){let a=await this.updateTask(i,e);a.success?t.successful++:(t.failed++,a.error&&t.errors.push(`${i.text}: ${a.error}`))}return t}async bulkDelete(s){let e={successful:0,failed:0,errors:[]},t=[...s].sort((i,a)=>i.file.path!==a.file.path?i.file.path.localeCompare(a.file.path):a.lineNumber-i.lineNumber);for(let i of t){let a=await this.deleteTask(i);a.success?e.successful++:(e.failed++,a.error&&e.errors.push(`${i.text}: ${a.error}`))}return e}};var Ne=require("obsidian");function et(c){let s=c.match(/([^/\\]+):(\d+)$/);return s?`${s[1].replace(".md","")}:${s[2]}`:c}function tt(c){let s=new Map;for(let e of c){let t=`${e.file.basename.replace(".md","")}:${e.lineNumber}`;s.set(t,e.id),s.set(e.id,e.id)}return s}function Ze(c,s){let e=s.get(c);return e||(c.includes("/")||c.includes("\\")?(s.has(c),c):null)}function ce(c,s,e){let t=e!=null?e:tt(s),i=new Map(s.map(o=>[o.id,o])),a=[];for(let o of c.blockedBy){let n=Ze(o,t);if(n){let l=i.get(n);l&&!l.completed&&a.push(n)}else a.push(o)}let r=[];for(let o of c.blocks){let n=Ze(o,t);n?r.push(n):r.push(o)}for(let o of s)if(o.id!==c.id)for(let n of o.blockedBy)Ze(n,t)===c.id&&!r.includes(o.id)&&r.push(o.id);return{isBlocked:a.length>0,blockedByCount:a.length,blocksCount:r.length,blockedByTasks:a,blocksTasks:r}}function Pe(c){return c.filter(s=>s.completed?!1:ce(s,c).isBlocked)}var Oe=class{constructor(s,e){this.checkInterval=null;this.lastNotifiedTasks=new Set;this.getTasksFn=null;this.maxNotifiedTasksSize=500;this.app=s,this.settings=e}updateSettings(s){this.settings=s,this.restartCheckInterval()}startCheckInterval(s){if(this.stopCheckInterval(),!this.settings.enableNotifications)return;let e=this.settings.reminderCheckIntervalMinutes*60*1e3;e<=0||(this.getTasksFn=s,this.checkInterval=window.setInterval(()=>{this.checkAndNotify(s())},e),this.settings.debugMode&&console.log(`Notification check interval started: ${this.settings.reminderCheckIntervalMinutes} minutes`))}stopCheckInterval(){this.checkInterval&&(window.clearInterval(this.checkInterval),this.checkInterval=null)}restartCheckInterval(){this.getTasksFn&&this.startCheckInterval(this.getTasksFn)}getNotificationSummary(s){let e=s.filter(l=>!l.completed),t=w(),i=y(t,this.settings.upcomingDays),a=[],r=[],o=[];for(let l of e)if(l.dueDate)if(E(l.dueDate))a.push(l);else if(I(l.dueDate))r.push(l);else{let d=R(l.dueDate);d&&d>t&&d<=i&&o.push(l)}let n=Pe(e);return{overdueTasks:a,dueTodayTasks:r,upcomingTasks:o,blockedTasks:n,totalActionable:a.length+r.length+o.length}}showStartupNotification(s){if(!this.settings.enableNotifications||!this.settings.notifyOnStartup)return;let e=[];this.settings.notifyOverdueTasks&&s.overdueTasks.length>0&&e.push(`\u{1F534} ${s.overdueTasks.length} overdue`),this.settings.notifyDueToday&&s.dueTodayTasks.length>0&&e.push(`\u{1F7E1} ${s.dueTodayTasks.length} due today`),this.settings.notifyUpcoming&&s.upcomingTasks.length>0&&e.push(`\u{1F535} ${s.upcomingTasks.length} upcoming`),e.length>0&&new Ne.Notice(`Task Consolidator: ${e.join(", ")}`,5e3)}notifyTaskDue(s){if(!this.settings.enableNotifications||this.lastNotifiedTasks.has(s.id))return;this.lastNotifiedTasks.size>=this.maxNotifiedTasksSize&&this.lastNotifiedTasks.clear(),this.lastNotifiedTasks.add(s.id),setTimeout(()=>{this.lastNotifiedTasks.delete(s.id)},5*60*1e3);let e="";E(s.dueDate)?e="\u{1F534} OVERDUE":I(s.dueDate)&&(e="\u{1F7E1} Due Today");let t=`${e}: ${s.text}`;new Ne.Notice(t,8e3)}checkAndNotify(s){if(!this.settings.enableNotifications)return;let e=Date.now(),t=this.getNotificationSummary(s),i=this.settings.reminderCheckIntervalMinutes*60*1e3;if(e-this.settings.lastNotificationCheck<i)return;let a=[];this.settings.notifyOverdueTasks&&t.overdueTasks.length>0&&a.push(`\u{1F534} ${t.overdueTasks.length} overdue task${t.overdueTasks.length>1?"s":""}`),this.settings.notifyDueToday&&t.dueTodayTasks.length>0&&a.push(`\u{1F7E1} ${t.dueTodayTasks.length} task${t.dueTodayTasks.length>1?"s":""} due today`),a.length>0&&(new Ne.Notice(`Reminder: ${a.join(", ")}`,6e3),this.settings.lastNotificationCheck=Date.now())}formatSummaryText(s){let e=[];return s.overdueTasks.length>0&&e.push(`\u{1F534} Overdue: ${s.overdueTasks.length}`),s.dueTodayTasks.length>0&&e.push(`\u{1F7E1} Due today: ${s.dueTodayTasks.length}`),s.upcomingTasks.length>0&&e.push(`\u{1F535} Upcoming (${this.settings.upcomingDays} days): ${s.upcomingTasks.length}`),s.blockedTasks.length>0&&e.push(`\u{1F6AB} Blocked: ${s.blockedTasks.length}`),e.join(`
`)}getBadgeCount(s){return this.settings.showNotificationBadge?s.overdueTasks.length+s.dueTodayTasks.length:0}destroy(){this.stopCheckInterval(),this.lastNotifiedTasks.clear()}};var Me=class{constructor(s,e){this.comments=new Map;this.loadData=s,this.saveData=e}async initialize(){var t;let s=await this.loadData(),e=(t=s==null?void 0:s.taskComments)!=null?t:{};this.comments.clear();for(let[i,a]of Object.entries(e))this.comments.set(i,a)}getCommentsForTask(s){var e;return(e=this.comments.get(s))!=null?e:[]}async addComment(s,e){var a;let t={id:Date.now().toString(36)+Math.random().toString(36).slice(2,6),taskId:s,text:e,timestamp:Date.now()},i=(a=this.comments.get(s))!=null?a:[];return i.push(t),this.comments.set(s,i),await this.persist(),t}async deleteComment(s,e){var i;let t=(i=this.comments.get(s))!=null?i:[];this.comments.set(s,t.filter(a=>a.id!==e)),await this.persist()}async persist(){var t;let s=(t=await this.loadData())!=null?t:{},e={};for(let[i,a]of this.comments)a.length>0&&(e[i]=a);s.taskComments=e,await this.saveData(s)}};var Ae=class{constructor(s){this.taskCache=s}suggestOwnerForProject(s){let e=this.taskCache.getAllTasks().filter(t=>t.project===s&&t.owner);return this.buildFrequencyList("owner",e.map(t=>t.owner))}suggestPriority(){let s=this.taskCache.getAllTasks().filter(e=>e.priority);return this.buildFrequencyList("priority",s.map(e=>e.priority))}suggestTags(){let s=[];for(let e of this.taskCache.getAllTasks())s.push(...e.tags);return this.buildFrequencyList("tag",s)}suggestProject(){let s=this.taskCache.getAllTasks().filter(e=>e.project);return this.buildFrequencyList("project",s.map(e=>e.project))}getSuggestionsForContext(s){return{owners:s?this.suggestOwnerForProject(s):this.buildFrequencyList("owner",this.taskCache.getAllTasks().filter(e=>e.owner).map(e=>e.owner)),priorities:this.suggestPriority(),tags:this.suggestTags(),projects:this.suggestProject()}}buildFrequencyList(s,e){var i;let t=new Map;for(let a of e)t.set(a,((i=t.get(a))!=null?i:0)+1);return[...t.entries()].map(([a,r])=>({field:s,value:a,frequency:r})).sort((a,r)=>r.frequency-a.frequency).slice(0,5)}};var _=require("obsidian");var Pt=require("obsidian");async function te(c,s){await c.workspace.getLeaf(!1).openFile(s.file);let e=c.workspace.getActiveViewOfType(Pt.MarkdownView);if(e!=null&&e.editor){let t=e.editor;t.setCursor({line:s.lineNumber,ch:0}),t.scrollIntoView({from:{line:s.lineNumber,ch:0},to:{line:s.lineNumber,ch:0}},!0)}}function Nt(c){let s={},e=c,t=e.match(/\bowner:(\S+)/i);t&&(s.owner=t[1],e=e.replace(t[0],""));let i=e.match(/\bproject:(\S+)/i);i&&(s.project=i[1],e=e.replace(i[0],""));let a=e.match(/\bstage:(\S+)/i);a&&(s.stage=a[1],e=e.replace(a[0],""));let r=e.match(/\bpriority:(high|medium|low)/i);r&&(s.priority=r[1].toLowerCase(),e=e.replace(r[0],""));let o=e.match(/\bdue:(\S+)/i);if(o){let p=o[1].toLowerCase();if(p==="today")s.dueDateFilter="today";else if(p==="thisweek")s.dueDateFilter="thisWeek";else if(p==="overdue")s.dueDateFilter="overdue";else if(p==="none")s.dueDateFilter="noDueDate";else{let h=fe(p);h&&(s.dueDate=h)}e=e.replace(o[0],"")}let n=e.match(/\bfile:(\S+)/i);n&&(s.filePath=n[1],e=e.replace(n[0],""));let l=[],d=e.matchAll(/\btag:(\S+)/gi);for(let p of d)l.push(p[1].toLowerCase()),e=e.replace(p[0],"");let u=e.matchAll(/#([\w\-_]+)/g);for(let p of u)l.push(p[1].toLowerCase()),e=e.replace(p[0],"");l.length>0&&(s.tags=l);let g=e.replace(/\s+/g," ").trim();return g&&(s.searchText=g),s}var Le=class{constructor(s,e={}){this.focusedIndex=-1;var t;this.container=s,this.itemSelector=(t=e.itemSelector)!=null?t:".task-item",this.onSelect=e.onSelect,this.onActivate=e.onActivate,this.setupKeyboardNavigation()}getItems(){return Array.from(this.container.querySelectorAll(this.itemSelector))}setupKeyboardNavigation(){this.container.addEventListener("keydown",s=>this.handleKeyDown(s)),this.container.hasAttribute("tabindex")||this.container.setAttribute("tabindex","0"),this.container.setAttribute("role","listbox"),this.container.setAttribute("aria-label","Task list")}handleKeyDown(s){var t,i;let e=this.getItems();if(e.length!==0)switch(s.key){case F.ARROW_DOWN:s.preventDefault(),this.focusNext(e);break;case F.ARROW_UP:s.preventDefault(),this.focusPrevious(e);break;case F.HOME:s.preventDefault(),this.focusFirst(e);break;case F.END:s.preventDefault(),this.focusLast(e);break;case F.ENTER:this.focusedIndex>=0&&e[this.focusedIndex]&&(s.preventDefault(),(t=this.onActivate)==null||t.call(this,e[this.focusedIndex],this.focusedIndex));break;case F.SPACE:this.focusedIndex>=0&&e[this.focusedIndex]&&(s.preventDefault(),(i=this.onSelect)==null||i.call(this,e[this.focusedIndex],this.focusedIndex));break;case F.ESCAPE:s.preventDefault(),this.clearFocus(e);break}}focusNext(s){this.focusedIndex<s.length-1&&this.setFocus(s,this.focusedIndex+1)}focusPrevious(s){this.focusedIndex>0?this.setFocus(s,this.focusedIndex-1):this.focusedIndex===-1&&s.length>0&&this.setFocus(s,s.length-1)}focusFirst(s){s.length>0&&this.setFocus(s,0)}focusLast(s){s.length>0&&this.setFocus(s,s.length-1)}setFocus(s,e){if(this.focusedIndex>=0&&s[this.focusedIndex]){let i=s[this.focusedIndex];i.classList.remove("task-focused"),i.removeAttribute("aria-selected")}this.focusedIndex=e;let t=s[e];t&&(t.classList.add("task-focused"),t.setAttribute("aria-selected","true"),t.scrollIntoView({block:"nearest",behavior:"smooth"}),this.container.setAttribute("aria-activedescendant",t.id||`task-item-${e}`),t.id||(t.id=`task-item-${e}`))}clearFocus(s){if(this.focusedIndex>=0&&s[this.focusedIndex]){let e=s[this.focusedIndex];e.classList.remove("task-focused"),e.removeAttribute("aria-selected")}this.focusedIndex=-1,this.container.removeAttribute("aria-activedescendant")}destroy(){this.container.removeAttribute("role"),this.container.removeAttribute("aria-label"),this.container.removeAttribute("aria-activedescendant")}};function Ot(c,s="polite"){let e=document.createElement("div");e.setAttribute("role","status"),e.setAttribute("aria-live",s),e.setAttribute("aria-atomic","true"),e.classList.add("sr-only"),e.textContent=c,document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},1e3)}function Mt(){return[{shortcut:"\u2191/\u2193",description:"Navigate tasks"},{shortcut:"Home/End",description:"Jump to first/last task"},{shortcut:"Enter",description:"Open task in editor"},{shortcut:"Space",description:"Toggle task selection"},{shortcut:"Escape",description:"Clear selection"},{shortcut:"Ctrl+Shift+T",description:"Quick add task"},{shortcut:"/",description:"Focus search"},{shortcut:"?",description:"Show keyboard shortcuts"}]}var At=require("obsidian");var $e=class extends At.Modal{constructor(s){super(s)}onOpen(){let{contentEl:s}=this;s.addClass("keyboard-help-modal"),s.createEl("h2",{text:"Keyboard Shortcuts"});let e=s.createEl("ul",{cls:"keyboard-help-list"}),t=Mt();for(let{shortcut:a,description:r}of t){let o=e.createEl("li",{cls:"keyboard-help-item"});o.createEl("kbd",{text:a,cls:"keyboard-help-key"}),o.createEl("span",{text:r,cls:"keyboard-help-description"})}let i=s.createEl("button",{text:"Close",cls:"mod-cta",attr:{"aria-label":"Close keyboard shortcuts help"}});i.style.marginTop="16px",i.addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var se=require("obsidian"),de=class extends se.Modal{constructor(e,t){super(e);this.format="csv";this.filteredOnly=!1;this.plugin=t}onOpen(){this.modalEl.addClass("export-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Export Tasks"}),new se.Setting(e).setName("Format").addDropdown(i=>{i.addOption("csv","CSV"),i.addOption("json","JSON"),i.addOption("ical","iCal (.ics)"),i.setValue(this.format),i.onChange(a=>this.format=a)}),new se.Setting(e).setName("Export filtered tasks only").setDesc("Only export tasks matching current filters").addToggle(i=>{i.setValue(this.filteredOnly),i.onChange(a=>this.filteredOnly=a)});let t=e.createDiv({cls:"export-buttons"});t.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"Export",cls:"mod-cta"}).addEventListener("click",()=>{this.doExport()})}doExport(){let e=this.filteredOnly?this.plugin.taskCache.getFilteredTasks({owner:this.plugin.settings.filterOwner||void 0,project:this.plugin.settings.filterProject||void 0,stage:this.plugin.settings.filterStage||void 0}):this.plugin.taskCache.getAllTasks(),t,i,a;switch(this.format){case"csv":t=this.toCSV(e),i="tasks-export.csv",a="text/csv";break;case"json":t=this.toJSON(e),i="tasks-export.json",a="application/json";break;case"ical":t=this.toICal(e),i="tasks-export.ics",a="text/calendar";break}this.downloadBlob(t,i,a),new se.Notice(`Exported ${e.length} tasks as ${this.format.toUpperCase()}`),this.close()}toCSV(e){let t=["Text","Completed","Due Date","Owner","Project","Stage","Priority","Tags","File","Line"],i=e.map(a=>{var r,o,n,l,d;return[this.csvEscape(a.text),a.completed?"Yes":"No",(r=a.dueDate)!=null?r:"",(o=a.owner)!=null?o:"",(n=a.project)!=null?n:"",(l=a.stage)!=null?l:"",(d=a.priority)!=null?d:"",a.tags.join(";"),a.file.path,String(a.lineNumber)].join(",")});return[t.join(","),...i].join(`
`)}csvEscape(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}toJSON(e){let t=e.map(i=>({text:i.text,completed:i.completed,dueDate:i.dueDate,owner:i.owner,project:i.project,stage:i.stage,priority:i.priority,tags:i.tags,file:i.file.path,lineNumber:i.lineNumber,createdDate:i.createdDate,completedDate:i.completedDate,estimate:i.estimate,timeLogged:i.timeLogged}));return JSON.stringify(t,null,2)}toICal(e){let t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Task Consolidator//Obsidian//EN"];for(let i of e){if(!i.dueDate)continue;let a=i.dueDate.replace(/-/g,""),r=`${i.id.replace(/[^a-zA-Z0-9]/g,"-")}@task-consolidator`;t.push("BEGIN:VTODO"),t.push(`UID:${r}`),t.push(`SUMMARY:${this.icalEscape(i.text)}`),t.push(`DUE;VALUE=DATE:${a}`),i.completed?t.push("STATUS:COMPLETED"):t.push("STATUS:NEEDS-ACTION"),i.priority==="high"?t.push("PRIORITY:1"):i.priority==="medium"?t.push("PRIORITY:5"):i.priority==="low"&&t.push("PRIORITY:9"),i.project&&t.push(`CATEGORIES:${i.project}`),t.push("END:VTODO")}return t.push("END:VCALENDAR"),t.join(`\r
`)}icalEscape(e){return e.replace(/[\\;,]/g,t=>"\\"+t).replace(/\n/g,"\\n")}downloadBlob(e,t,i){let a=new Blob([e],{type:i}),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}};var ue=require("obsidian"),Ie=class extends ue.Modal{constructor(s,e,t){super(s),this.plugin=e,this.task=t}onOpen(){this.modalEl.addClass("comment-modal"),this.render()}onClose(){this.contentEl.empty()}render(){var r,o;let{contentEl:s}=this;s.empty(),s.createEl("h2",{text:"Task Comments"}),s.createEl("p",{text:this.task.text,cls:"comment-task-text"});let e=(o=(r=this.plugin.commentService)==null?void 0:r.getCommentsForTask(this.task.id))!=null?o:[],t=s.createDiv({cls:"comment-list"});if(e.length===0)t.createEl("p",{text:"No comments yet.",cls:"comment-empty"});else for(let n of e){let l=t.createDiv({cls:"comment-item"});l.createDiv({cls:"comment-text",text:n.text});let d=l.createDiv({cls:"comment-meta"});d.createSpan({text:new Date(n.timestamp).toLocaleString(),cls:"comment-date"}),d.createEl("button",{text:"\xD7",cls:"comment-delete"}).addEventListener("click",async()=>{var u;await((u=this.plugin.commentService)==null?void 0:u.deleteComment(this.task.id,n.id)),this.render()})}let i=s.createDiv({cls:"comment-add"}),a="";new ue.Setting(i).setName("Add Comment").addTextArea(n=>{n.setPlaceholder("Write a comment..."),n.onChange(l=>a=l)}),i.createEl("button",{text:"Add Comment",cls:"mod-cta"}).addEventListener("click",async()=>{var n;if(!a.trim()){new ue.Notice("Comment cannot be empty");return}await((n=this.plugin.commentService)==null?void 0:n.addComment(this.task.id,a.trim())),this.render()}),s.createEl("button",{text:"Close"}).addEventListener("click",()=>this.close())}};var me=class extends _.ItemView{constructor(e,t){super(e);this.filteredTasks=[];this.selectedTasks=new Set;this.keyboardHandler=null;this.taskListContainer=null;this.taskSectionContainer=null;this.liveRegion=null;this.headerRendered=!1;this.plugin=t,this.taskCache=t.taskCache,this.taskUpdater=t.taskUpdater}getViewType(){return K}getDisplayText(){return"Task Consolidator"}getIcon(){return"list-checks"}async onOpen(){this.containerEl.empty(),this.containerEl.addClass("task-consolidator-view"),this.liveRegion=this.containerEl.createDiv({cls:"sr-only",attr:{role:"status","aria-live":"polite","aria-atomic":"true"}}),this.setupGlobalKeyboardShortcuts(),await this.render()}async onClose(){this.selectedTasks.clear(),this.keyboardHandler&&(this.keyboardHandler.destroy(),this.keyboardHandler=null)}setupGlobalKeyboardShortcuts(){this.containerEl.addEventListener("keydown",e=>{var t;if(e.key===F.SLASH&&!this.isInputFocused()){e.preventDefault();let i=this.containerEl.querySelector(".task-search-input");i&&(i.focus(),this.announce("Search focused"))}if(e.key===F.QUESTION_MARK&&e.shiftKey&&!this.isInputFocused()&&(e.preventDefault(),this.showKeyboardHelp()),e.key===F.ESCAPE){let i=document.activeElement;(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.blur(),(t=this.taskListContainer)==null||t.focus())}})}isInputFocused(){let e=document.activeElement;return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement}announce(e){this.liveRegion&&(this.liveRegion.textContent=e,setTimeout(()=>{this.liveRegion&&(this.liveRegion.textContent="")},1e3)),Ot(e)}showKeyboardHelp(){new $e(this.app).open()}async refresh(){var t,i;if(!this.headerRendered){await this.render();return}let e=(i=(t=this.taskSectionContainer)==null?void 0:t.scrollTop)!=null?i:0;this.applyFilters(),this.taskSectionContainer&&(this.taskSectionContainer.empty(),this.renderTaskSectionsInto(this.taskSectionContainer),this.taskSectionContainer.scrollTop=e)}async render(){this.containerEl.empty(),this.headerRendered=!1,this.renderHeader(),this.renderControls(),this.renderFilters(),this.taskSectionContainer=this.containerEl.createDiv({cls:"task-sections-container"}),this.applyFilters(),this.renderTaskSectionsInto(this.taskSectionContainer),this.headerRendered=!0}renderHeader(){let t=this.containerEl.createDiv({cls:"task-consolidator-header"}).createDiv({cls:"task-header-title-row"});t.createEl("h4",{text:"All Tasks"});let i=this.taskCache.getTaskStats();t.createSpan({cls:"task-header-stats"}).setText(`${i.active} active, ${i.completed} completed`),i.overdue>0&&t.createSpan({cls:"task-header-overdue"}).setText(`${i.overdue} overdue`)}renderControls(){let e=this.containerEl.createDiv({cls:"task-consolidator-controls"});e.createSpan({text:"Sort: "});let t=e.createEl("select",{cls:"dropdown"});for(let a of ve){let r=t.createEl("option",{text:q(a),value:a});a===this.plugin.settings.sortBy&&(r.selected=!0)}t.addEventListener("change",async()=>{this.plugin.settings.sortBy=t.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Group: "});let i=e.createEl("select",{cls:"dropdown"});for(let a of ye){let r=i.createEl("option",{text:q(a),value:a});a===this.plugin.settings.groupBy&&(r.selected=!0)}if(i.addEventListener("change",async()=>{this.plugin.settings.groupBy=i.value,await this.plugin.saveSettings(),await this.refresh()}),e.createEl("button",{text:"\u21BB Refresh",attr:{"aria-label":"Refresh tasks"}}).addEventListener("click",async()=>{await this.plugin.refreshTasks(),await this.refresh(),new _.Notice("Tasks refreshed")}),e.createEl("button",{text:"+ Add Task",cls:"task-add-btn",attr:{"aria-label":"Add new task"}}).addEventListener("click",()=>{this.plugin.openQuickAdd()}),e.createEl("button",{text:"Kanban",cls:"kanban-btn",attr:{"aria-label":"Open Kanban board"}}).addEventListener("click",()=>{this.plugin.openKanban()}),e.createEl("button",{text:"Calendar",cls:"calendar-btn",attr:{"aria-label":"Open Calendar view"}}).addEventListener("click",()=>{this.plugin.openCalendar()}),this.plugin.settings.enableDailyNoteIntegration&&this.plugin.settings.showDailyNoteButton&&e.createEl("button",{text:"Daily Note",cls:"daily-note-btn",attr:{"aria-label":"Open today's daily note"}}).addEventListener("click",()=>{this.plugin.openDailyNote()}),e.createEl("button",{text:"Dashboard",cls:"dashboard-btn",attr:{"aria-label":"Open Project Dashboard"}}).addEventListener("click",()=>{this.plugin.openProjectDashboard()}),e.createEl("button",{text:"Export",cls:"export-btn",attr:{"aria-label":"Export tasks"}}).addEventListener("click",()=>{new de(this.app,this.plugin).open()}),e.createEl("button",{text:"?",cls:"task-help-btn",attr:{"aria-label":"Show keyboard shortcuts"}}).addEventListener("click",()=>{this.showKeyboardHelp()}),this.plugin.settings.workspaces.length>0){let a=e.createDiv({cls:"workspace-selector"});a.createSpan({text:"View: "});let r=a.createEl("select",{cls:"dropdown"});r.createEl("option",{text:"Default",value:""});for(let o of this.plugin.settings.workspaces){let n=r.createEl("option",{text:o.name,value:o.id});o.id===this.plugin.settings.activeWorkspaceId&&(n.selected=!0)}r.addEventListener("change",async()=>{let o=r.value;if(this.plugin.settings.activeWorkspaceId=o,o){let n=this.plugin.settings.workspaces.find(l=>l.id===o);n&&(this.plugin.settings.sortBy=n.sortBy,this.plugin.settings.groupBy=n.groupBy,this.plugin.settings.showCompleted=n.showCompleted,this.plugin.settings.filterOwner=n.filterOwner,this.plugin.settings.filterProject=n.filterProject,this.plugin.settings.filterStage=n.filterStage,this.plugin.settings.filterPriority=n.filterPriority,this.plugin.settings.filterDueDate=n.filterDueDate,this.plugin.settings.filterTags=n.filterTags,this.plugin.settings.searchQuery=n.searchQuery)}await this.plugin.saveSettings(),await this.render()})}}renderFilters(){let e=this.containerEl.createDiv({cls:"task-consolidator-filters"}),t=e.createDiv({cls:"task-search-container"}),i=t.createEl("input",{type:"text",placeholder:"Search tasks...",cls:"task-search-input",value:this.plugin.settings.searchQuery});if(i.addEventListener("input",async()=>{this.plugin.settings.searchQuery=i.value,await this.plugin.saveSettings(),await this.refresh()}),this.plugin.settings.searchQuery&&t.createEl("button",{text:"\u{1F4BE}",cls:"save-filter-btn",attr:{"aria-label":"Save current search as filter"}}).addEventListener("click",async()=>{let d=this.plugin.settings.searchQuery.substring(0,30),u=Date.now().toString(36);this.plugin.settings.savedFilters.push({id:u,name:d,query:this.plugin.settings.searchQuery}),await this.plugin.saveSettings(),await this.render(),new _.Notice("Filter saved")}),this.plugin.settings.savedFilters.length>0){let d=e.createDiv({cls:"saved-filter-chips"});for(let u of this.plugin.settings.savedFilters){let g=d.createEl("button",{text:u.name,cls:`saved-filter-chip ${u.query===this.plugin.settings.searchQuery?"active":""}`,attr:{"aria-label":`Apply filter: ${u.name}`}});g.addEventListener("click",async()=>{this.plugin.settings.searchQuery=u.query,await this.plugin.saveSettings(),await this.render()}),g.createSpan({text:" \xD7",cls:"saved-filter-delete"}).addEventListener("click",async h=>{h.stopPropagation(),this.plugin.settings.savedFilters=this.plugin.settings.savedFilters.filter(b=>b.id!==u.id),await this.plugin.saveSettings(),await this.render()})}}e.createSpan({text:"Owner: "});let a=e.createEl("select",{cls:"dropdown"});a.createEl("option",{text:"All",value:""});for(let d of this.taskCache.getUniqueOwners()){let u=a.createEl("option",{text:d,value:d});d===this.plugin.settings.filterOwner&&(u.selected=!0)}a.addEventListener("change",async()=>{this.plugin.settings.filterOwner=a.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Project: "});let r=e.createEl("select",{cls:"dropdown"});r.createEl("option",{text:"All",value:""});for(let d of this.taskCache.getUniqueProjects()){let u=r.createEl("option",{text:d,value:d});d===this.plugin.settings.filterProject&&(u.selected=!0)}r.addEventListener("change",async()=>{this.plugin.settings.filterProject=r.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Stage: "});let o=e.createEl("select",{cls:"dropdown"});o.createEl("option",{text:"All",value:""});for(let d of A){let u=o.createEl("option",{text:d,value:d});d===this.plugin.settings.filterStage&&(u.selected=!0)}o.addEventListener("change",async()=>{this.plugin.settings.filterStage=o.value,await this.plugin.saveSettings(),await this.refresh()});let n=this.containerEl.createDiv({cls:"task-quick-filters"}),l=this.taskCache.getTaskStats();n.createEl("button",{text:`Today (${l.dueToday})`,cls:"quick-filter-btn"}).addEventListener("click",async()=>{this.plugin.settings.filterDueDate="today",await this.plugin.saveSettings(),await this.refresh()}),n.createEl("button",{text:`Overdue (${l.overdue})`,cls:"quick-filter-btn overdue"}).addEventListener("click",async()=>{this.plugin.settings.filterDueDate="overdue",await this.plugin.saveSettings(),await this.refresh()}),n.createEl("button",{text:"Clear Filters",cls:"quick-filter-btn clear"}).addEventListener("click",async()=>{this.plugin.settings.filterOwner="",this.plugin.settings.filterProject="",this.plugin.settings.filterStage="",this.plugin.settings.filterDueDate="",this.plugin.settings.searchQuery="",await this.plugin.saveSettings(),await this.refresh()})}applyFilters(){let e=this.taskCache.getAllTasks(),t=this.plugin.settings;if(t.searchQuery){let i=Nt(t.searchQuery);if(i){if(i.owner&&(e=e.filter(a=>{var r;return((r=a.owner)==null?void 0:r.toLowerCase())===i.owner.toLowerCase()})),i.project&&(e=e.filter(a=>{var r;return((r=a.project)==null?void 0:r.toLowerCase())===i.project.toLowerCase()})),i.stage&&(e=e.filter(a=>{var r;return((r=a.stage)==null?void 0:r.toLowerCase())===i.stage.toLowerCase()})),i.priority&&(e=e.filter(a=>a.priority===i.priority)),i.tags&&i.tags.length>0&&(e=e.filter(a=>i.tags.every(r=>a.tags.includes(r)))),i.filePath){let a=i.filePath.toLowerCase();e=e.filter(r=>r.file.path.toLowerCase().includes(a))}if(i.dueDateFilter==="today"?e=e.filter(a=>I(a.dueDate)):i.dueDateFilter==="thisWeek"?e=e.filter(a=>a.dueDate!=null):i.dueDateFilter==="overdue"?e=e.filter(a=>E(a.dueDate)&&!a.completed):i.dueDateFilter==="noDueDate"&&(e=e.filter(a=>!a.dueDate)),i.dueDate&&(e=e.filter(a=>a.dueDate===i.dueDate)),i.searchText){let a=i.searchText.toLowerCase();e=e.filter(r=>{var o,n;return r.text.toLowerCase().includes(a)||((o=r.owner)==null?void 0:o.toLowerCase().includes(a))||((n=r.project)==null?void 0:n.toLowerCase().includes(a))||r.tags.some(l=>l.toLowerCase().includes(a))})}}}t.filterOwner&&(e=e.filter(i=>i.owner===t.filterOwner)),t.filterProject&&(e=e.filter(i=>i.project===t.filterProject)),t.filterStage&&(e=e.filter(i=>i.stage===t.filterStage)),t.filterDueDate==="today"?e=e.filter(i=>I(i.dueDate)):t.filterDueDate==="overdue"?e=e.filter(i=>E(i.dueDate)&&!i.completed):t.filterDueDate&&(e=e.filter(i=>i.dueDate===t.filterDueDate)),t.filterPriority&&(e=e.filter(i=>i.priority===t.filterPriority)),this.filteredTasks=e}renderTaskSectionsInto(e){this.keyboardHandler&&(this.keyboardHandler.destroy(),this.keyboardHandler=null);let t=this.filteredTasks.filter(d=>!d.completed),i=this.filteredTasks.filter(d=>d.completed),a=this.sortTasks(t),r=this.sortTasks(i),o=e.createDiv({cls:"task-section"});if(o.createEl("h5",{text:`Active Tasks (${a.length})`,attr:{id:"active-tasks-heading"}}),a.length===0)o.createEl("p",{text:"No active tasks found",cls:"task-empty"});else if(this.plugin.settings.groupBy!=="none"){let d=this.groupTasks(a);this.renderGroupedTasks(o,d,"active")}else{let d=o.createDiv({cls:"task-list",attr:{role:"listbox","aria-labelledby":"active-tasks-heading",tabindex:"0"}});this.taskListContainer=d;for(let u of a)this.renderTask(d,u);this.setupKeyboardNavigation(d)}let n=e.createDiv({cls:"task-section"}),l=n.createDiv({cls:"task-section-header"});if(l.createEl("span",{text:this.plugin.settings.showCompleted?"\u25BC":"\u25B6",cls:"task-section-toggle"}),l.createEl("h5",{text:`Completed Tasks (${r.length})`,cls:"task-section-title"}),l.addEventListener("click",async()=>{this.plugin.settings.showCompleted=!this.plugin.settings.showCompleted,await this.plugin.saveSettings(),await this.refresh()}),this.plugin.settings.showCompleted&&r.length>0)if(this.plugin.settings.groupBy!=="none"){let d=this.groupTasks(r);this.renderGroupedTasks(n,d,"completed")}else{let d=n.createDiv({cls:"task-list"});for(let u of r)this.renderTask(d,u)}}sortTasks(e){let t=[...e],i=this.plugin.settings.sortBy;return t.sort((a,r)=>{var o,n;switch(i){case"dueDate":return oe(a.dueDate,r.dueDate);case"owner":return!a.owner&&!r.owner?0:a.owner?r.owner?a.owner.localeCompare(r.owner):-1:1;case"priority":{let l={high:0,medium:1,low:2},d=a.priority?l[a.priority]:3,u=r.priority?l[r.priority]:3;return d-u}case"project":return!a.project&&!r.project?0:a.project?r.project?a.project.localeCompare(r.project):-1:1;case"created":return oe(a.createdDate,r.createdDate);case"stage":{let l=A.reduce((g,p,h)=>({...g,[p]:h}),{}),d=a.stage&&(o=l[a.stage])!=null?o:99,u=r.stage&&(n=l[r.stage])!=null?n:99;return d-u}default:return 0}}),t}groupTasks(e){var a,r,o,n,l;let t=new Map,i=this.plugin.settings.groupBy;for(let d of e){let u;switch(i){case"dueDate":u=(a=d.dueDate)!=null?a:"No Date";break;case"owner":u=(r=d.owner)!=null?r:"No Owner";break;case"project":u=(o=d.project)!=null?o:"No Project";break;case"stage":u=(n=d.stage)!=null?n:"Unassigned";break;case"priority":u=(l=d.priority)!=null?l:"No Priority";break;default:u="All"}t.has(u)||t.set(u,[]),t.get(u).push(d)}return t}renderGroupedTasks(e,t,i){var r;let a=this.plugin.settings.groupBy;for(let[o,n]of t){let l=`${i}-${o}`,d=(r=this.plugin.settings.collapsedGroups[l])!=null?r:!1,u=e.createDiv({cls:"task-group"}),g=u.createDiv({cls:"task-group-header"});g.createEl("span",{text:d?"\u25B6":"\u25BC",cls:"task-group-toggle"});let p=mt[a];if(g.createEl("span",{text:`${p} ${o} (${n.length})`,cls:"task-group-title"}),g.addEventListener("click",async()=>{this.plugin.settings.collapsedGroups[l]=!d,await this.plugin.saveSettings(),await this.refresh()}),!d){let h=u.createDiv({cls:"task-list"});for(let b of n)this.renderTask(h,b)}}}renderTask(e,t){var h,b;let i=e.createDiv({cls:"task-item",attr:{role:"option","aria-selected":"false",tabindex:"-1"}});E(t.dueDate)&&!t.completed&&i.addClass("overdue"),I(t.dueDate)&&!t.completed&&i.addClass("due-today"),t.priority&&i.addClass(`priority-${t.priority}`);let a=[t.text];if(t.priority&&a.push(`Priority: ${t.priority}`),t.dueDate){let v=ee(t.dueDate);a.push(`Due: ${v}`),E(t.dueDate)&&!t.completed&&a.push("Overdue")}t.owner&&a.push(`Owner: ${t.owner}`),t.project&&a.push(`Project: ${t.project}`),i.setAttribute("aria-label",a.join(", "));let r=i.createEl("input",{type:"checkbox",attr:{"aria-label":`Toggle task: ${t.text}`}});r.checked=t.completed,r.addEventListener("change",async()=>{let v=await this.taskUpdater.toggleTask(t);v.success?(new _.Notice(t.completed?"Task unchecked":"Task checked"),await this.plugin.refreshTasks(),await this.refresh()):(new _.Notice(`Error: ${v.error}`),r.checked=t.completed)});let o=i.createDiv({cls:"task-content"}),n=o.createDiv({cls:"task-text"});n.setText(t.text),t.completed&&n.addClass("task-completed");let l=o.createDiv({cls:"task-metadata"});if(t.priority&&l.createSpan({text:`${ne[t.priority]} ${t.priority}`,cls:`task-priority priority-${t.priority}`}),t.dueDate){let v=ee(t.dueDate),k=l.createSpan({text:`\u{1F4C5} ${v}`,cls:"task-due-date"});E(t.dueDate)&&!t.completed&&k.addClass("overdue")}t.owner&&l.createSpan({text:`\u{1F464} ${t.owner}`,cls:"task-owner"}),t.project&&l.createSpan({text:`\u{1F4C1} ${t.project}`,cls:"task-project"}),t.stage&&l.createSpan({text:`\u{1F4CB} ${t.stage}`,cls:"task-stage"});let d=Dt(t);if(d&&l.createSpan({text:`\u{1F4CA} ${d.completed}/${d.total}`,cls:"task-subtask-progress",attr:{"aria-label":`${d.completed} of ${d.total} subtasks completed`}}),this.plugin.settings.enableTimeTracking&&(t.estimate&&l.createSpan({text:`\u23F1 ${t.estimate}`,cls:"task-estimate",attr:{"aria-label":`Estimate: ${t.estimate}`}}),t.timeLogged&&l.createSpan({text:`\u23F0 ${t.timeLogged}`,cls:"task-time-logged",attr:{"aria-label":`Logged: ${t.timeLogged}`}})),t.recurrence&&l.createSpan({text:"\u{1F504}",cls:"task-recurring",attr:{title:"Recurring task"}}),this.plugin.settings.enableComments){let v=(b=(h=this.plugin.commentService)==null?void 0:h.getCommentsForTask(t.id))!=null?b:[];v.length>0&&l.createSpan({text:`\u{1F4AC} ${v.length}`,cls:"task-comment-count",attr:{"aria-label":`${v.length} comments`}}).addEventListener("click",k=>{k.stopPropagation(),new Ie(this.app,this.plugin,t).open()})}let u=this.taskCache.getFilteredTasks({}),g=tt(u),p=ce(t,u,g);if(p.isBlocked){let v=p.blockedByTasks.map(k=>et(k)).join(", ");i.addClass("task-blocked"),l.createSpan({text:`\u{1F6AB} Blocked (${p.blockedByCount})`,cls:"task-dependency task-blocked-indicator",attr:{title:`Blocked by: ${v}`}})}if(p.blocksCount>0&&!t.completed){let v=p.blocksTasks.map(k=>et(k)).join(", ");i.addClass("task-blocker"),l.createSpan({text:`\u23F3 Blocks (${p.blocksCount})`,cls:"task-dependency task-blocker-indicator",attr:{title:`Blocks: ${v}`}})}if(t.tags.length>0){let v=l.createDiv({cls:"task-tags"});for(let k of t.tags)v.createSpan({text:`#${k}`,cls:"task-tag"})}l.createEl("a",{text:`\u{1F4C4} ${t.file.basename}`,cls:"task-file-link",attr:{"aria-label":`Open ${t.file.name}`}}).addEventListener("click",async v=>{v.preventDefault(),await te(this.app,t)})}setupKeyboardNavigation(e){this.keyboardHandler=new Le(e,{itemSelector:".task-item",onSelect:async(t,i)=>{let a=this.filteredTasks.filter(r=>!r.completed)[i];if(a){let r=await this.taskUpdater.toggleTask(a);if(r.success){let o=a.completed?"unchecked":"checked";this.announce(`Task ${o}: ${a.text}`),new _.Notice(`Task ${o}`),await this.plugin.refreshTasks(),await this.refresh()}else new _.Notice(`Error: ${r.error}`)}},onActivate:async(t,i)=>{let a=this.filteredTasks.filter(r=>!r.completed)[i];a&&(this.announce(`Opening task: ${a.text}`),await te(this.app,a))}})}};var Y=require("obsidian");var je=class extends Y.Modal{constructor(s,e){super(s),this.plugin=e,this.taskCache=e.taskCache,this.taskUpdater=e.taskUpdater,this.settings=e.settings,this.filteredProject=this.settings.kanbanFilterProject}onOpen(){let{contentEl:s,modalEl:e}=this;e.addClass("kanban-modal"),s.addClass("kanban-modal-content"),this.renderHeader(s),this.renderBoard(s)}onClose(){let{contentEl:s}=this;s.empty()}renderHeader(s){let e=s.createDiv({cls:"kanban-header"});e.createEl("h2",{text:"Kanban Board"});let t=e.createDiv({cls:"kanban-filter"});t.createSpan({text:"Project: "});let i=t.createEl("select");i.createEl("option",{text:"All Projects",value:""});let a=this.taskCache.getUniqueProjects();for(let r of a){let o=i.createEl("option",{text:r,value:r});r===this.filteredProject&&(o.selected=!0)}i.addEventListener("change",async()=>{this.filteredProject=i.value,this.settings.kanbanFilterProject=this.filteredProject,await this.plugin.saveSettings(),this.refreshBoard()}),e.createEl("button",{text:"\u2715 Close",cls:"kanban-close-btn"}).addEventListener("click",()=>this.close())}renderBoard(s){let e=s.querySelector(".kanban-board");e&&e.remove();let t=s.createDiv({cls:"kanban-board"});for(let i of ie)this.renderColumn(t,i)}renderColumn(s,e){var o;let t=s.createDiv({cls:"kanban-column"});t.dataset.stage=(o=e.stage)!=null?o:"unassigned";let i=this.getTasksForColumn(e);t.createDiv({cls:"kanban-column-header"}).createEl("h3",{text:`${e.title} (${i.length})`});let r=t.createDiv({cls:"kanban-column-body"});this.setupDropZone(r,e.stage);for(let n of i)this.renderTaskCard(r,n)}getTasksForColumn(s){let e=this.taskCache.getAllTasks();this.filteredProject&&(e=e.filter(i=>i.project===this.filteredProject));let t;return s.stage===null?t=e.filter(i=>!i.stage&&!i.completed):s.stage==="Completed"?t=e.filter(i=>i.completed||i.stage==="Completed"):t=e.filter(i=>i.stage===s.stage&&!i.completed),s.stage==="Completed"?t.sort((i,a)=>oe(a.completedDate,i.completedDate)):t.sort((i,a)=>oe(i.dueDate,a.dueDate)),t}renderTaskCard(s,e){let t=s.createDiv({cls:"kanban-card"});t.draggable=!0,t.dataset.filePath=e.file.path,t.dataset.lineNumber=String(e.lineNumber);let i=[e.text,e.owner?`Owner: ${e.owner}`:"",e.dueDate?`Due: ${e.dueDate}`:"",e.priority?`Priority: ${e.priority}`:""].filter(Boolean).join(", ");t.setAttribute("aria-label",i),t.setAttribute("role","article"),E(e.dueDate)&&!e.completed&&t.addClass("overdue"),e.priority&&t.addClass(`priority-${e.priority}`),t.createDiv({cls:"kanban-card-title"}).setText(e.text);let a=t.createDiv({cls:"kanban-card-meta"});if(e.priority&&a.createSpan({cls:"kanban-card-priority",text:ne[e.priority],attr:{"aria-label":`Priority: ${e.priority}`}}),e.owner&&a.createSpan({cls:"kanban-card-owner",text:`\u{1F464} ${e.owner}`,attr:{"aria-label":`Owner: ${e.owner}`}}),e.dueDate){let n=ee(e.dueDate),l=a.createSpan({cls:"kanban-card-date",text:`\u{1F4C5} ${n}`});E(e.dueDate)&&!e.completed&&l.addClass("overdue")}e.project&&a.createSpan({cls:"kanban-card-project",text:`\u{1F4C1} ${e.project}`}),e.recurrence&&a.createSpan({cls:"kanban-card-recurring",text:"\u{1F504}",attr:{"aria-label":"Recurring task"}}),a.createEl("a",{cls:"kanban-card-file",text:`\u{1F4C4} ${e.file.basename}`}).addEventListener("click",n=>{n.stopPropagation(),this.openTask(e)});let r=t.createDiv({cls:"kanban-card-actions"}),o=ie.findIndex(n=>{var l;return n.stage===((l=e.stage)!=null?l:null)});if(o>0){let n=ie[o-1];r.createEl("button",{cls:"kanban-move-btn",text:`\u2190 ${n.title}`,attr:{"aria-label":`Move to ${n.title}`}}).addEventListener("click",d=>{d.stopPropagation(),this.moveTaskToStage(e,n.stage)})}if(o<ie.length-1){let n=ie[o+1];r.createEl("button",{cls:"kanban-move-btn",text:`${n.title} \u2192`,attr:{"aria-label":`Move to ${n.title}`}}).addEventListener("click",d=>{d.stopPropagation(),this.moveTaskToStage(e,n.stage)})}this.setupDragEvents(t,e)}setupDragEvents(s,e){s.addEventListener("dragstart",t=>{var i;s.classList.add("dragging"),(i=t.dataTransfer)==null||i.setData("text/plain",JSON.stringify({filePath:e.file.path,lineNumber:e.lineNumber,taskId:e.id})),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}),s.addEventListener("dragend",()=>{s.classList.remove("dragging"),this.contentEl.querySelectorAll(".drag-over").forEach(t=>{t.classList.remove("drag-over")})})}setupDropZone(s,e){s.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move"),s.classList.add("drag-over")}),s.addEventListener("dragleave",t=>{s.contains(t.relatedTarget)||s.classList.remove("drag-over")}),s.addEventListener("drop",async t=>{var i,a;t.preventDefault(),s.classList.remove("drag-over");try{let r=JSON.parse((a=(i=t.dataTransfer)==null?void 0:i.getData("text/plain"))!=null?a:"{}"),o=this.taskCache.getAllTasks().find(l=>l.id===r.taskId);if(!o){new Y.Notice("Task not found");return}let n=await this.taskUpdater.updateTaskStage(o,e);n.success?(new Y.Notice(`Task moved to ${e!=null?e:"Unassigned"}`),await this.plugin.refreshTasks(),this.refreshBoard()):new Y.Notice(`Error: ${n.error}`)}catch(r){console.error("Error handling drop:",r),new Y.Notice("Error moving task")}})}async moveTaskToStage(s,e){let t=await this.taskUpdater.updateTaskStage(s,e);t.success?(new Y.Notice(`Task moved to ${e!=null?e:"Unassigned"}`),await this.plugin.refreshTasks(),this.refreshBoard()):new Y.Notice(`Error: ${t.error}`)}refreshBoard(){this.renderBoard(this.contentEl)}async openTask(s){await te(this.app,s),this.close()}};var C=require("obsidian");var pe=require("obsidian");function Lt(c,s){let e=c.getFullYear().toString(),t=(c.getMonth()+1).toString(),i=c.getDate().toString(),a=t.padStart(2,"0"),r=i.padStart(2,"0");return s.replace("YYYY",e).replace("MM",a).replace("DD",r).replace("M",t).replace("D",i)}function ss(c,s){let e=Lt(c,s.dailyNoteDateFormat),t=s.dailyNoteFolder.trim();return t?(0,pe.normalizePath)(`${t}/${e}.md`):(0,pe.normalizePath)(`${e}.md`)}async function st(c,s,e){let t=ss(s,e),i=c.vault.getAbstractFileByPath(t);if(i instanceof pe.TFile)return i;let a=e.dailyNoteFolder.trim();if(a){let n=(0,pe.normalizePath)(a);c.vault.getAbstractFileByPath(n)||await c.vault.createFolder(n)}let o=`# ${Lt(s,e.dailyNoteDateFormat)}

${e.dailyNoteTasksHeading}

`;return await c.vault.create(t,o)}function is(c,s){let e=c.split(`
`),t=s.trim().toLowerCase();for(let i=0;i<e.length;i++)if(e[i].trim().toLowerCase()===t)return i;return-1}async function $t(c,s,e,t){let i=await st(c,s,t),a=await c.vault.read(i),r=a.split(`
`),o=is(a,t.dailyNoteTasksHeading),n;if(o===-1)n=a.trim()+`

`+t.dailyNoteTasksHeading+`
- [ ] `+e+`
`;else{let l=o+1;for(;l<r.length&&r[l].trim()==="";)l++;r.splice(l,0,"- [ ] "+e),n=r.join(`
`)}return await c.vault.modify(i,n),i}var L=require("obsidian");var Re=class extends L.Modal{constructor(e,t){super(e);this.editingTemplate=null;this.plugin=t}onOpen(){this.modalEl.addClass("template-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Task Templates"});let t=this.plugin.settings.taskTemplates;if(t.length===0&&!this.editingTemplate&&e.createEl("p",{text:"No templates yet. Create one below.",cls:"template-empty"}),this.editingTemplate)this.renderEditor(e,this.editingTemplate);else{let i=e.createDiv({cls:"template-list"});for(let a of t){let r=i.createDiv({cls:"template-item"});r.createDiv({cls:"template-name",text:a.name}),r.createDiv({cls:"template-preview",text:a.text});let o=r.createDiv({cls:"template-actions"});o.createEl("button",{text:"Edit"}).addEventListener("click",()=>{this.editingTemplate={...a},this.render()}),o.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",async()=>{this.plugin.settings.taskTemplates=t.filter(n=>n.id!==a.id),await this.plugin.saveSettings(),this.render()})}e.createEl("button",{text:"+ New Template",cls:"mod-cta"}).addEventListener("click",()=>{this.editingTemplate={id:Date.now().toString(36),name:"",text:"",owner:"",project:"",stage:"",priority:"",tags:[],variables:[]},this.render()})}e.createEl("button",{text:"Close",cls:"template-close-btn"}).addEventListener("click",()=>this.close())}renderEditor(e,t){let i=e.createDiv({cls:"template-editor"});i.createEl("h3",{text:t.id?"Edit Template":"New Template"}),new L.Setting(i).setName("Name").addText(r=>{r.setValue(t.name).onChange(o=>t.name=o)}),new L.Setting(i).setName("Task Text").setDesc("Use ${var} for variables").addTextArea(r=>{r.setValue(t.text).onChange(o=>{t.text=o;let n=[...o.matchAll(/\$\{(\w+)\}/g)].map(l=>l[1]);t.variables=[...new Set(n)]})}),new L.Setting(i).setName("Owner").addText(r=>{r.setValue(t.owner).onChange(o=>t.owner=o)}),new L.Setting(i).setName("Project").addText(r=>{r.setValue(t.project).onChange(o=>t.project=o)}),new L.Setting(i).setName("Stage").addDropdown(r=>{r.addOption("","None");for(let o of A)r.addOption(o,o);r.setValue(t.stage).onChange(o=>t.stage=o)}),new L.Setting(i).setName("Priority").addDropdown(r=>{r.addOption("","None");for(let o of H)r.addOption(o,o.charAt(0).toUpperCase()+o.slice(1));r.setValue(t.priority).onChange(o=>t.priority=o)}),new L.Setting(i).setName("Tags").setDesc("Comma-separated").addText(r=>{r.setValue(t.tags.join(", ")).onChange(o=>{t.tags=o.split(",").map(n=>n.trim()).filter(n=>n)})}),t.variables.length>0&&i.createEl("p",{text:`Variables detected: ${t.variables.map(r=>"${"+r+"}").join(", ")}`,cls:"template-vars-info"});let a=i.createDiv({cls:"template-editor-buttons"});a.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.editingTemplate=null,this.render()}),a.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",async()=>{if(!t.name.trim()){new L.Notice("Template name is required");return}let r=this.plugin.settings.taskTemplates.findIndex(o=>o.id===t.id);r>=0?this.plugin.settings.taskTemplates[r]=t:this.plugin.settings.taskTemplates.push(t),await this.plugin.saveSettings(),this.editingTemplate=null,this.render(),new L.Notice("Template saved")})}},Fe=class extends L.Modal{constructor(e,t,i){super(e);this.values={};this.variables=t,this.resolve=i}onOpen(){let{contentEl:e}=this;e.createEl("h3",{text:"Fill Template Variables"});for(let i of this.variables)new L.Setting(e).setName(i).addText(a=>{a.setPlaceholder(`Enter ${i}...`).onChange(r=>this.values[i]=r)});let t=e.createDiv({cls:"template-var-buttons"});t.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.resolve(null),this.close()}),t.createEl("button",{text:"Apply",cls:"mod-cta"}).addEventListener("click",()=>{this.resolve(this.values),this.close()})}onClose(){this.contentEl.empty()}};var ke=class extends C.Modal{constructor(e,t,i={}){var a;super(e);this.taskText="";this.selectedOwner="";this.selectedDueDate="";this.selectedProject="";this.selectedStage="";this.selectedPriority="";this.selectedTags=[];this.selectedFile=null;this.useQuickSyntax=!0;this.targetDailyNote=!1;if(this.plugin=t,this.taskCache=t.taskCache,this.taskUpdater=t.taskUpdater,this.settings=t.settings,this.options=i,this.targetDailyNote=(a=i.targetDailyNote)!=null?a:!1,this.selectedOwner=this.settings.defaultOwner,this.selectedProject=this.settings.defaultProject,this.targetDailyNote)this.selectedDueDate=new Date().toISOString().split("T")[0];else if(this.settings.defaultTargetFile){let r=this.app.vault.getAbstractFileByPath(this.settings.defaultTargetFile);r instanceof C.TFile&&(this.selectedFile=r)}}onOpen(){this.modalEl.addClass("quick-add-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty();let t=this.targetDailyNote?"Add Task to Daily Note":"Quick Add Task";e.createEl("h2",{text:t});let i=this.plugin.settings.taskTemplates;i.length>0&&new C.Setting(e).setName("From Template").addDropdown(n=>{n.addOption("","None");for(let l of i)n.addOption(l.id,l.name);n.onChange(async l=>{if(!l)return;let d=i.find(u=>u.id===l);d&&await this.applyTemplate(d)})}),new C.Setting(e).setName("Quick Syntax Mode").setDesc("Use @owner, #project, !date, ^priority, +tag in the task text").addToggle(n=>n.setValue(this.useQuickSyntax).onChange(l=>{this.useQuickSyntax=l,this.render()}));let a=e.createDiv({cls:"quick-add-input-container"}),r=a.createEl("textarea",{cls:"quick-add-task-input",placeholder:this.useQuickSyntax?"Buy groceries @John !tomorrow #personal ^high +shopping":"Enter task description..."});if(r.value=this.taskText,r.addEventListener("input",()=>{this.taskText=r.value,this.useQuickSyntax&&(this.parseQuickSyntax(),this.updatePreview())}),this.plugin.settings.enableSmartSuggestions){let n=this.plugin.suggestionService.getSuggestionsForContext(this.selectedProject||void 0),l=a.createDiv({cls:"suggestion-chips"});if(n.owners.length>0&&!this.selectedOwner)for(let d of n.owners.slice(0,3))l.createEl("button",{text:`\u{1F464} ${d.value}`,cls:"suggestion-chip"}).addEventListener("click",()=>{this.selectedOwner=d.value,this.render()});if(n.tags.length>0)for(let d of n.tags.slice(0,3))this.selectedTags.includes(d.value)||l.createEl("button",{text:`#${d.value}`,cls:"suggestion-chip"}).addEventListener("click",()=>{this.selectedTags.push(d.value),this.render()})}if(setTimeout(()=>r.focus(),50),this.useQuickSyntax){let n=e.createDiv({cls:"quick-add-preview"});n.id="quick-add-preview",this.updatePreview()}this.useQuickSyntax||this.renderExpandedFields(e),this.targetDailyNote?e.createDiv({cls:"quick-add-daily-note-info"}).createEl("p",{text:"Task will be added to today's daily note",cls:"setting-item-description"}):new C.Setting(e).setName("Target File").setDesc("File where the task will be created").addDropdown(n=>{n.addOption("","Select a file...");let l=this.app.vault.getMarkdownFiles().sort((d,u)=>d.path.localeCompare(u.path));for(let d of l)n.addOption(d.path,d.path);this.selectedFile&&n.setValue(this.selectedFile.path),n.onChange(d=>{let u=this.app.vault.getAbstractFileByPath(d);this.selectedFile=u instanceof C.TFile?u:null})});let o=e.createDiv({cls:"quick-add-buttons"});o.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),o.createEl("button",{text:"Create Task",cls:"mod-cta"}).addEventListener("click",()=>void this.createTask()),r.addEventListener("keydown",n=>{n.key==="Enter"&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),this.createTask())})}renderExpandedFields(e){new C.Setting(e).setName("Owner").addDropdown(t=>{t.addOption("","None");for(let i of this.taskCache.getUniqueOwners())t.addOption(i,i);t.setValue(this.selectedOwner),t.onChange(i=>this.selectedOwner=i)}).addText(t=>t.setPlaceholder("Or enter new...").onChange(i=>{i&&(this.selectedOwner=i)})),new C.Setting(e).setName("Due Date").addText(t=>t.setPlaceholder('YYYY-MM-DD or "tomorrow"').setValue(this.selectedDueDate).onChange(i=>{if(!i.trim()){this.selectedDueDate="";return}let a=fe(i);a&&(this.selectedDueDate=a)})),new C.Setting(e).setName("Project").addDropdown(t=>{t.addOption("","None");for(let i of this.taskCache.getUniqueProjects())t.addOption(i,i);t.setValue(this.selectedProject),t.onChange(i=>this.selectedProject=i)}).addText(t=>t.setPlaceholder("Or enter new...").onChange(i=>{i&&(this.selectedProject=i)})),new C.Setting(e).setName("Stage").addDropdown(t=>{t.addOption("","None");for(let i of A)t.addOption(i,i);t.setValue(this.selectedStage),t.onChange(i=>this.selectedStage=i)}),new C.Setting(e).setName("Priority").addDropdown(t=>{t.addOption("","None");for(let i of H)t.addOption(i,i.charAt(0).toUpperCase()+i.slice(1));t.setValue(this.selectedPriority),t.onChange(i=>this.selectedPriority=i)}),new C.Setting(e).setName("Tags").setDesc("Comma-separated tags").addText(t=>t.setPlaceholder("tag1, tag2, tag3").setValue(this.selectedTags.join(", ")).onChange(i=>{this.selectedTags=i.split(",").map(a=>a.trim().replace(/^#/,"")).filter(a=>a.length>0)}))}parseQuickSyntax(){let e=this.taskText,t=e.match(P.OWNER);t&&(this.selectedOwner=t[1].trim(),e=e.replace(P.OWNER,""));let i=e.match(P.PROJECT);i&&(this.selectedProject=i[1],e=e.replace(P.PROJECT,""));let a=e.match(P.DATE);if(a){let n=fe(a[1]);this.selectedDueDate=n!=null?n:"",e=e.replace(P.DATE,"")}let r=e.match(P.PRIORITY);if(r){let n=r[1].toLowerCase();n==="h"||n==="high"?this.selectedPriority="high":n==="m"||n==="med"||n==="medium"?this.selectedPriority="medium":(n==="l"||n==="low")&&(this.selectedPriority="low"),e=e.replace(P.PRIORITY,"")}let o=[...e.matchAll(P.TAG)];this.selectedTags=o.map(n=>n[1].toLowerCase()),e=e.replace(P.TAG,""),this.taskText=e.replace(/\s+/g," ").trim()}updatePreview(){let e=document.getElementById("quick-add-preview");if(!e)return;e.empty(),e.createEl("strong",{text:"Preview: "});let t=[],i=this.taskText;if(i=i.replace(P.OWNER,""),i=i.replace(P.PROJECT,""),i=i.replace(P.DATE,""),i=i.replace(P.PRIORITY,""),i=i.replace(P.TAG,""),i=i.replace(/\s+/g," ").trim(),i&&t.push(`"${i}"`),this.selectedOwner&&t.push(`\u{1F464} ${this.selectedOwner}`),this.selectedDueDate&&t.push(`\u{1F4C5} ${this.selectedDueDate}`),this.selectedProject&&t.push(`\u{1F4C1} ${this.selectedProject}`),this.selectedPriority){let a={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"};t.push(`${a[this.selectedPriority]} ${this.selectedPriority}`)}this.selectedTags.length>0&&t.push(`\u{1F3F7}\uFE0F ${this.selectedTags.map(a=>`#${a}`).join(" ")}`),e.createSpan({text:t.join(" | ")||"Enter task text..."})}async applyTemplate(e){let t=e.text;if(e.variables.length>0){let i=await new Promise(a=>{new Fe(this.app,e.variables,a).open()});if(!i)return;for(let[a,r]of Object.entries(i))t=t.replace(new RegExp(`\\$\\{${a}\\}`,"g"),r)}this.taskText=t,e.owner&&(this.selectedOwner=e.owner),e.project&&(this.selectedProject=e.project),e.stage&&(this.selectedStage=e.stage),e.priority&&(this.selectedPriority=e.priority),e.tags.length>0&&(this.selectedTags=[...e.tags]),this.render()}async createTask(){var r;let e=this.taskText;this.useQuickSyntax&&(e=e.replace(P.OWNER,""),e=e.replace(P.PROJECT,""),e=e.replace(P.DATE,""),e=e.replace(P.PRIORITY,""),e=e.replace(P.TAG,""),e=e.replace(/\s+/g," ").trim());let t=le(e);if(!t.isValid){new C.Notice((r=t.error)!=null?r:"Invalid task text");return}let i=[e];if(this.selectedOwner&&i.push(`@${this.selectedOwner}`),this.selectedDueDate&&i.push(`\u{1F4C5} ${this.selectedDueDate}`),this.selectedProject&&i.push(`#${this.selectedProject}`),this.selectedStage&&i.push(`[${this.selectedStage}]`),this.selectedPriority){let o={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"};i.push(o[this.selectedPriority]||"")}for(let o of this.selectedTags)i.push(`+${o}`);let a=i.filter(o=>o).join(" ");if(this.targetDailyNote)try{await $t(this.app,w(),a,this.settings),new C.Notice("Task added to daily note"),await this.plugin.refreshTasks(),this.close()}catch(o){new C.Notice(`Error: ${o.message}`)}else{if(!this.selectedFile){new C.Notice("Please select a target file");return}let o=await this.taskUpdater.createTask(this.selectedFile,e,{owner:this.selectedOwner||void 0,dueDate:this.selectedDueDate||void 0,project:this.selectedProject||void 0,stage:this.selectedStage||void 0,priority:this.selectedPriority||void 0,tags:this.selectedTags.length>0?this.selectedTags:void 0});o.success?(new C.Notice("Task created successfully"),await this.plugin.refreshTasks(),this.close()):new C.Notice(`Error: ${o.error}`)}}};var Te=require("obsidian");var Ve=class extends Te.Modal{constructor(e,t){super(e);this.viewMode="month";this.selectedDate=null;this.draggedTask=null;this.taskDateMap=new Map;this.plugin=t,this.taskCache=t.taskCache,this.taskUpdater=t.taskUpdater,this.settings=t.settings,this.currentDate=w()}onOpen(){let{contentEl:e,modalEl:t}=this;t.addClass("calendar-modal"),e.addClass("calendar-modal-content"),this.render()}onClose(){this.contentEl.empty()}buildTaskDateMap(){this.taskDateMap.clear();for(let e of this.taskCache.getAllTasks())if(e.dueDate){let t=this.taskDateMap.get(e.dueDate);t?t.push(e):this.taskDateMap.set(e.dueDate,[e])}}render(){let{contentEl:e}=this;switch(e.empty(),this.buildTaskDateMap(),this.renderHeader(e),this.renderViewToggle(e),this.viewMode){case"month":this.renderMonthView(e);break;case"week":this.renderWeekView(e);break;case"day":this.renderDayView(e);break}this.selectedDate&&this.renderSelectedDateTasks(e)}renderHeader(e){let t=e.createDiv({cls:"calendar-header"}),i=t.createDiv({cls:"calendar-nav"});i.createEl("button",{text:"\u25C0",cls:"calendar-nav-btn"}).addEventListener("click",()=>this.navigatePrevious()),i.createEl("h2",{cls:"calendar-title"}).setText(this.getHeaderTitle()),i.createEl("button",{text:"\u25B6",cls:"calendar-nav-btn"}).addEventListener("click",()=>this.navigateNext()),i.createEl("button",{text:"Today",cls:"calendar-today-btn"}).addEventListener("click",()=>{this.currentDate=w(),this.selectedDate=m(w()),this.render()}),t.createEl("button",{text:"\u2715 Close",cls:"calendar-close-btn"}).addEventListener("click",()=>this.close())}getHeaderTitle(){let e=X[this.currentDate.getMonth()],t=this.currentDate.getFullYear();switch(this.viewMode){case"month":return`${e.charAt(0).toUpperCase()+e.slice(1)} ${t}`;case"week":let i=Z(this.currentDate,this.settings.firstDayOfWeek),a=y(i,6);return`${this.formatShortDate(i)} - ${this.formatShortDate(a)}`;case"day":return this.formatFullDate(this.currentDate);default:return""}}formatShortDate(e){return`${X[e.getMonth()].slice(0,3)} ${e.getDate()}`}formatFullDate(e){let t=re[e.getDay()],i=X[e.getMonth()];return`${t.charAt(0).toUpperCase()+t.slice(1)}, ${i.charAt(0).toUpperCase()+i.slice(1)} ${e.getDate()}, ${e.getFullYear()}`}renderViewToggle(e){let t=e.createDiv({cls:"calendar-view-toggle"}),i=["month","week","day"];for(let a of i)t.createEl("button",{text:a.charAt(0).toUpperCase()+a.slice(1),cls:`calendar-view-btn ${this.viewMode===a?"active":""}`}).addEventListener("click",()=>{this.viewMode=a,this.render()})}navigatePrevious(){switch(this.viewMode){case"month":this.currentDate=z(this.currentDate,-1);break;case"week":this.currentDate=y(this.currentDate,-7);break;case"day":this.currentDate=y(this.currentDate,-1);break}this.render()}navigateNext(){switch(this.viewMode){case"month":this.currentDate=z(this.currentDate,1);break;case"week":this.currentDate=y(this.currentDate,7);break;case"day":this.currentDate=y(this.currentDate,1);break}this.render()}renderMonthView(e){let t=e.createDiv({cls:"calendar-month"});t.setAttribute("role","grid"),t.setAttribute("aria-label","Calendar month view");let i=t.createDiv({cls:"calendar-header-row"});i.setAttribute("role","row");let a=this.getOrderedDayNames();for(let o of a)i.createDiv({cls:"calendar-header-cell",text:o}).setAttribute("role","columnheader");let r=this.getMonthWeeks();for(let o of r){let n=t.createDiv({cls:"calendar-week-row"});n.setAttribute("role","row");for(let l of o.days)this.renderMonthCell(n,l)}}renderMonthCell(e,t){let i=e.createDiv({cls:`calendar-cell ${t.isCurrentMonth?"":"other-month"} ${t.isToday?"today":""} ${t.isWeekend?"weekend":""} ${this.selectedDate===t.dateStr?"selected":""}`});i.setAttribute("role","gridcell");let a=t.tasks.length===1?"1 task":`${t.tasks.length} tasks`,r=this.getWorkloadLabel(t.tasks.length);if(i.setAttribute("aria-label",`${t.dateStr}, ${a}${r?", "+r:""}`),i.createDiv({cls:"calendar-date-num"}).setText(String(t.date.getDate())),t.tasks.length>0&&i.createDiv({cls:"calendar-task-count",text:String(t.tasks.length)}),t.tasks.length>0){let l=i.createDiv({cls:"calendar-task-indicators"}),d=t.tasks.slice(0,3);for(let u of d){let g=l.createDiv({cls:"calendar-task-dot"});u.priority&&g.addClass(`priority-${u.priority}`),E(u.dueDate)&&!u.completed&&g.addClass("overdue")}t.tasks.length>3&&l.createDiv({cls:"calendar-task-more",text:`+${t.tasks.length-3}`})}let n=this.getWorkloadIntensity(t.tasks.length);n>0&&(i.style.backgroundColor=`rgba(var(--interactive-accent-rgb), ${n*.15})`),i.addEventListener("click",()=>{this.selectedDate=t.dateStr,this.render()}),this.setupDropZone(i,t.dateStr)}getWorkloadIntensity(e){return e===0?0:e<=2?1:e<=4?2:e<=6?3:4}getWorkloadLabel(e){return e===0?"":e<=2?"Light workload":e<=4?"Moderate workload":e<=6?"Heavy workload":"Very heavy workload"}renderWeekView(e){let t=e.createDiv({cls:"calendar-week"}),i=Z(this.currentDate,this.settings.firstDayOfWeek),a=this.getOrderedDayNames(),r=t.createDiv({cls:"calendar-header-row"});for(let n=0;n<7;n++){let l=y(i,n),d=m(l)===m(w()),u=r.createDiv({cls:`calendar-header-cell ${d?"today":""}`});u.createDiv({cls:"calendar-header-day",text:a[n]}),u.createDiv({cls:"calendar-header-date",text:String(l.getDate())})}let o=t.createDiv({cls:"calendar-week-body"});for(let n=0;n<7;n++){let l=y(i,n),d=m(l),u=this.getTasksForDate(d),g=d===m(w()),p=o.createDiv({cls:`calendar-day-column ${g?"today":""} ${this.selectedDate===d?"selected":""}`});this.setupDropZone(p,d),p.addEventListener("click",h=>{h.target===p&&(this.selectedDate=d,this.render())});for(let h of u.slice(0,5))this.renderTaskCard(p,h);u.length>5&&p.createDiv({cls:"calendar-more-tasks",text:`+${u.length-5} more`}).addEventListener("click",()=>{this.selectedDate=d,this.render()})}}renderDayView(e){let t=e.createDiv({cls:"calendar-day"}),i=m(this.currentDate),a=this.getTasksForDate(i);if(this.setupDropZone(t,i),a.length===0)t.createDiv({cls:"calendar-empty",text:"No tasks scheduled for this day"});else for(let r of a)this.renderTaskCard(t,r,!0)}renderTaskCard(e,t,i=!1){let a=e.createDiv({cls:"calendar-task-card"});a.draggable=!0,t.priority&&a.addClass(`priority-${t.priority}`),E(t.dueDate)&&!t.completed&&a.addClass("overdue"),t.completed&&a.addClass("completed");let r=a.createDiv({cls:"calendar-task-title"});if(t.priority&&r.createSpan({text:ne[t.priority]+" "}),r.createSpan({text:t.text}),i){let o=a.createDiv({cls:"calendar-task-meta"});t.owner&&o.createSpan({text:`\u{1F464} ${t.owner}`,cls:"calendar-task-owner"}),t.project&&o.createSpan({text:`\u{1F4C1} ${t.project}`,cls:"calendar-task-project"}),t.stage&&o.createSpan({text:`\u{1F4CB} ${t.stage}`,cls:"calendar-task-stage"}),o.createEl("a",{cls:"calendar-task-file",text:`\u{1F4C4} ${t.file.basename}`}).addEventListener("click",n=>{n.stopPropagation(),this.openTask(t)})}a.addEventListener("dragstart",o=>{var n;this.draggedTask=t,a.addClass("dragging"),(n=o.dataTransfer)==null||n.setData("text/plain",t.id)}),a.addEventListener("dragend",()=>{this.draggedTask=null,a.removeClass("dragging")}),a.addEventListener("click",()=>{this.openTask(t)})}renderSelectedDateTasks(e){if(!this.selectedDate)return;let t=this.getTasksForDate(this.selectedDate),i=R(this.selectedDate);if(!i)return;let a=e.createDiv({cls:"calendar-selected-panel"}),r=a.createDiv({cls:"calendar-selected-header"});r.createEl("h3",{text:this.formatFullDate(i)}),r.createEl("button",{text:"\u2715",cls:"calendar-panel-close"}).addEventListener("click",()=>{this.selectedDate=null,this.render()});let o=a.createDiv({cls:"calendar-selected-tasks"});if(t.length===0)o.createDiv({cls:"calendar-empty",text:"No tasks for this date"});else{let n=t.filter(d=>!d.completed),l=t.filter(d=>d.completed);if(n.length>0){o.createEl("h4",{text:`Active (${n.length})`});for(let d of n)this.renderTaskCard(o,d,!0)}if(l.length>0){o.createEl("h4",{text:`Completed (${l.length})`});for(let d of l)this.renderTaskCard(o,d,!0)}}}setupDropZone(e,t){e.addEventListener("dragover",i=>{i.preventDefault(),i.dataTransfer&&(i.dataTransfer.dropEffect="move"),e.addClass("drag-over")}),e.addEventListener("dragleave",i=>{e.contains(i.relatedTarget)||e.removeClass("drag-over")}),e.addEventListener("drop",async i=>{if(i.preventDefault(),e.removeClass("drag-over"),!this.draggedTask)return;let a=await this.taskUpdater.updateTask(this.draggedTask,{dueDate:t});a.success?(new Te.Notice(`Task rescheduled to ${ee(t)}`),await this.plugin.refreshTasks(),this.render()):new Te.Notice(`Error: ${a.error}`)})}getOrderedDayNames(){let e=[...re],t=this.settings.firstDayOfWeek;return[...e.slice(t),...e.slice(0,t)].map(i=>i.charAt(0).toUpperCase()+i.slice(1))}getMonthWeeks(){let e=[],t=this.currentDate.getFullYear(),i=this.currentDate.getMonth(),a=new Date(t,i,1),r=new Date(t,i+1,0),o=Z(a,this.settings.firstDayOfWeek),n=w(),l=m(n);for(;o<=r||e.length<6;){let d={days:[]};for(let u=0;u<7;u++){let g=m(o),p=o.getDay();d.days.push({date:new Date(o),dateStr:g,isCurrentMonth:o.getMonth()===i,isToday:g===l,isWeekend:p===0||p===6,tasks:this.getTasksForDate(g)}),o=y(o,1)}if(e.push(d),o>r&&e.length>=5)break}return e}getTasksForDate(e){var i;return[...(i=this.taskDateMap.get(e))!=null?i:[]].sort((a,r)=>{if(a.completed!==r.completed)return a.completed?1:-1;let o={high:0,medium:1,low:2},n=a.priority?o[a.priority]:3,l=r.priority?o[r.priority]:3;return n-l})}async openTask(e){await te(this.app,e),this.close()}};var It=require("obsidian");var Be=class extends It.Modal{constructor(e,t){super(e);this.selectedProject=null;this.activeTab="projects";this.plugin=t,this.taskCache=t.taskCache}onOpen(){this.modalEl.addClass("project-dashboard-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty(),e.createDiv({cls:"dashboard-header"}).createEl("h2",{text:"Project Dashboard"});let i=e.createDiv({cls:"dashboard-tabs"});i.createEl("button",{text:"Projects",cls:`dashboard-tab ${this.activeTab==="projects"?"active":""}`}).addEventListener("click",()=>{this.activeTab="projects",this.render()}),i.createEl("button",{text:"Analytics",cls:`dashboard-tab ${this.activeTab==="analytics"?"active":""}`}).addEventListener("click",()=>{this.activeTab="analytics",this.render()}),this.renderOverallStats(e),this.activeTab==="projects"?(this.renderProjectGrid(e),this.selectedProject&&this.renderProjectDetails(e,this.selectedProject)):this.renderAnalytics(e)}renderOverallStats(e){let t=this.taskCache.getFilteredTasks({}),i=this.calculateOverallStats(t),a=e.createDiv({cls:"dashboard-overall-stats"}),r=[{label:"Total Tasks",value:i.total,icon:"\u{1F4CB}",cls:""},{label:"Completed",value:i.completed,icon:"\u2705",cls:"stat-completed"},{label:"Active",value:i.active,icon:"\u{1F504}",cls:"stat-active"},{label:"Overdue",value:i.overdue,icon:"\u{1F534}",cls:"stat-overdue"},{label:"Due Today",value:i.dueToday,icon:"\u{1F7E1}",cls:"stat-today"},{label:"Blocked",value:Pe(t).length,icon:"\u{1F6AB}",cls:"stat-blocked"}];for(let o of r){let n=a.createDiv({cls:`stat-card ${o.cls}`});n.createDiv({cls:"stat-icon",text:o.icon}),n.createDiv({cls:"stat-value",text:String(o.value)}),n.createDiv({cls:"stat-label",text:o.label})}}renderProjectGrid(e){let t=e.createDiv({cls:"dashboard-projects"});t.createEl("h3",{text:"Projects"});let i=this.taskCache.getUniqueProjects(),a=this.taskCache.getFilteredTasks({});if(i.length===0){t.createDiv({cls:"no-projects",text:"No projects found. Add #project tags to your tasks to see them here."});return}let r=t.createDiv({cls:"project-grid"}),o=this.calculateProjectStats("All Tasks",a);this.renderProjectCard(r,o,null);let n=a.filter(l=>!l.project);if(n.length>0){let l=this.calculateProjectStats("No Project",n);this.renderProjectCard(r,l,"")}for(let l of i){let d=a.filter(g=>g.project===l),u=this.calculateProjectStats(l,d);this.renderProjectCard(r,u,l)}}renderProjectCard(e,t,i){let a=this.selectedProject===i,r=e.createDiv({cls:`project-card ${a?"selected":""}`});r.setAttribute("tabindex","0"),r.setAttribute("role","button"),r.setAttribute("aria-pressed",String(a)),r.setAttribute("aria-label",`${t.name}: ${t.completionPercent}% complete, ${t.total} tasks`),r.addEventListener("keydown",u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),this.selectedProject=i,this.render())}),r.createDiv({cls:"project-name",text:t.name});let o=r.createDiv({cls:"project-progress"}),l=o.createDiv({cls:"progress-bar"}).createDiv({cls:"progress-fill",attr:{style:`width: ${t.completionPercent}%`}});o.createDiv({cls:"progress-text",text:`${t.completionPercent}% complete`});let d=r.createDiv({cls:"project-quick-stats"});d.createSpan({text:`${t.completed}/${t.total} tasks`}),t.overdue>0&&d.createSpan({cls:"stat-overdue",text:`\u{1F534} ${t.overdue}`}),t.dueToday>0&&d.createSpan({cls:"stat-today",text:`\u{1F7E1} ${t.dueToday}`}),t.blocked>0&&d.createSpan({cls:"stat-blocked",text:`\u{1F6AB} ${t.blocked}`}),r.addEventListener("click",()=>{this.selectedProject=i,this.render()})}renderProjectDetails(e,t){let i=this.taskCache.getFilteredTasks({}),a=t===null?i:t===""?i.filter(k=>!k.project):i.filter(k=>k.project===t),r=t===null?"All Tasks":t||"No Project",o=this.calculateProjectStats(r,a),n=e.createDiv({cls:"project-details"}),l=n.createDiv({cls:"details-header"});l.createEl("h3",{text:`Project: ${r}`}),l.createEl("button",{text:"\xD7",cls:"close-details"}).addEventListener("click",()=>{this.selectedProject=null,this.render()});let u=n.createDiv({cls:"details-section"});u.createEl("h4",{text:"By Stage"});let g=u.createDiv({cls:"stage-grid"});for(let[k,N]of Object.entries(o.byStage))if(N>0){let S=g.createDiv({cls:"stage-item"});S.createSpan({cls:"stage-name",text:k||"Unassigned"}),S.createSpan({cls:"stage-count",text:String(N)})}let p=n.createDiv({cls:"details-section"});p.createEl("h4",{text:"By Priority"});let h=p.createDiv({cls:"priority-grid"}),b={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}",none:"\u26AA"};for(let[k,N]of Object.entries(o.byPriority))if(N>0){let S=h.createDiv({cls:`priority-item priority-${k}`});S.createSpan({text:`${b[k]||""} ${k.charAt(0).toUpperCase()+k.slice(1)}`}),S.createSpan({cls:"priority-count",text:String(N)})}if(o.recentlyCompleted.length>0){let k=n.createDiv({cls:"details-section"});k.createEl("h4",{text:"Recently Completed"});let N=k.createDiv({cls:"task-mini-list"});for(let S of o.recentlyCompleted.slice(0,5)){let T=N.createDiv({cls:"task-mini-item"});T.createSpan({text:"\u2705",cls:"task-mini-icon"}),T.createSpan({text:S.text,cls:"task-mini-text"}),S.completedDate&&T.createSpan({text:S.completedDate,cls:"task-mini-date"})}}if(o.upcomingTasks.length>0){let k=n.createDiv({cls:"details-section"});k.createEl("h4",{text:"Upcoming Tasks"});let N=k.createDiv({cls:"task-mini-list"});for(let S of o.upcomingTasks.slice(0,5)){let T=N.createDiv({cls:"task-mini-item"}),$=E(S.dueDate)?"\u{1F534}":I(S.dueDate)?"\u{1F7E1}":"\u{1F4C5}";T.createSpan({text:$,cls:"task-mini-icon"}),T.createSpan({text:S.text,cls:"task-mini-text"}),S.dueDate&&T.createSpan({text:S.dueDate,cls:"task-mini-date"})}}let v=a.filter(k=>!k.completed&&ce(k,i).isBlocked);if(v.length>0){let k=n.createDiv({cls:"details-section"});k.createEl("h4",{text:"Blocked Tasks"});let N=k.createDiv({cls:"task-mini-list"});for(let S of v.slice(0,5)){let T=N.createDiv({cls:"task-mini-item blocked"});T.createSpan({text:"\u{1F6AB}",cls:"task-mini-icon"}),T.createSpan({text:S.text,cls:"task-mini-text"})}}}calculateOverallStats(e){var b,v,k,N,S;let t=e.length,i=e.filter(T=>T.completed).length,a=t-i,r=e.filter(T=>!T.completed&&E(T.dueDate)).length,o=e.filter(T=>!T.completed&&I(T.dueDate)).length,n=w(),l=y(n,7),d=e.filter(T=>{if(T.completed||!T.dueDate)return!1;let $=R(T.dueDate);return $&&$>=n&&$<=l}).length,u={},g={},p={},h={high:0,medium:0,low:0};for(let T of e){let $=(b=T.stage)!=null?b:"Unassigned";u[$]=((v=u[$])!=null?v:0)+1,T.owner&&(g[T.owner]=((k=g[T.owner])!=null?k:0)+1),T.project&&(p[T.project]=((N=p[T.project])!=null?N:0)+1),T.priority&&(h[T.priority]=((S=h[T.priority])!=null?S:0)+1)}return{total:t,completed:i,active:a,overdue:r,dueToday:o,dueThisWeek:d,byStage:u,byOwner:g,byProject:p,byPriority:h}}calculateProjectStats(e,t){var S,T,$,he;let i=t.length,a=t.filter(D=>D.completed).length,r=i-a,o=t.filter(D=>!D.completed&&E(D.dueDate)).length,n=t.filter(D=>!D.completed&&I(D.dueDate)).length,l=this.taskCache.getFilteredTasks({}),d=t.filter(D=>!D.completed&&ce(D,l).isBlocked).length,u=w(),g=y(u,7),p=t.filter(D=>{if(D.completed||!D.dueDate)return!1;let j=R(D.dueDate);return j&&j>=u&&j<=g}).length,h=i>0?Math.round(a/i*100):0,b={},v={high:0,medium:0,low:0,none:0};for(let D of t){let j=(S=D.stage)!=null?S:"Unassigned";b[j]=((T=b[j])!=null?T:0)+1;let B=($=D.priority)!=null?$:"none";v[B]=((he=v[B])!=null?he:0)+1}let k=t.filter(D=>D.completed&&D.completedDate).sort((D,j)=>{var B,W;return((B=j.completedDate)!=null?B:"").localeCompare((W=D.completedDate)!=null?W:"")}).slice(0,5),N=t.filter(D=>!D.completed&&D.dueDate).sort((D,j)=>{var B,W;return((B=D.dueDate)!=null?B:"").localeCompare((W=j.dueDate)!=null?W:"")}).slice(0,5);return{name:e,total:i,completed:a,active:r,overdue:o,dueToday:n,dueThisWeek:p,blocked:d,completionPercent:h,byStage:b,byPriority:v,recentlyCompleted:k,upcomingTasks:N}}renderAnalytics(e){let t=e.createDiv({cls:"dashboard-analytics"}),i=this.taskCache.getFilteredTasks({});t.createEl("h3",{text:"Completion Trends (Last 30 Days)"}),this.renderCompletionChart(t,i),t.createEl("h3",{text:"Velocity"}),this.renderVelocity(t,i),t.createEl("h3",{text:"Owner Breakdown"}),this.renderOwnerChart(t,i),t.createEl("h3",{text:"Priority Distribution"}),this.renderPriorityChart(t,i)}renderCompletionChart(e,t){let i=w(),a=[],r=1;for(let n=29;n>=0;n--){let l=y(i,-n),d=m(l),u=t.filter(g=>g.completedDate===d).length;u>r&&(r=u),a.push({label:d.slice(5),count:u})}let o=e.createDiv({cls:"analytics-bar-chart"});for(let n of a){let l=o.createDiv({cls:"analytics-bar"}),d=r>0?n.count/r*100:0,u=l.createDiv({cls:"analytics-bar-fill"});u.style.height=`${d}%`,l.setAttribute("title",`${n.label}: ${n.count} completed`),l.setAttribute("aria-label",`${n.label}: ${n.count} completed`)}}renderVelocity(e,t){let i=w(),a=[];for(let l=0;l<4;l++){let d=y(i,-l*7),u=y(d,-6),g=m(u),p=m(d),h=t.filter(b=>b.completedDate&&b.completedDate>=g&&b.completedDate<=p).length;a.push(h)}let r=a.length>0?Math.round(a.reduce((l,d)=>l+d,0)/a.length):0,o=e.createDiv({cls:"analytics-velocity"});o.createDiv({cls:"analytics-velocity-number",text:String(r)}),o.createDiv({cls:"analytics-velocity-label",text:"tasks/week (4-week average)"});let n=e.createDiv({cls:"analytics-week-details"});a.forEach((l,d)=>{n.createSpan({text:`Week -${d}: ${l}`,cls:"analytics-week-item"})})}renderOwnerChart(e,t){var o,n;let i=new Map;for(let l of t){let d=(o=l.owner)!=null?o:"No Owner";i.set(d,((n=i.get(d))!=null?n:0)+1)}let a=Math.max(1,...i.values()),r=e.createDiv({cls:"analytics-horizontal-chart"});for(let[l,d]of[...i.entries()].sort((u,g)=>g[1]-u[1]).slice(0,10)){let u=r.createDiv({cls:"analytics-h-bar-row"});u.createDiv({cls:"analytics-h-bar-label",text:l});let p=u.createDiv({cls:"analytics-h-bar-container"}).createDiv({cls:"analytics-h-bar-fill"});p.style.width=`${d/a*100}%`,u.createDiv({cls:"analytics-h-bar-value",text:String(d)})}}renderPriorityChart(e,t){var n,l,d;let i={high:0,medium:0,low:0,none:0};for(let u of t){let g=(n=u.priority)!=null?n:"none";i[g]=((l=i[g])!=null?l:0)+1}let a=t.length||1,r=e.createDiv({cls:"analytics-segmented-bar"}),o={high:"var(--text-error)",medium:"#f0a000",low:"var(--text-success)",none:"var(--text-muted)"};for(let[u,g]of Object.entries(i)){if(g===0)continue;let p=Math.round(g/a*100),h=r.createDiv({cls:"analytics-segment"});h.style.width=`${p}%`,h.style.backgroundColor=(d=o[u])!=null?d:"var(--text-muted)",h.setAttribute("title",`${u}: ${g} (${p}%)`),h.setAttribute("aria-label",`${u}: ${g} tasks, ${p}%`),p>10&&h.createSpan({text:`${u.charAt(0).toUpperCase()}${u.slice(1)} ${p}%`,cls:"analytics-segment-label"})}}};var O=require("obsidian");var Ue=class extends O.Modal{constructor(e,t,i,a){var n,l,d,u,g;super(e);this.existingTask=null;this.isEditMode=!1;this.taskText="";this.selectedOwner="";this.selectedDueDate="";this.selectedProject="";this.selectedStage="";this.selectedPriority="";this.selectedTags=[];this.plugin=t,this.editor=i,this.view=a,this.cursorLine=i.getCursor().line;let r=i.getLine(this.cursorLine),o=a.file;o&&(this.existingTask=ze(r,o,this.cursorLine,t.settings.customStages)),this.existingTask?(this.isEditMode=!0,this.taskText=this.existingTask.text,this.selectedOwner=(n=this.existingTask.owner)!=null?n:"",this.selectedDueDate=(l=this.existingTask.dueDate)!=null?l:"",this.selectedProject=(d=this.existingTask.project)!=null?d:"",this.selectedStage=(u=this.existingTask.stage)!=null?u:"",this.selectedPriority=(g=this.existingTask.priority)!=null?g:"",this.selectedTags=[...this.existingTask.tags]):(this.selectedOwner=t.settings.defaultOwner,this.selectedProject=t.settings.defaultProject)}onOpen(){this.modalEl.addClass("task-agent-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.isEditMode?"Edit Task":"Create Task at Cursor"}),this.isEditMode&&e.createEl("p",{text:`Editing task on line ${this.cursorLine+1}`,cls:"task-agent-subtitle"});let i=e.createDiv({cls:"task-agent-input-container"}).createEl("textarea",{cls:"task-agent-task-input",placeholder:"Enter task description..."});i.value=this.taskText,i.addEventListener("input",()=>{this.taskText=i.value,this.updatePreview()}),setTimeout(()=>i.focus(),50),i.addEventListener("keydown",p=>{p.key==="Enter"&&(p.ctrlKey||p.metaKey)&&(p.preventDefault(),this.saveTask())});let a=e.createDiv({cls:"task-agent-fields"});new O.Setting(a).setName("Owner").addDropdown(p=>{p.addOption("","None");for(let h of this.plugin.taskCache.getUniqueOwners())p.addOption(h,h);p.setValue(this.selectedOwner),p.onChange(h=>{this.selectedOwner=h,this.updatePreview()})}).addText(p=>p.setPlaceholder("Or enter new...").onChange(h=>{h&&(this.selectedOwner=h,this.updatePreview())}));let o=new O.Setting(a).setName("Due Date").controlEl.createEl("input",{type:"date",cls:"task-agent-date-input",value:this.selectedDueDate});o.addEventListener("input",()=>{this.selectedDueDate=o.value,this.updatePreview()}),new O.Setting(a).setName("Project").addDropdown(p=>{p.addOption("","None");for(let h of this.plugin.taskCache.getUniqueProjects())p.addOption(h,h);p.setValue(this.selectedProject),p.onChange(h=>{this.selectedProject=h,this.updatePreview()})}).addText(p=>p.setPlaceholder("Or enter new...").onChange(h=>{h&&(this.selectedProject=h,this.updatePreview())}));let n=[...A,...this.plugin.settings.customStages];new O.Setting(a).setName("Stage").addDropdown(p=>{p.addOption("","None");for(let h of n)p.addOption(h,h);p.setValue(this.selectedStage),p.onChange(h=>{this.selectedStage=h,this.updatePreview()})}),new O.Setting(a).setName("Priority").addDropdown(p=>{p.addOption("","None");for(let h of H)p.addOption(h,h.charAt(0).toUpperCase()+h.slice(1));p.setValue(this.selectedPriority),p.onChange(h=>{this.selectedPriority=h,this.updatePreview()})}),new O.Setting(a).setName("Tags").setDesc("Comma-separated tags").addText(p=>p.setPlaceholder("tag1, tag2, tag3").setValue(this.selectedTags.join(", ")).onChange(h=>{this.selectedTags=h.split(",").map(b=>b.trim().replace(/^#/,"")).filter(b=>b.length>0),this.updatePreview()}));let l=e.createDiv({cls:"task-agent-preview"});l.id="task-agent-preview",this.updatePreview();let d=e.createDiv({cls:"task-agent-buttons"});d.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:this.isEditMode?"Save Changes":"Create Task",cls:"mod-cta"}).addEventListener("click",()=>void this.saveTask());let g=d.createEl("span",{text:"Ctrl+Enter to save",cls:"task-agent-shortcut-hint"});this.modalEl.addEventListener("keydown",p=>{p.key==="Enter"&&(p.ctrlKey||p.metaKey)&&(p.preventDefault(),this.saveTask())})}buildPreviewLine(){var o,n,l,d,u;let e=this.isEditMode&&((o=this.existingTask)!=null&&o.completed)?"x":" ",t=this.isEditMode&&(l=(n=this.existingTask)==null?void 0:n.indent)!=null?l:"",i=this.taskText||"...",a=[];this.selectedOwner&&a.push(this.selectedOwner),this.selectedDueDate&&a.push(this.selectedDueDate),this.selectedStage&&a.push(this.selectedStage),this.selectedProject&&a.push(this.selectedProject);let r=i;return a.length>0&&(r=`**${a.join(" | ")}:** ${i}`),this.selectedPriority&&(r+=` [priority:${this.selectedPriority}]`),this.isEditMode&&((d=this.existingTask)!=null&&d.recurrence)&&(r+=` [repeat:${(u=this.existingTask.recurrence.rawString)!=null?u:this.existingTask.recurrence.type}]`),this.selectedTags.length>0&&(r+=" "+this.selectedTags.map(g=>`#${g}`).join(" ")),`${t}- [${e}] ${r}`}updatePreview(){let e=document.getElementById("task-agent-preview");e&&(e.empty(),e.createEl("strong",{text:"Preview: "}),e.createEl("code",{text:this.buildPreviewLine(),cls:"task-agent-preview-code"}))}async saveTask(){var i;let e=le(this.taskText);if(!e.isValid){new O.Notice((i=e.error)!=null?i:"Invalid task text");return}let t=this.view.file;if(!t){new O.Notice("No active file");return}if(this.isEditMode&&this.existingTask){let a=await this.plugin.taskUpdater.updateTask(this.existingTask,{text:this.taskText,owner:this.selectedOwner||null,dueDate:this.selectedDueDate||null,stage:this.selectedStage||null,project:this.selectedProject||null,priority:this.selectedPriority||null,tags:this.selectedTags});a.success?(new O.Notice("Task updated"),await this.plugin.refreshTasks(),this.close()):new O.Notice(`Error: ${a.error}`)}else{let a=await this.plugin.taskUpdater.createTask(t,this.taskText,{owner:this.selectedOwner||void 0,dueDate:this.selectedDueDate||void 0,project:this.selectedProject||void 0,stage:this.selectedStage||void 0,priority:this.selectedPriority||void 0,tags:this.selectedTags.length>0?this.selectedTags:void 0,atLine:this.cursorLine});a.success?(new O.Notice("Task created at cursor"),await this.plugin.refreshTasks(),this.close()):new O.Notice(`Error: ${a.error}`)}}};var jt=require("obsidian"),He=class extends jt.Modal{constructor(s,e){super(s),this.plugin=e}onOpen(){this.modalEl.addClass("time-report-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:s}=this;s.empty(),s.createEl("h2",{text:"Time Report"});let t=this.plugin.taskCache.getAllTasks().filter(r=>r.estimate||r.timeLogged);if(t.length===0){s.createEl("p",{text:"No tasks with time estimates or logged time found."}),s.createEl("p",{text:"Add [estimate:2h] or [logged:1h30m] to tasks."}),s.createEl("button",{text:"Close"}).addEventListener("click",()=>this.close());return}s.createEl("h3",{text:"By Project"});let i=this.groupBy(t,r=>{var o;return(o=r.project)!=null?o:"No Project"});this.renderTable(s,i),s.createEl("h3",{text:"By Owner"});let a=this.groupBy(t,r=>{var o;return(o=r.owner)!=null?o:"No Owner"});this.renderTable(s,a),s.createEl("button",{text:"Close"}).addEventListener("click",()=>this.close())}groupBy(s,e){let t=new Map;for(let i of s){let a=e(i);t.has(a)||t.set(a,[]),t.get(a).push(i)}return[...t.entries()].map(([i,a])=>({label:i,estimate:this.sumTime(a.map(r=>r.estimate).filter(Boolean)),logged:this.sumTime(a.map(r=>r.timeLogged).filter(Boolean)),tasks:a.length}))}renderTable(s,e){let t=s.createEl("table",{cls:"time-report-table"}),a=t.createEl("thead").createEl("tr");a.createEl("th",{text:"Name"}),a.createEl("th",{text:"Tasks"}),a.createEl("th",{text:"Estimated"}),a.createEl("th",{text:"Logged"});let r=t.createEl("tbody");for(let o of e){let n=r.createEl("tr");n.createEl("td",{text:o.label}),n.createEl("td",{text:String(o.tasks)}),n.createEl("td",{text:o.estimate||"-"}),n.createEl("td",{text:o.logged||"-"})}}sumTime(s){let e=0;for(let a of s)e+=this.parseTimeToMinutes(a);if(e===0)return"";let t=Math.floor(e/60),i=e%60;return t===0?`${i}m`:i===0?`${t}h`:`${t}h${i}m`}parseTimeToMinutes(s){let e=0,t=s.match(/(\d+)\s*h/i),i=s.match(/(\d+)\s*m/i);if(t&&(e+=parseInt(t[1],10)*60),i&&(e+=parseInt(i[1],10)),!t&&!i){let a=parseFloat(s);isNaN(a)||(e=Math.round(a*60))}return e}};var Q=require("obsidian"),_e=class extends Q.Modal{constructor(s,e){super(s),this.plugin=e}onOpen(){this.modalEl.addClass("workspace-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:s}=this;s.empty(),s.createEl("h2",{text:"Manage Workspaces"});let e=this.plugin.settings.workspaces;e.length===0&&s.createEl("p",{text:"No saved workspaces. Save the current view as a workspace.",cls:"workspace-empty"});let t=s.createDiv({cls:"workspace-list"});for(let r of e){let o=t.createDiv({cls:"workspace-item"});o.createDiv({cls:"workspace-name",text:r.name});let n=`Sort: ${r.sortBy} | Group: ${r.groupBy}`;o.createDiv({cls:"workspace-desc",text:n});let l=o.createDiv({cls:"workspace-actions"});l.createEl("button",{text:"Load"}).addEventListener("click",async()=>{this.plugin.settings.activeWorkspaceId=r.id,this.plugin.settings.sortBy=r.sortBy,this.plugin.settings.groupBy=r.groupBy,this.plugin.settings.showCompleted=r.showCompleted,this.plugin.settings.filterOwner=r.filterOwner,this.plugin.settings.filterProject=r.filterProject,this.plugin.settings.filterStage=r.filterStage,this.plugin.settings.filterPriority=r.filterPriority,this.plugin.settings.filterDueDate=r.filterDueDate,this.plugin.settings.filterTags=r.filterTags,this.plugin.settings.searchQuery=r.searchQuery,await this.plugin.saveSettings(),new Q.Notice(`Workspace "${r.name}" loaded`),this.close()}),l.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",async()=>{this.plugin.settings.workspaces=e.filter(d=>d.id!==r.id),this.plugin.settings.activeWorkspaceId===r.id&&(this.plugin.settings.activeWorkspaceId=""),await this.plugin.saveSettings(),this.render()})}let i=s.createDiv({cls:"workspace-save"}),a="";new Q.Setting(i).setName("Save Current View").addText(r=>r.setPlaceholder("Workspace name").onChange(o=>a=o)).addButton(r=>r.setButtonText("Save").setCta().onClick(async()=>{if(!a.trim()){new Q.Notice("Name is required");return}let o={id:Date.now().toString(36),name:a.trim(),sortBy:this.plugin.settings.sortBy,groupBy:this.plugin.settings.groupBy,showCompleted:this.plugin.settings.showCompleted,filterOwner:this.plugin.settings.filterOwner,filterProject:this.plugin.settings.filterProject,filterStage:this.plugin.settings.filterStage,filterPriority:this.plugin.settings.filterPriority,filterDueDate:this.plugin.settings.filterDueDate,filterTags:[...this.plugin.settings.filterTags],searchQuery:this.plugin.settings.searchQuery};this.plugin.settings.workspaces.push(o),await this.plugin.saveSettings(),this.render(),new Q.Notice("Workspace saved")})),s.createEl("button",{text:"Close"}).addEventListener("click",()=>this.close())}};var Ye=class extends M.Plugin{constructor(){super(...arguments);this.fileWatcherRegistered=!1;this.debouncedRefresh=(0,M.debounce)(async()=>{await this.refreshTasks(),await this.refreshView()},300,!0)}async onload(){await this.loadSettings(),this.taskCache=new Ee(this.app,this.settings),this.taskUpdater=new Ce(this.app,this.settings),this.notificationService=new Oe(this.app,this.settings),this.commentService=new Me(()=>this.loadData(),e=>this.saveData(e)),this.suggestionService=new Ae(this.taskCache),this.registerView(K,e=>new me(e,this)),this.addRibbonIcon("list-checks","Task Consolidator",()=>{this.activateView()}),this.addCommand({id:"open-task-consolidator",name:"Open Task Consolidator",callback:()=>{this.activateView()}}),this.addCommand({id:"open-kanban-board",name:"Open Kanban Board",callback:()=>{this.openKanban()}}),this.addCommand({id:"quick-add-task",name:"Quick Add Task",callback:()=>{this.openQuickAdd()}}),this.addCommand({id:"refresh-tasks",name:"Refresh All Tasks",callback:()=>{this.refreshTasks()}}),this.addCommand({id:"open-calendar",name:"Open Calendar View",callback:()=>{this.openCalendar()}}),this.addCommand({id:"open-daily-note",name:"Open Today's Daily Note",callback:()=>{this.openDailyNote()}}),this.addCommand({id:"add-task-to-daily-note",name:"Add Task to Today's Daily Note",callback:()=>{this.addTaskToDailyNote()}}),this.addCommand({id:"show-task-summary",name:"Show Task Summary",callback:()=>{this.showTaskSummary()}}),this.addCommand({id:"open-project-dashboard",name:"Open Project Dashboard",callback:()=>{this.openProjectDashboard()}}),this.addCommand({id:"open-task-agent",name:"Open Task Agent (Edit/Create at Cursor)",editorCallback:(e,t)=>{new Ue(this.app,this,e,t).open()}}),this.addCommand({id:"open-template-manager",name:"Open Task Template Manager",callback:()=>{new Re(this.app,this).open()}}),this.addCommand({id:"export-tasks",name:"Export Tasks",callback:()=>{new de(this.app,this).open()}}),this.addCommand({id:"open-time-report",name:"Open Time Report",callback:()=>{new He(this.app,this).open()}}),this.addCommand({id:"open-workspace-manager",name:"Manage Workspaces",callback:()=>{new _e(this.app,this).open()}}),this.addSettingTab(new De(this.app,this)),await this.taskCache.initialize(),this.settings.enableComments&&await this.commentService.initialize(),this.setupFileWatchers(),this.setupNotifications(),this.settings.debugMode&&(console.log("Task Consolidator loaded"),console.log("Cache stats:",this.taskCache.getCacheStats()))}onunload(){this.app.workspace.detachLeavesOfType(K),this.taskCache.clear(),this.notificationService.destroy(),this.settings.debugMode&&console.log("Task Consolidator unloaded")}async loadSettings(){let e=await this.loadData();this.settings=kt(e!=null?e:{})}async saveSettings(){await this.saveData(this.settings),this.taskCache.updateSettings(this.settings),this.taskUpdater.updateSettings(this.settings),this.notificationService.updateSettings(this.settings),this.debouncedRefresh=(0,M.debounce)(async()=>{await this.refreshTasks(),await this.refreshView()},this.settings.refreshDebounceMs,!0),this.setupNotifications()}async activateView(){let{workspace:e}=this.app,t=e.getLeavesOfType(K)[0];if(!t){let i=e.getRightLeaf(!1);i&&(await i.setViewState({type:K,active:!0}),t=i)}t&&e.revealLeaf(t)}openKanban(){new je(this.app,this).open()}openQuickAdd(){new ke(this.app,this).open()}openCalendar(){new Ve(this.app,this).open()}openProjectDashboard(){new Be(this.app,this).open()}async openDailyNote(){if(!this.settings.enableDailyNoteIntegration){new M.Notice("Daily note integration is disabled. Enable it in settings.");return}try{let e=await st(this.app,w(),this.settings);await this.app.workspace.getLeaf().openFile(e)}catch(e){new M.Notice("Failed to open daily note: "+e.message)}}async addTaskToDailyNote(){if(!this.settings.enableDailyNoteIntegration){new M.Notice("Daily note integration is disabled. Enable it in settings.");return}new ke(this.app,this,{targetDailyNote:!0}).open()}async refreshTasks(){await this.taskCache.refreshAll(),this.settings.debugMode&&console.log("Tasks refreshed:",this.taskCache.getCacheStats())}async refreshView(){let e=this.app.workspace.getLeavesOfType(K);for(let t of e){let i=t.view;i instanceof me&&await i.refresh()}}setupFileWatchers(){this.fileWatcherRegistered||!this.settings.autoRefresh||(this.registerEvent(this.app.vault.on("modify",e=>{e instanceof M.TFile&&e.extension==="md"&&(this.taskCache.refreshFile(e),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("create",e=>{e instanceof M.TFile&&e.extension==="md"&&(this.taskCache.refreshFile(e),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof M.TFile&&e.extension==="md"&&(this.taskCache.removeFile(e.path),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("rename",(e,t)=>{e instanceof M.TFile&&e.extension==="md"&&(this.taskCache.renameFile(t,e.path),this.debouncedRefresh())})),this.fileWatcherRegistered=!0,this.settings.debugMode&&console.log("File watchers registered"))}setupNotifications(){if(!this.settings.enableNotifications){this.notificationService.stopCheckInterval();return}this.settings.notifyOnStartup&&setTimeout(()=>{let e=this.taskCache.getFilteredTasks({}),t=this.notificationService.getNotificationSummary(e);this.notificationService.showStartupNotification(t)},2e3),this.notificationService.startCheckInterval(()=>this.taskCache.getFilteredTasks({}))}showTaskSummary(){let e=this.taskCache.getFilteredTasks({}),t=this.notificationService.getNotificationSummary(e),i=this.notificationService.formatSummaryText(t);i?new M.Notice(i,8e3):new M.Notice("No tasks with due dates found.",4e3)}};
