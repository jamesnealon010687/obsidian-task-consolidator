/*
Task Consolidator v2.0.0
Obsidian Plugin for consolidated task management
*/

var Oe=Object.defineProperty;var pt=Object.getOwnPropertyDescriptor;var gt=Object.getOwnPropertyNames;var ft=Object.prototype.hasOwnProperty;var mt=(o,s)=>{for(var e in s)Oe(o,e,{get:s[e],enumerable:!0})},kt=(o,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let a of gt(s))!ft.call(o,a)&&a!==e&&Oe(o,a,{get:()=>s[a],enumerable:!(t=pt(s,a))||t.enumerable});return o};var yt=o=>kt(Oe({},"__esModule",{value:!0}),o);var It={};mt(It,{default:()=>Pe});module.exports=yt(It);var M=require("obsidian");var L=["Requested","Staged","In-Progress","In-Review","Completed"],U=["high","medium","low"],Ue=["daily","weekly","monthly","yearly","custom"],Ye=[{id:"unassigned",title:"Unassigned",stage:null},{id:"requested",title:"Requested",stage:"Requested"},{id:"staged",title:"Staged",stage:"Staged"},{id:"in-progress",title:"In-Progress",stage:"In-Progress"},{id:"in-review",title:"In-Review",stage:"In-Review"},{id:"completed",title:"Completed",stage:"Completed"}],ue=["dueDate","owner","priority","project","created","stage"],he=["none","dueDate","owner","project","stage","priority"],We=["YYYY-MM-DD","MM/DD/YYYY","DD-MM-YYYY","locale"],Ge=["full","filename","hidden"],Ke=["panel","kanban","calendar"],Y="task-consolidator-view",ee=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],te=["sun","mon","tue","wed","thu","fri","sat"],q=["january","february","march","april","may","june","july","august","september","october","november","december"],qe=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],z={MAX_TASK_TEXT_LENGTH:1e3,MAX_OWNER_LENGTH:50,MAX_PROJECT_LENGTH:100,MAX_TAG_LENGTH:50,MAX_TAGS_COUNT:20,MAX_LINE_LENGTH:2e3},N={TASK_LINE:/^(\s*)-\s+\[([ xX])\]\s+(.+)$/,METADATA:/^\*\*(.+?):\*\*\s*(.*)$/,DATE:/^\d{4}-\d{2}-\d{2}$/,DATE_WITH_PREFIX:/^(?:Due\s+)?(\d{4}-\d{2}-\d{2})$/i,COMPLETED_DATE:/\s*\[done:(\d{4}-\d{2}-\d{2})\]\s*$/,CREATED_DATE:/\s*\[created:(\d{4}-\d{2}-\d{2})\]\s*$/,PRIORITY:/\[priority:(high|medium|low)\]/i,RECURRENCE:/\[repeat:([^\]]+)\]/i,TAGS:/#([\w\-_]+)/g,QUICK_OWNER:/@([\w\s\-.']+?)(?=\s+[#!@]|\s*$)/,QUICK_PROJECT:/^#([\w\-_]+)/,QUICK_DATE:/!([\w\-/]+)/,BLOCKED_BY:/\[blocked-by:([^\]]+)\]/gi,BLOCKS:/\[blocks:([^\]]+)\]/gi},b={OWNER:/@([\w\s\-.']+?)(?=\s+[@#!^+]|\s*$)/,PROJECT:/\s#([\w\-_]+)(?=\s|$)/,DATE:/!([\w\-/\s]+?)(?=\s+[@#!^+]|\s*$)/,PRIORITY:/\^(high|med|medium|low|h|m|l)/i,TAG:/\+([\w\-_]+)/g},j={ENTER:"Enter",SPACE:" ",ESCAPE:"Escape",TAB:"Tab",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",HOME:"Home",END:"End",DELETE:"Delete",BACKSPACE:"Backspace",QUESTION_MARK:"?",SLASH:"/"},se={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"},ze={none:"\u{1F4CC}",dueDate:"\u{1F4C5}",owner:"\u{1F464}",project:"\u{1F4C1}",stage:"\u{1F4CB}",priority:"\u26A1"};var W={sortBy:"dueDate",groupBy:"dueDate",showCompleted:!0,completedTasksLimit:0,dateFormat:"YYYY-MM-DD",firstDayOfWeek:0,defaultView:"panel",requireMetadataFormat:!1,metadataDelimiter:"|",customStages:[],excludedFolders:[],excludedPatterns:[],autoRefresh:!0,refreshDebounceMs:300,parentCompletionBehavior:"manual",confirmDestructiveActions:!0,recurringAutoCreate:!0,recurringCreateDaysBefore:1,compactMode:!1,showFilePath:"filename",taskCountInRibbon:!1,showOverdueIndicator:!0,showDueTodayIndicator:!0,defaultTargetFile:"",quickAddHotkey:"Ctrl+Shift+T",defaultOwner:"",defaultProject:"",filterOwner:"",filterDueDate:"",filterProject:"",filterPriority:"",filterStage:"",filterTags:[],searchQuery:"",collapsedGroups:{},kanbanFilterProject:"",debugMode:!1,maxTasksToRender:0,enableVirtualScrolling:!0,enableTaskCache:!0,enableDailyNoteIntegration:!0,dailyNoteFolder:"",dailyNoteDateFormat:"YYYY-MM-DD",dailyNoteTasksHeading:"## Tasks",autoLinkTasksToDailyNote:!1,showDailyNoteButton:!0,enableNotifications:!0,notifyOnStartup:!0,notifyOverdueTasks:!0,notifyDueToday:!0,notifyUpcoming:!0,upcomingDays:3,reminderCheckIntervalMinutes:30,showNotificationBadge:!0,lastNotificationCheck:0};function Qe(o){var s,e,t,a,i;return{...W,...o,customStages:(s=o.customStages)!=null?s:W.customStages,excludedFolders:(e=o.excludedFolders)!=null?e:W.excludedFolders,excludedPatterns:(t=o.excludedPatterns)!=null?t:W.excludedPatterns,filterTags:(a=o.filterTags)!=null?a:W.filterTags,collapsedGroups:(i=o.collapsedGroups)!=null?i:W.collapsedGroups}}var f=require("obsidian");var Tt=/[.*+?^${}()|[\]\\]/g,vt=/\*\*/g;function Xe(o){return o.replace(Tt,"\\$&")}function Je(o){return o.replace(vt,"").replace(/\|/g,"-").replace(/:/g,"-").replace(/\[/g,"(").replace(/\]/g,")").replace(/\n/g," ").replace(/\r/g,"").trim()}function Me(o){return o&&Je(o).replace(/<[^>]*>/g,"").replace(/[^\w\s\-.']/gu,"").substring(0,50).trim()||null}function Ae(o){return o&&Je(o).replace(/[^\w\s\-_]/gu,"").substring(0,100).trim()||null}function Ie(o){return o.replace(/\n/g," ").replace(/\r/g,"").replace(/\t/g," ").replace(/\s+/g," ").substring(0,1e3).trim()}function Ze(o){let s=o.replace(/\t/g,"  ").length;return Math.floor(s/2)}function G(o){return o.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,s=>s.toUpperCase()).trim()}function ae(o,s){return o===null&&s===null?0:o===null?1:s===null?-1:o.localeCompare(s)}var pe=class extends f.PluginSettingTab{constructor(s,e){super(s,e),this.plugin=e}display(){let{containerEl:s}=this;s.empty(),s.createEl("h1",{text:"Task Consolidator Settings"}),this.renderDisplaySection(s),this.renderDetectionSection(s),this.renderBehaviorSection(s),this.renderRecurringSection(s),this.renderAppearanceSection(s),this.renderQuickAddSection(s),this.renderDailyNoteSection(s),this.renderNotificationSection(s),this.renderAdvancedSection(s),this.renderResetSection(s)}renderDisplaySection(s){s.createEl("h2",{text:"Display"}),new f.Setting(s).setName("Default Sort Order").setDesc("How tasks should be sorted by default").addDropdown(e=>{for(let t of ue)e.addOption(t,G(t));e.setValue(this.plugin.settings.sortBy),e.onChange(async t=>{this.plugin.settings.sortBy=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Default Group By").setDesc("How tasks should be grouped by default").addDropdown(e=>{for(let t of he)e.addOption(t,G(t));e.setValue(this.plugin.settings.groupBy),e.onChange(async t=>{this.plugin.settings.groupBy=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Completed Tasks").setDesc("Show the completed tasks section by default").addToggle(e=>{e.setValue(this.plugin.settings.showCompleted),e.onChange(async t=>{this.plugin.settings.showCompleted=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Completed Tasks Limit").setDesc("Limit completed tasks display (0 = unlimited, or last N days)").addText(e=>{e.setValue(String(this.plugin.settings.completedTasksLimit)),e.setPlaceholder("0"),e.onChange(async t=>{let a=parseInt(t,10);this.plugin.settings.completedTasksLimit=isNaN(a)?0:Math.max(0,a),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Date Format").setDesc("Format for displaying dates").addDropdown(e=>{for(let t of We)e.addOption(t,t);e.setValue(this.plugin.settings.dateFormat),e.onChange(async t=>{this.plugin.settings.dateFormat=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("First Day of Week").setDesc("Which day starts the week").addDropdown(e=>{e.addOption("0","Sunday"),e.addOption("1","Monday"),e.setValue(String(this.plugin.settings.firstDayOfWeek)),e.onChange(async t=>{this.plugin.settings.firstDayOfWeek=parseInt(t,10),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Default View").setDesc("Default view when opening Task Consolidator").addDropdown(e=>{for(let t of Ke)e.addOption(t,G(t));e.setValue(this.plugin.settings.defaultView),e.onChange(async t=>{this.plugin.settings.defaultView=t,await this.plugin.saveSettings()})})}renderDetectionSection(s){s.createEl("h2",{text:"Task Detection"}),new f.Setting(s).setName("Require Metadata Format").setDesc("Only detect tasks with **metadata:** format").addToggle(e=>{e.setValue(this.plugin.settings.requireMetadataFormat),e.onChange(async t=>{this.plugin.settings.requireMetadataFormat=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Metadata Delimiter").setDesc("Character used to separate metadata fields (default: |)").addText(e=>{e.setValue(this.plugin.settings.metadataDelimiter),e.setPlaceholder("|"),e.onChange(async t=>{this.plugin.settings.metadataDelimiter=t||"|",await this.plugin.saveSettings()})}),new f.Setting(s).setName("Custom Stages").setDesc("Additional workflow stages (comma-separated)").addText(e=>{e.setValue(this.plugin.settings.customStages.join(", ")),e.setPlaceholder("Review, QA, Deploy"),e.onChange(async t=>{this.plugin.settings.customStages=t.split(",").map(a=>a.trim()).filter(a=>a.length>0),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Excluded Folders").setDesc("Folders to exclude from task scanning (comma-separated)").addText(e=>{e.setValue(this.plugin.settings.excludedFolders.join(", ")),e.setPlaceholder("Templates, Archive"),e.onChange(async t=>{this.plugin.settings.excludedFolders=t.split(",").map(a=>a.trim()).filter(a=>a.length>0),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Excluded Patterns").setDesc("File patterns to exclude (glob format, comma-separated)").addText(e=>{e.setValue(this.plugin.settings.excludedPatterns.join(", ")),e.setPlaceholder("*.template.md, _*"),e.onChange(async t=>{this.plugin.settings.excludedPatterns=t.split(",").map(a=>a.trim()).filter(a=>a.length>0),await this.plugin.saveSettings()})})}renderBehaviorSection(s){s.createEl("h2",{text:"Behavior"}),new f.Setting(s).setName("Auto Refresh").setDesc("Automatically refresh tasks when files change").addToggle(e=>{e.setValue(this.plugin.settings.autoRefresh),e.onChange(async t=>{this.plugin.settings.autoRefresh=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Refresh Debounce (ms)").setDesc("Delay before refreshing after file change").addText(e=>{e.setValue(String(this.plugin.settings.refreshDebounceMs)),e.setPlaceholder("300"),e.onChange(async t=>{let a=parseInt(t,10);this.plugin.settings.refreshDebounceMs=isNaN(a)?300:Math.max(100,a),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Parent Task Completion").setDesc("How completing a parent task affects children").addDropdown(e=>{e.addOption("manual","Manual - No automatic behavior"),e.addOption("auto","Auto - Complete parent when all children done"),e.addOption("cascade","Cascade - Complete children when parent done"),e.setValue(this.plugin.settings.parentCompletionBehavior),e.onChange(async t=>{this.plugin.settings.parentCompletionBehavior=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Confirm Destructive Actions").setDesc("Show confirmation dialogs for bulk delete operations").addToggle(e=>{e.setValue(this.plugin.settings.confirmDestructiveActions),e.onChange(async t=>{this.plugin.settings.confirmDestructiveActions=t,await this.plugin.saveSettings()})})}renderRecurringSection(s){s.createEl("h2",{text:"Recurring Tasks"}),new f.Setting(s).setName("Auto-Create Next Occurrence").setDesc("Automatically create next occurrence when completing recurring task").addToggle(e=>{e.setValue(this.plugin.settings.recurringAutoCreate),e.onChange(async t=>{this.plugin.settings.recurringAutoCreate=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Create Days Before").setDesc("Days before due date to create next occurrence (0 = on completion)").addText(e=>{e.setValue(String(this.plugin.settings.recurringCreateDaysBefore)),e.setPlaceholder("1"),e.onChange(async t=>{let a=parseInt(t,10);this.plugin.settings.recurringCreateDaysBefore=isNaN(a)?1:Math.max(0,a),await this.plugin.saveSettings()})})}renderAppearanceSection(s){s.createEl("h2",{text:"Appearance"}),new f.Setting(s).setName("Compact Mode").setDesc("Use smaller, denser task display").addToggle(e=>{e.setValue(this.plugin.settings.compactMode),e.onChange(async t=>{this.plugin.settings.compactMode=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show File Path").setDesc("How to display file paths in task list").addDropdown(e=>{for(let t of Ge)e.addOption(t,G(t));e.setValue(this.plugin.settings.showFilePath),e.onChange(async t=>{this.plugin.settings.showFilePath=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Task Count in Ribbon").setDesc("Show active task count as badge on ribbon icon").addToggle(e=>{e.setValue(this.plugin.settings.taskCountInRibbon),e.onChange(async t=>{this.plugin.settings.taskCountInRibbon=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Overdue Indicator").setDesc("Highlight overdue tasks with red accent").addToggle(e=>{e.setValue(this.plugin.settings.showOverdueIndicator),e.onChange(async t=>{this.plugin.settings.showOverdueIndicator=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Due Today Indicator").setDesc("Highlight tasks due today with amber accent").addToggle(e=>{e.setValue(this.plugin.settings.showDueTodayIndicator),e.onChange(async t=>{this.plugin.settings.showDueTodayIndicator=t,await this.plugin.saveSettings()})})}renderQuickAddSection(s){s.createEl("h2",{text:"Quick Add"}),new f.Setting(s).setName("Default Target File").setDesc("Default file for new tasks created via Quick Add").addDropdown(e=>{e.addOption("","None");let t=this.app.vault.getMarkdownFiles().sort((a,i)=>a.path.localeCompare(i.path));for(let a of t)e.addOption(a.path,a.path);e.setValue(this.plugin.settings.defaultTargetFile),e.onChange(async a=>{this.plugin.settings.defaultTargetFile=a,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Default Owner").setDesc("Default owner for new tasks").addText(e=>{e.setValue(this.plugin.settings.defaultOwner),e.setPlaceholder("Your name"),e.onChange(async t=>{this.plugin.settings.defaultOwner=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Default Project").setDesc("Default project for new tasks").addText(e=>{e.setValue(this.plugin.settings.defaultProject),e.setPlaceholder("Project name"),e.onChange(async t=>{this.plugin.settings.defaultProject=t,await this.plugin.saveSettings()})})}renderDailyNoteSection(s){s.createEl("h2",{text:"Daily Notes"}),new f.Setting(s).setName("Enable Daily Note Integration").setDesc("Allow tasks to be linked to and created in daily notes").addToggle(e=>{e.setValue(this.plugin.settings.enableDailyNoteIntegration),e.onChange(async t=>{this.plugin.settings.enableDailyNoteIntegration=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Daily Notes Folder").setDesc("Folder where daily notes are stored (leave empty for vault root)").addText(e=>{e.setValue(this.plugin.settings.dailyNoteFolder),e.setPlaceholder("Daily Notes"),e.onChange(async t=>{this.plugin.settings.dailyNoteFolder=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Daily Note Date Format").setDesc("Format for daily note filenames (e.g., YYYY-MM-DD)").addText(e=>{e.setValue(this.plugin.settings.dailyNoteDateFormat),e.setPlaceholder("YYYY-MM-DD"),e.onChange(async t=>{this.plugin.settings.dailyNoteDateFormat=t||"YYYY-MM-DD",await this.plugin.saveSettings()})}),new f.Setting(s).setName("Tasks Heading").setDesc("Heading under which to add tasks in daily notes").addText(e=>{e.setValue(this.plugin.settings.dailyNoteTasksHeading),e.setPlaceholder("## Tasks"),e.onChange(async t=>{this.plugin.settings.dailyNoteTasksHeading=t||"## Tasks",await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Daily Note Button").setDesc("Show button to open/create today's daily note").addToggle(e=>{e.setValue(this.plugin.settings.showDailyNoteButton),e.onChange(async t=>{this.plugin.settings.showDailyNoteButton=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Auto-Link Tasks to Daily Note").setDesc("Automatically add link to daily note when creating tasks").addToggle(e=>{e.setValue(this.plugin.settings.autoLinkTasksToDailyNote),e.onChange(async t=>{this.plugin.settings.autoLinkTasksToDailyNote=t,await this.plugin.saveSettings()})})}renderNotificationSection(s){s.createEl("h2",{text:"Notifications & Reminders"}),new f.Setting(s).setName("Enable Notifications").setDesc("Show notifications for upcoming and overdue tasks").addToggle(e=>{e.setValue(this.plugin.settings.enableNotifications),e.onChange(async t=>{this.plugin.settings.enableNotifications=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Notify on Startup").setDesc("Show task summary when Obsidian starts").addToggle(e=>{e.setValue(this.plugin.settings.notifyOnStartup),e.onChange(async t=>{this.plugin.settings.notifyOnStartup=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Notify Overdue Tasks").setDesc("Include overdue tasks in notifications").addToggle(e=>{e.setValue(this.plugin.settings.notifyOverdueTasks),e.onChange(async t=>{this.plugin.settings.notifyOverdueTasks=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Notify Due Today").setDesc("Include tasks due today in notifications").addToggle(e=>{e.setValue(this.plugin.settings.notifyDueToday),e.onChange(async t=>{this.plugin.settings.notifyDueToday=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Notify Upcoming Tasks").setDesc("Include upcoming tasks in startup notification").addToggle(e=>{e.setValue(this.plugin.settings.notifyUpcoming),e.onChange(async t=>{this.plugin.settings.notifyUpcoming=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Upcoming Days").setDesc('Number of days to consider as "upcoming"').addText(e=>{e.setValue(String(this.plugin.settings.upcomingDays)),e.setPlaceholder("3"),e.onChange(async t=>{let a=parseInt(t,10);this.plugin.settings.upcomingDays=isNaN(a)?3:Math.max(1,a),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Reminder Interval (minutes)").setDesc("How often to check and remind about tasks (0 = disabled)").addText(e=>{e.setValue(String(this.plugin.settings.reminderCheckIntervalMinutes)),e.setPlaceholder("30"),e.onChange(async t=>{let a=parseInt(t,10);this.plugin.settings.reminderCheckIntervalMinutes=isNaN(a)?30:Math.max(0,a),await this.plugin.saveSettings()})}),new f.Setting(s).setName("Show Notification Badge").setDesc("Show count of urgent tasks as badge").addToggle(e=>{e.setValue(this.plugin.settings.showNotificationBadge),e.onChange(async t=>{this.plugin.settings.showNotificationBadge=t,await this.plugin.saveSettings()})})}renderAdvancedSection(s){s.createEl("h2",{text:"Advanced"}),new f.Setting(s).setName("Debug Mode").setDesc("Enable debug logging to console").addToggle(e=>{e.setValue(this.plugin.settings.debugMode),e.onChange(async t=>{this.plugin.settings.debugMode=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Enable Task Cache").setDesc("Cache parsed tasks for better performance").addToggle(e=>{e.setValue(this.plugin.settings.enableTaskCache),e.onChange(async t=>{this.plugin.settings.enableTaskCache=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Enable Virtual Scrolling").setDesc("Use virtual scrolling for large task lists").addToggle(e=>{e.setValue(this.plugin.settings.enableVirtualScrolling),e.onChange(async t=>{this.plugin.settings.enableVirtualScrolling=t,await this.plugin.saveSettings()})}),new f.Setting(s).setName("Max Tasks to Render").setDesc("Maximum tasks to render at once (0 = unlimited)").addText(e=>{e.setValue(String(this.plugin.settings.maxTasksToRender)),e.setPlaceholder("0"),e.onChange(async t=>{let a=parseInt(t,10);this.plugin.settings.maxTasksToRender=isNaN(a)?0:Math.max(0,a),await this.plugin.saveSettings()})})}renderResetSection(s){s.createEl("h2",{text:"Reset"}),new f.Setting(s).setName("Clear All Filters").setDesc("Reset owner, date, project, and stage filters").addButton(e=>{e.setButtonText("Clear Filters"),e.onClick(async()=>{this.plugin.settings.filterOwner="",this.plugin.settings.filterDueDate="",this.plugin.settings.filterProject="",this.plugin.settings.filterStage="",this.plugin.settings.filterPriority="",this.plugin.settings.filterTags=[],this.plugin.settings.searchQuery="",await this.plugin.saveSettings(),new f.Notice("Filters cleared")})}),new f.Setting(s).setName("Reset All Settings").setDesc("Reset all settings to default values").addButton(e=>{e.setButtonText("Reset to Defaults"),e.setWarning(),e.onClick(async()=>{let t=this.plugin.settings.collapsedGroups;this.plugin.settings={...W,collapsedGroups:t},await this.plugin.saveSettings(),this.display(),new f.Notice("Settings reset to defaults")})})}};var Dt=/^\d{4}-\d{2}-\d{2}$/,wt=/^[\w\s\-.']+$/u,bt=/^[\w\s\-_]+$/u;function ge(o){if(o==null||o==="")return{isValid:!0,sanitizedValue:void 0};let s=o.trim();if(!Dt.test(s))return{isValid:!1,error:"Date must be in YYYY-MM-DD format"};let[e,t,a]=s.split("-").map(Number),i=new Date(e,t-1,a);return i.getFullYear()!==e||i.getMonth()!==t-1||i.getDate()!==a?{isValid:!1,error:"Invalid date value"}:{isValid:!0,sanitizedValue:s}}function ie(o){if(o==null)return{isValid:!1,error:"Task text is required"};let s=o.trim();return s.length===0?{isValid:!1,error:"Task text cannot be empty"}:s.length>z.MAX_TASK_TEXT_LENGTH?{isValid:!1,error:`Task text exceeds maximum length of ${z.MAX_TASK_TEXT_LENGTH} characters`}:{isValid:!0,sanitizedValue:s}}function fe(o){if(o==null||o==="")return{isValid:!0,sanitizedValue:void 0};let s=o.trim();return s.length>z.MAX_OWNER_LENGTH?{isValid:!1,error:`Owner name exceeds maximum length of ${z.MAX_OWNER_LENGTH} characters`}:wt.test(s)?{isValid:!0,sanitizedValue:s}:{isValid:!1,error:"Owner name contains invalid characters"}}function me(o){if(o==null||o==="")return{isValid:!0,sanitizedValue:void 0};let s=o.trim();return s.length>z.MAX_PROJECT_LENGTH?{isValid:!1,error:`Project name exceeds maximum length of ${z.MAX_PROJECT_LENGTH} characters`}:bt.test(s)?{isValid:!0,sanitizedValue:s}:{isValid:!1,error:"Project name contains invalid characters"}}function et(o,s=[]){if(o==null||o==="")return{isValid:!0,sanitizedValue:void 0};let e=o.trim(),t=[...L,...s];return t.includes(e)?{isValid:!0,sanitizedValue:e}:{isValid:!1,error:`Invalid stage. Valid stages are: ${t.join(", ")}`}}function tt(o,s){return o==null?{isValid:!1,error:"Line number is required"}:!Number.isInteger(o)||o<0?{isValid:!1,error:"Line number must be a non-negative integer"}:s!==void 0&&o>=s?{isValid:!1,error:"Line number exceeds file length"}:{isValid:!0}}function St(o){let s=o.toLowerCase().trim();if(Ue.includes(s))return{type:s,rawString:o};let e=s.match(/^every\s+(\d+)\s+(day|days|week|weeks|month|months|year|years)$/);if(e){let a=parseInt(e[1],10),i=e[2],n="custom";return i.startsWith("day")?n="daily":i.startsWith("week")?n="weekly":i.startsWith("month")?n="monthly":i.startsWith("year")&&(n="yearly"),{type:n,interval:a,rawString:o}}let t=s.match(/^every\s+((?:mon|tue|wed|thu|fri|sat|sun)(?:day)?(?:,\s*(?:mon|tue|wed|thu|fri|sat|sun)(?:day)?)*)$/);if(t){let a={sun:0,sunday:0,mon:1,monday:1,tue:2,tuesday:2,wed:3,wednesday:3,thu:4,thursday:4,fri:5,friday:5,sat:6,saturday:6};return{type:"weekly",daysOfWeek:t[1].split(",").map(n=>n.trim()).map(n=>a[n.replace(/day$/,"")]).filter(n=>n!==void 0),rawString:o}}return s==="weekdays"?{type:"weekly",daysOfWeek:[1,2,3,4,5],rawString:o}:s==="weekends"?{type:"weekly",daysOfWeek:[0,6],rawString:o}:null}function xt(o,s=[]){let e={owner:null,dueDate:null,stage:null,project:null,priority:null,tags:[],recurrence:null,completedDate:null,createdDate:null,blockedBy:[],blocks:[]},t=[...L,...s],a="|";if(o.includes(a)){let i=o.split(a).map(n=>n.trim()).filter(n=>n);for(let n of i){let l=n.match(N.DATE_WITH_PREFIX);if(l){let c=ge(l[1]);c.isValid&&c.sanitizedValue&&(e.dueDate=c.sanitizedValue);continue}if(t.includes(n)){e.stage=n;continue}let r=n.toLowerCase();if(U.includes(r)){e.priority=r;continue}if(!e.owner){let c=fe(n);if(c.isValid&&c.sanitizedValue){e.owner=c.sanitizedValue;continue}}if(!e.project){let c=me(n);c.isValid&&c.sanitizedValue&&(e.project=c.sanitizedValue)}}}else N.DATE.test(o)?e.dueDate=o:t.includes(o)?e.stage=o:U.includes(o.toLowerCase())?e.priority=o.toLowerCase():e.owner=o;return e}function Ct(o){let s=o,e={tags:[],blockedBy:[],blocks:[]},t=s.match(N.COMPLETED_DATE);t&&(e.completedDate=t[1],s=s.replace(N.COMPLETED_DATE,"").trim());let a=s.match(N.CREATED_DATE);a&&(e.createdDate=a[1],s=s.replace(N.CREATED_DATE,"").trim());let i=s.match(N.PRIORITY);i&&(e.priority=i[1].toLowerCase(),s=s.replace(N.PRIORITY,"").trim());let n=s.match(N.RECURRENCE);n&&(e.recurrence=St(n[1]),s=s.replace(N.RECURRENCE,"").trim());let l=[...s.matchAll(N.BLOCKED_BY)];for(let d of l)if(d[1]){let u=d[1].split(",").map(p=>p.trim()).filter(p=>p);e.blockedBy.push(...u)}s=s.replace(N.BLOCKED_BY,"").trim();let r=[...s.matchAll(N.BLOCKS)];for(let d of r)if(d[1]){let u=d[1].split(",").map(p=>p.trim()).filter(p=>p);e.blocks.push(...u)}s=s.replace(N.BLOCKS,"").trim();let c=s.matchAll(N.TAGS);for(let d of c)d[1]&&e.tags.push(d[1].toLowerCase());return s=s.replace(N.TAGS,"").trim(),s=s.replace(/\s+/g," ").trim(),{cleanText:s,metadata:e}}function Le(o,s,e,t=[]){var h,g,C,P,y,E,w,k,A,oe,T,I,F,H,He,_e;let a=o.match(N.TASK_LINE);if(!a)return null;let i=(h=a[1])!=null?h:"",n=((g=a[2])==null?void 0:g.toLowerCase())==="x",l=(C=a[3])!=null?C:"",{cleanText:r,metadata:c}=Ct(l);l=r;let d={owner:null,dueDate:null,stage:null,project:null,priority:(P=c.priority)!=null?P:null,tags:(y=c.tags)!=null?y:[],recurrence:(E=c.recurrence)!=null?E:null,completedDate:(w=c.completedDate)!=null?w:null,createdDate:(k=c.createdDate)!=null?k:null,blockedBy:(A=c.blockedBy)!=null?A:[],blocks:(oe=c.blocks)!=null?oe:[]},u=l,p=l.match(N.METADATA);if(p){let ht=p[1].trim();u=(I=(T=p[2])==null?void 0:T.trim())!=null?I:"";let _=xt(ht,t);d={...d,..._,priority:(F=d.priority)!=null?F:_.priority,tags:[...new Set([...d.tags,..._.tags])],recurrence:(H=d.recurrence)!=null?H:_.recurrence,completedDate:(He=d.completedDate)!=null?He:_.completedDate,createdDate:(_e=d.createdDate)!=null?_e:_.createdDate,blockedBy:[...new Set([...d.blockedBy,..._.blockedBy])],blocks:[...new Set([...d.blocks,..._.blocks])]}}return{id:`${s.path}:${e}`,file:s,lineNumber:e,text:u,completed:n,dueDate:d.dueDate,owner:d.owner,stage:d.stage,project:d.project,completedDate:d.completedDate,rawLine:o,priority:d.priority,tags:d.tags,recurrence:d.recurrence,parentId:null,children:[],depth:Ze(i),indent:i,createdDate:d.createdDate,blockedBy:d.blockedBy,blocks:d.blocks}}async function Re(o,s,e){let t=[];try{let i=(await o.vault.read(s)).split(`
`);for(let n=0;n<i.length;n++){let l=i[n],r=Le(l,s,n,e.customStages);r&&t.push(r)}}catch(a){console.error(`Error parsing tasks from ${s.path}:`,a)}return t}function st(o){let s=[...o].sort((a,i)=>a.file.path!==i.file.path?a.file.path.localeCompare(i.file.path):a.lineNumber-i.lineNumber),e=[],t=[];for(let a of s){for(a.children=[],a.parentId=null;t.length>0&&(t[t.length-1].file.path!==a.file.path||t[t.length-1].depth>=a.depth);)t.pop();if(t.length>0&&a.depth>0){let i=t[t.length-1];a.parentId=i.id,i.children.push(a)}else e.push(a);t.push(a)}return e}function m(o){let s=o.getFullYear(),e=String(o.getMonth()+1).padStart(2,"0"),t=String(o.getDate()).padStart(2,"0");return`${s}-${e}-${t}`}function R(o){let s=o.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!s)return null;let[,e,t,a]=s,i=parseInt(e,10),n=parseInt(t,10)-1,l=parseInt(a,10),r=new Date(i,n,l);return r.getFullYear()!==i||r.getMonth()!==n||r.getDate()!==l?null:r}function D(){let o=new Date;return new Date(o.getFullYear(),o.getMonth(),o.getDate())}function v(o,s){let e=new Date(o);return e.setDate(e.getDate()+s),e}function le(o,s){return v(o,s*7)}function K(o,s){let e=new Date(o);return e.setMonth(e.getMonth()+s),e}function ke(o,s){let e=new Date(o);return e.setFullYear(e.getFullYear()+s),e}function Q(o,s=0){let e=new Date(o),t=e.getDay(),a=(t<s?7:0)+t-s;return e.setDate(e.getDate()-a),e}function it(o,s=0){let e=Q(o,s);return v(e,6)}function Et(o){return new Date(o.getFullYear(),o.getMonth()+1,0)}function nt(o){let s=D();return o.getFullYear()===s.getFullYear()&&o.getMonth()===s.getMonth()&&o.getDate()===s.getDate()}function Nt(o){return o<D()}function S(o){if(!o)return!1;let s=R(o);return s?Nt(s)&&!nt(s):!1}function $(o){if(!o)return!1;let s=R(o);return s?nt(s):!1}function $e(o,s=0){if(!o)return!1;let e=R(o);if(!e)return!1;let t=D(),a=Q(t,s),i=it(t,s);return e>=a&&e<=i}function at(o,s=D()){let e=new Date(s),t=e.getDay(),a=(o-t+7)%7||7;return e.setDate(e.getDate()+a),e}function Pt(o,s=D()){let e=new Date(s),t=e.getDay(),a=(o-t+7)%7;return a<7&&(a+=7),e.setDate(e.getDate()+a),e}function je(o){let s=o.toLowerCase().trim(),e=D();if(/^\d{4}-\d{2}-\d{2}$/.test(s)){let r=R(s);return r?m(r):null}let t=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(t){let[,r,c,d]=t,u=new Date(parseInt(d,10),parseInt(r,10)-1,parseInt(c,10));if(!isNaN(u.getTime()))return m(u)}let a=s.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(a){let[,r,c,d]=a,u=new Date(parseInt(d,10),parseInt(c,10)-1,parseInt(r,10));if(!isNaN(u.getTime()))return m(u)}if(s==="today")return m(e);if(s==="tomorrow")return m(v(e,1));if(s==="yesterday")return m(v(e,-1));let i=s.match(/^in\s+(\d+)\s+(day|days|week|weeks|month|months|year|years)$/);if(i){let r=parseInt(i[1],10),c=i[2];if(c.startsWith("day"))return m(v(e,r));if(c.startsWith("week"))return m(le(e,r));if(c.startsWith("month"))return m(K(e,r));if(c.startsWith("year"))return m(ke(e,r))}let n=s.match(/^(\d+)\s+(day|days|week|weeks|month|months|year|years)\s+from\s+(now|today)$/);if(n){let r=parseInt(n[1],10),c=n[2];if(c.startsWith("day"))return m(v(e,r));if(c.startsWith("week"))return m(le(e,r));if(c.startsWith("month"))return m(K(e,r));if(c.startsWith("year"))return m(ke(e,r))}for(let r=0;r<ee.length;r++){let c=ee[r],d=te[r];if(s===`next ${c}`||s===`next ${d}`)return m(Pt(r,e));if(s===`this ${c}`||s===`this ${d}`)return e.getDay()===r?m(e):m(at(r,e))}for(let r=0;r<ee.length;r++){let c=ee[r],d=te[r];if(s===c||s===d)return m(at(r,e))}if(s==="next week")return m(le(e,1));if(s==="next month")return m(K(e,1));if(s==="end of week"||s==="eow")return m(it(e));if(s==="end of month"||s==="eom")return m(Et(e));if(s==="start of next week"||s==="beginning of next week"){let r=v(Q(e),7);return m(r)}if(s==="start of next month"||s==="beginning of next month"){let r=new Date(e.getFullYear(),e.getMonth()+1,1);return m(r)}if(s==="weekday"||s==="next weekday"){let r=v(e,1);for(;r.getDay()===0||r.getDay()===6;)r=v(r,1);return m(r)}if(s==="next business day"||s==="business day"){let r=v(e,1);for(;r.getDay()===0||r.getDay()===6;)r=v(r,1);return m(r)}for(let r=0;r<q.length;r++){let c=q[r],d=qe[r],u=s.match(new RegExp(`^(${c}|${d})\\s+(\\d{1,2})(?:(?:st|nd|rd|th))?(?:\\s+(\\d{4}))?$`));if(u){let p=parseInt(u[2],10),h=u[3]?parseInt(u[3],10):e.getFullYear(),g=new Date(h,r,p);if(g.getMonth()!==r)continue;if(!u[3]&&g<e&&g.setFullYear(g.getFullYear()+1),!isNaN(g.getTime()))return m(g)}}let l=s.match(/^the\s+(\d{1,2})(?:st|nd|rd|th)?(?:\s+of\s+(this\s+month|next\s+month))?$/);if(l){let r=parseInt(l[1],10),c=l[2],d=e.getMonth(),u=e.getFullYear();c==="next month"&&(d+=1,d>11&&(d=0,u+=1));let p=new Date(u,d,r);if(!c&&p<=e&&p.setMonth(p.getMonth()+1),p.getDate()===r)return m(p)}return null}function Ot(o,s="YYYY-MM-DD"){if(!o)return"";let e=R(o);if(!e)return o;switch(s){case"MM/DD/YYYY":return`${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")}/${e.getFullYear()}`;case"DD-MM-YYYY":return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${e.getFullYear()}`;case"locale":return e.toLocaleDateString();case"YYYY-MM-DD":default:return o}}function X(o){if(!o)return"";let s=R(o);if(!s)return o;let e=D(),t=s.getTime()-e.getTime(),a=Math.round(t/(1e3*60*60*24));if(a===0)return"Today";if(a===1)return"Tomorrow";if(a===-1)return"Yesterday";if(a>1&&a<=7){let i=ee[s.getDay()];return i.charAt(0).toUpperCase()+i.slice(1)}return a<-1&&a>=-7?`${Math.abs(a)} days ago`:a>7&&a<=14?"Next week":Ot(o)}var ye=class{constructor(s,e){this.cache=new Map;this.allTasks=[];this.isInitialized=!1;this.stats={totalFiles:0,cachedFiles:0,totalTasks:0,completedTasks:0,incompleteTasks:0,hits:0,misses:0,lastRefresh:0};this.app=s,this.settings=e}updateSettings(s){this.settings=s}async initialize(){await this.refreshAll(),this.isInitialized=!0}get initialized(){return this.isInitialized}getAllTasks(){return this.allTasks}getCacheStats(){let s=0,e=0;for(let t of this.allTasks)t.completed?s++:e++;return{...this.stats,completedTasks:s,incompleteTasks:e}}async refreshFile(s){if(!this.shouldParseFile(s)){this.cache.delete(s.path),this.rebuildAllTasks();return}let e={tasks:await Re(this.app,s,this.settings),lastModified:s.stat.mtime};this.cache.set(s.path,e),this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size}removeFile(s){this.cache.delete(s),this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size}renameFile(s,e){let t=this.cache.get(s);t&&(this.cache.delete(s),this.cache.set(e,t))}async refreshAll(){this.cache.clear();let s=this.app.vault.getMarkdownFiles();this.stats.totalFiles=s.length;for(let e of s){if(!this.shouldParseFile(e))continue;let t=this.cache.get(e.path);if(t&&t.lastModified===e.stat.mtime){this.stats.hits++;continue}this.stats.misses++;let a={tasks:await Re(this.app,e,this.settings),lastModified:e.stat.mtime};this.cache.set(e.path,a)}this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size,this.stats.lastRefresh=Date.now()}shouldParseFile(s){var t,a;if(!s.path.endsWith(".md"))return!1;let e=(a=(t=s.parent)==null?void 0:t.path)!=null?a:"";for(let i of this.settings.excludedFolders)if(e===i||e.startsWith(`${i}/`))return!1;for(let i of this.settings.excludedPatterns)if(this.matchGlob(s.path,i))return!1;return!0}matchGlob(s,e){let t=e.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${t}$`).test(s)}rebuildAllTasks(){let s=[];for(let e of this.cache.values())s.push(...e.tasks);this.allTasks=st(s),this.stats.totalTasks=this.allTasks.length}getTasksForFile(s){var t;let e=this.cache.get(s);return(t=e==null?void 0:e.tasks)!=null?t:[]}getFilteredTasks(s){let e=[...this.allTasks];s.showCompleted===!1?e=e.filter(a=>!a.completed):s.completed!==void 0&&(e=e.filter(a=>a.completed===s.completed)),s.owner&&(e=e.filter(a=>a.owner===s.owner)),s.project&&(e=e.filter(a=>a.project===s.project)),s.stage&&(e=e.filter(a=>a.stage===s.stage)),s.priority&&(e=e.filter(a=>a.priority===s.priority)),s.tags&&s.tags.length>0&&(e=e.filter(a=>s.tags.every(i=>a.tags.includes(i)))),s.filePath&&(e=e.filter(a=>a.file.path.includes(s.filePath)));let t=s.searchText||s.search;if(t){let a=Xe(t),i=new RegExp(a,"i");e=e.filter(n=>i.test(n.text)||n.owner&&i.test(n.owner)||n.project&&i.test(n.project))}if(s.dueDateFilter)switch(s.dueDateFilter){case"today":e=e.filter(a=>$(a.dueDate));break;case"thisWeek":e=e.filter(a=>$e(a.dueDate,this.settings.firstDayOfWeek));break;case"overdue":e=e.filter(a=>S(a.dueDate));break;case"noDueDate":e=e.filter(a=>!a.dueDate);break}return s.dueDateRange&&(e=e.filter(a=>a.dueDate?a.dueDate>=s.dueDateRange.start&&a.dueDate<=s.dueDateRange.end:!1)),s.dueDate&&(e=e.filter(a=>a.dueDate===s.dueDate)),e}clear(){this.cache.clear(),this.allTasks=[],this.stats={totalFiles:0,cachedFiles:0,totalTasks:0,completedTasks:0,incompleteTasks:0,hits:0,misses:0,lastRefresh:0},this.isInitialized=!1}getTaskStats(){var t,a;let s=this.allTasks,e={total:s.length,completed:0,active:0,overdue:0,dueToday:0,dueThisWeek:0,byStage:{Requested:0,Staged:0,"In-Progress":0,"In-Review":0,Completed:0,unassigned:0},byOwner:{},byProject:{},byPriority:{high:0,medium:0,low:0}};for(let i of s)i.completed?e.completed++:(e.active++,S(i.dueDate)&&e.overdue++,$(i.dueDate)&&e.dueToday++,$e(i.dueDate,this.settings.firstDayOfWeek)&&e.dueThisWeek++),i.stage&&L.includes(i.stage)?e.byStage[i.stage]++:e.byStage.unassigned++,i.owner&&(e.byOwner[i.owner]=((t=e.byOwner[i.owner])!=null?t:0)+1),i.project&&(e.byProject[i.project]=((a=e.byProject[i.project])!=null?a:0)+1),i.priority&&e.byPriority[i.priority]++;return e}getUniqueOwners(){let s=new Set;for(let e of this.allTasks)e.owner&&s.add(e.owner);return[...s].sort()}getUniqueProjects(){let s=new Set;for(let e of this.allTasks)e.project&&s.add(e.project);return[...s].sort()}getUniqueDueDates(){let s=new Set;for(let e of this.allTasks)e.dueDate&&s.add(e.dueDate);return[...s].sort()}getUniqueTags(){let s=new Set;for(let e of this.allTasks)for(let t of e.tags)s.add(t);return[...s].sort()}};var J=require("obsidian");var Te=class{constructor(s,e){this.undoStack=[];this.maxUndoEntries=50;this.app=s,this.settings=e}updateSettings(s){this.settings=s}async toggleTask(s){let e=!s.completed;return this.updateTask(s,{completed:e,stage:e?"Completed":s.stage==="Completed"?null:s.stage})}async updateTask(s,e){var t,a,i;try{let n=this.app.vault.getAbstractFileByPath(s.file.path);if(!n||!(n instanceof J.TFile))return{success:!1,error:"File not found"};let r=(await this.app.vault.read(n)).split(`
`),c=tt(s.lineNumber,r.length);if(!c.isValid)return{success:!1,error:c.error};let d=r[s.lineNumber];if(d!==s.rawLine)return{success:!1,error:"Task has been modified. Please refresh and try again."};let u=this.buildUpdatedLine(s,e);this.pushUndo({filePath:s.file.path,lineNumber:s.lineNumber,originalLine:d,newLine:u,timestamp:Date.now()}),r[s.lineNumber]=u;let p=r.join(`
`);return await this.app.vault.modify(n,p),e.completed&&s.recurrence&&!s.completed&&await this.createNextRecurrence(s),{success:!0,task:{...s,rawLine:u,completed:(t=e.completed)!=null?t:s.completed,text:(a=e.text)!=null?a:s.text,owner:e.owner!==void 0?e.owner:s.owner,dueDate:e.dueDate!==void 0?e.dueDate:s.dueDate,stage:e.stage!==void 0?e.stage:s.stage,project:e.project!==void 0?e.project:s.project,priority:e.priority!==void 0?e.priority:s.priority,tags:(i=e.tags)!=null?i:s.tags}}}catch(n){let l=n instanceof Error?n.message:"Unknown error";return console.error("Error updating task:",n),{success:!1,error:l}}}buildUpdatedLine(s,e){var g,C;let t=(g=e.completed)!=null?g:s.completed,a=t?"x":" ",i=e.owner!==void 0?Me(e.owner):s.owner,n=e.dueDate!==void 0?e.dueDate:s.dueDate,l=e.stage!==void 0?e.stage:s.stage,r=e.project!==void 0?Ae(e.project):s.project,c=e.priority!==void 0?e.priority:s.priority,d=e.text!==void 0?Ie(e.text):s.text,u=e.tags!==void 0?e.tags:s.tags,p=[];i&&p.push(i),n&&p.push(n),l&&p.push(l),r&&p.push(r);let h=d;if(p.length>0&&(h=`**${p.join(" | ")}:** ${d}`),c&&(h+=` [priority:${c}]`),s.recurrence&&(h+=` [repeat:${(C=s.recurrence.rawString)!=null?C:s.recurrence.type}]`),u.length>0&&(h+=" "+u.map(P=>`#${P}`).join(" ")),t&&!s.completed){let P=m(D());h+=` [done:${P}]`}else s.completedDate&&t&&(h+=` [done:${s.completedDate}]`);return s.createdDate&&(h+=` [created:${s.createdDate}]`),`${s.indent}- [${a}] ${h}`}async createTask(s,e,t={}){var a;try{let i=ie(e);if(!i.isValid)return{success:!1,error:i.error};if(t.owner){let g=fe(t.owner);if(!g.isValid)return{success:!1,error:g.error}}if(t.dueDate){let g=ge(t.dueDate);if(!g.isValid)return{success:!1,error:g.error}}if(t.project){let g=me(t.project);if(!g.isValid)return{success:!1,error:g.error}}if(t.stage){let g=et(t.stage,this.settings.customStages);if(!g.isValid)return{success:!1,error:g.error}}let n=[];t.owner&&n.push(Me(t.owner)),t.dueDate&&n.push(t.dueDate),t.stage&&n.push(t.stage),t.project&&n.push(Ae(t.project));let l=Ie(e);n.length>0&&(l=`**${n.join(" | ")}:** ${l}`),t.priority&&(l+=` [priority:${t.priority}]`),t.tags&&t.tags.length>0&&(l+=" "+t.tags.map(g=>`#${g}`).join(" "));let r=m(D());l+=` [created:${r}]`;let c=`- [ ] ${l}`,u=(await this.app.vault.read(s)).split(`
`),p=(a=t.atLine)!=null?a:u.length;u.splice(p,0,c);let h=u.join(`
`);return await this.app.vault.modify(s,h),new J.Notice("Task created"),{success:!0}}catch(i){let n=i instanceof Error?i.message:"Unknown error";return console.error("Error creating task:",i),{success:!1,error:n}}}async deleteTask(s){try{let t=(await this.app.vault.read(s.file)).split(`
`);if(t[s.lineNumber]!==s.rawLine)return{success:!1,error:"Task has been modified. Please refresh and try again."};this.pushUndo({filePath:s.file.path,lineNumber:s.lineNumber,originalLine:s.rawLine,newLine:"",timestamp:Date.now()}),t.splice(s.lineNumber,1);let a=t.join(`
`);return await this.app.vault.modify(s.file,a),{success:!0}}catch(e){let t=e instanceof Error?e.message:"Unknown error";return console.error("Error deleting task:",e),{success:!1,error:t}}}async createNextRecurrence(s){var t,a,i;if(!s.recurrence||!this.settings.recurringAutoCreate)return;let e=this.calculateNextDueDate(s.dueDate,s.recurrence);e&&(s.recurrence.endDate&&e>s.recurrence.endDate||(await this.createTask(s.file,s.text,{owner:(t=s.owner)!=null?t:void 0,dueDate:e,project:(a=s.project)!=null?a:void 0,stage:"Requested",priority:(i=s.priority)!=null?i:void 0,tags:s.tags}),new J.Notice("Created next occurrence for recurring task")))}calculateNextDueDate(s,e){var i;let t=s?new Date(s):D(),a=(i=e.interval)!=null?i:1;switch(e.type){case"daily":return m(v(t,a));case"weekly":if(e.daysOfWeek&&e.daysOfWeek.length>0){let n=t.getDay(),l=[...e.daysOfWeek].sort((d,u)=>d-u),r=l.find(d=>d>n);if(r!==void 0){let d=r-n;return m(v(t,d))}r=l[0];let c=7-n+r;return m(v(t,c))}return m(le(t,a));case"monthly":return m(K(t,a));case"yearly":return m(ke(t,a));case"custom":return m(v(t,a));default:return null}}pushUndo(s){this.undoStack.push(s),this.undoStack.length>this.maxUndoEntries&&this.undoStack.shift()}async undo(){let s=this.undoStack.pop();if(!s)return{success:!1,error:"Nothing to undo"};try{let e=this.app.vault.getAbstractFileByPath(s.filePath);if(!e||!(e instanceof J.TFile))return{success:!1,error:"File not found"};let a=(await this.app.vault.read(e)).split(`
`);s.newLine===""?a.splice(s.lineNumber,0,s.originalLine):a[s.lineNumber]=s.originalLine;let i=a.join(`
`);return await this.app.vault.modify(e,i),new J.Notice("Undo successful"),{success:!0}}catch(e){let t=e instanceof Error?e.message:"Unknown error";return console.error("Error undoing:",e),{success:!1,error:t}}}canUndo(){return this.undoStack.length>0}clearUndoStack(){this.undoStack=[]}async updateTaskStage(s,e){let t={stage:e};return e==="Completed"?t.completed=!0:s.completed&&(t.completed=!1),this.updateTask(s,t)}async bulkUpdate(s,e){let t={successful:0,failed:0,errors:[]};for(let a of s){let i=await this.updateTask(a,e);i.success?t.successful++:(t.failed++,i.error&&t.errors.push(`${a.text}: ${i.error}`))}return t}async bulkDelete(s){let e={successful:0,failed:0,errors:[]},t=[...s].sort((a,i)=>a.file.path!==i.file.path?a.file.path.localeCompare(i.file.path):i.lineNumber-a.lineNumber);for(let a of t){let i=await this.deleteTask(a);i.success?e.successful++:(e.failed++,i.error&&e.errors.push(`${a.text}: ${i.error}`))}return e}};var De=require("obsidian");function Ve(o){let s=o.match(/([^/\\]+):(\d+)$/);return s?`${s[1].replace(".md","")}:${s[2]}`:o}function Fe(o,s){if(o.includes("/")||o.includes("\\"))return o;let e=o.match(/^([^:]+):(\d+)$/);if(!e)return null;let[,t,a]=e,i=parseInt(a,10);for(let n of s)if(n.file.basename.replace(".md","")===t&&n.lineNumber===i)return n.id;for(let n of s)if(n.file.path.includes(t)&&n.lineNumber===i)return n.id;return null}function ne(o,s){let e=new Map(s.map(i=>[i.id,i])),t=[];for(let i of o.blockedBy){let n=Fe(i,s);if(n){let l=e.get(n);l&&!l.completed&&t.push(n)}else t.push(i)}let a=[];for(let i of o.blocks){let n=Fe(i,s);n?a.push(n):a.push(i)}for(let i of s)if(i.id!==o.id)for(let n of i.blockedBy)Fe(n,s)===o.id&&!a.includes(i.id)&&a.push(i.id);return{isBlocked:t.length>0,blockedByCount:t.length,blocksCount:a.length,blockedByTasks:t,blocksTasks:a}}function ve(o){return o.filter(s=>s.completed?!1:ne(s,o).isBlocked)}var we=class{constructor(s,e){this.checkInterval=null;this.lastNotifiedTasks=new Set;this.app=s,this.settings=e}updateSettings(s){this.settings=s,this.restartCheckInterval()}startCheckInterval(){if(!this.settings.enableNotifications)return;this.stopCheckInterval();let s=this.settings.reminderCheckIntervalMinutes*60*1e3;this.checkInterval=window.setInterval(()=>{},s),this.settings.debugMode&&console.log(`Notification check interval started: ${this.settings.reminderCheckIntervalMinutes} minutes`)}stopCheckInterval(){this.checkInterval&&(window.clearInterval(this.checkInterval),this.checkInterval=null)}restartCheckInterval(){this.stopCheckInterval(),this.startCheckInterval()}getNotificationSummary(s){let e=s.filter(c=>!c.completed),t=D(),a=v(t,this.settings.upcomingDays),i=[],n=[],l=[];for(let c of e)if(c.dueDate)if(S(c.dueDate))i.push(c);else if($(c.dueDate))n.push(c);else{let d=R(c.dueDate);d&&d>t&&d<=a&&l.push(c)}let r=ve(e);return{overdueTasks:i,dueTodayTasks:n,upcomingTasks:l,blockedTasks:r,totalActionable:i.length+n.length+l.length}}showStartupNotification(s){if(!this.settings.enableNotifications||!this.settings.notifyOnStartup)return;let e=[];this.settings.notifyOverdueTasks&&s.overdueTasks.length>0&&e.push(`\u{1F534} ${s.overdueTasks.length} overdue`),this.settings.notifyDueToday&&s.dueTodayTasks.length>0&&e.push(`\u{1F7E1} ${s.dueTodayTasks.length} due today`),this.settings.notifyUpcoming&&s.upcomingTasks.length>0&&e.push(`\u{1F535} ${s.upcomingTasks.length} upcoming`),e.length>0&&new De.Notice(`Task Consolidator: ${e.join(", ")}`,5e3)}notifyTaskDue(s){if(!this.settings.enableNotifications||this.lastNotifiedTasks.has(s.id))return;this.lastNotifiedTasks.add(s.id),setTimeout(()=>{this.lastNotifiedTasks.delete(s.id)},5*60*1e3);let e="";S(s.dueDate)?e="\u{1F534} OVERDUE":$(s.dueDate)&&(e="\u{1F7E1} Due Today");let t=`${e}: ${s.text}`;new De.Notice(t,8e3)}checkAndNotify(s){if(!this.settings.enableNotifications)return;let e=Date.now(),t=this.getNotificationSummary(s),a=this.settings.reminderCheckIntervalMinutes*60*1e3;if(e-this.settings.lastNotificationCheck<a)return;let i=[];this.settings.notifyOverdueTasks&&t.overdueTasks.length>0&&i.push(`\u{1F534} ${t.overdueTasks.length} overdue task${t.overdueTasks.length>1?"s":""}`),this.settings.notifyDueToday&&t.dueTodayTasks.length>0&&i.push(`\u{1F7E1} ${t.dueTodayTasks.length} task${t.dueTodayTasks.length>1?"s":""} due today`),i.length>0&&new De.Notice(`Reminder: ${i.join(", ")}`,6e3)}formatSummaryText(s){let e=[];return s.overdueTasks.length>0&&e.push(`\u{1F534} Overdue: ${s.overdueTasks.length}`),s.dueTodayTasks.length>0&&e.push(`\u{1F7E1} Due today: ${s.dueTodayTasks.length}`),s.upcomingTasks.length>0&&e.push(`\u{1F535} Upcoming (${this.settings.upcomingDays} days): ${s.upcomingTasks.length}`),s.blockedTasks.length>0&&e.push(`\u{1F6AB} Blocked: ${s.blockedTasks.length}`),e.join(`
`)}getBadgeCount(s){return this.settings.showNotificationBadge?s.overdueTasks.length+s.dueTodayTasks.length:0}destroy(){this.stopCheckInterval(),this.lastNotifiedTasks.clear()}};var V=require("obsidian");var be=class{constructor(s,e={}){this.focusedIndex=-1;var t;this.container=s,this.itemSelector=(t=e.itemSelector)!=null?t:".task-item",this.onSelect=e.onSelect,this.onActivate=e.onActivate,this.setupKeyboardNavigation()}getItems(){return Array.from(this.container.querySelectorAll(this.itemSelector))}setupKeyboardNavigation(){this.container.addEventListener("keydown",s=>this.handleKeyDown(s)),this.container.hasAttribute("tabindex")||this.container.setAttribute("tabindex","0"),this.container.setAttribute("role","listbox"),this.container.setAttribute("aria-label","Task list")}handleKeyDown(s){var t,a;let e=this.getItems();if(e.length!==0)switch(s.key){case j.ARROW_DOWN:s.preventDefault(),this.focusNext(e);break;case j.ARROW_UP:s.preventDefault(),this.focusPrevious(e);break;case j.HOME:s.preventDefault(),this.focusFirst(e);break;case j.END:s.preventDefault(),this.focusLast(e);break;case j.ENTER:this.focusedIndex>=0&&e[this.focusedIndex]&&(s.preventDefault(),(t=this.onActivate)==null||t.call(this,e[this.focusedIndex],this.focusedIndex));break;case j.SPACE:this.focusedIndex>=0&&e[this.focusedIndex]&&(s.preventDefault(),(a=this.onSelect)==null||a.call(this,e[this.focusedIndex],this.focusedIndex));break;case j.ESCAPE:s.preventDefault(),this.clearFocus(e);break}}focusNext(s){this.focusedIndex<s.length-1&&this.setFocus(s,this.focusedIndex+1)}focusPrevious(s){this.focusedIndex>0?this.setFocus(s,this.focusedIndex-1):this.focusedIndex===-1&&s.length>0&&this.setFocus(s,s.length-1)}focusFirst(s){s.length>0&&this.setFocus(s,0)}focusLast(s){s.length>0&&this.setFocus(s,s.length-1)}setFocus(s,e){if(this.focusedIndex>=0&&s[this.focusedIndex]){let a=s[this.focusedIndex];a.classList.remove("task-focused"),a.removeAttribute("aria-selected")}this.focusedIndex=e;let t=s[e];t&&(t.classList.add("task-focused"),t.setAttribute("aria-selected","true"),t.scrollIntoView({block:"nearest",behavior:"smooth"}),this.container.setAttribute("aria-activedescendant",t.id||`task-item-${e}`),t.id||(t.id=`task-item-${e}`))}clearFocus(s){if(this.focusedIndex>=0&&s[this.focusedIndex]){let e=s[this.focusedIndex];e.classList.remove("task-focused"),e.removeAttribute("aria-selected")}this.focusedIndex=-1,this.container.removeAttribute("aria-activedescendant")}destroy(){this.container.removeAttribute("role"),this.container.removeAttribute("aria-label"),this.container.removeAttribute("aria-activedescendant")}};function rt(o,s="polite"){let e=document.createElement("div");e.setAttribute("role","status"),e.setAttribute("aria-live",s),e.setAttribute("aria-atomic","true"),e.classList.add("sr-only"),e.textContent=o,document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},1e3)}function ot(){return[{shortcut:"\u2191/\u2193",description:"Navigate tasks"},{shortcut:"Home/End",description:"Jump to first/last task"},{shortcut:"Enter",description:"Open task in editor"},{shortcut:"Space",description:"Toggle task selection"},{shortcut:"Escape",description:"Clear selection"},{shortcut:"Ctrl+Shift+T",description:"Quick add task"},{shortcut:"/",description:"Focus search"},{shortcut:"?",description:"Show keyboard shortcuts"}]}var lt=require("obsidian");var Se=class extends lt.Modal{constructor(s){super(s)}onOpen(){let{contentEl:s}=this;s.addClass("keyboard-help-modal"),s.createEl("h2",{text:"Keyboard Shortcuts"});let e=s.createEl("ul",{cls:"keyboard-help-list"}),t=ot();for(let{shortcut:i,description:n}of t){let l=e.createEl("li",{cls:"keyboard-help-item"});l.createEl("kbd",{text:i,cls:"keyboard-help-key"}),l.createEl("span",{text:n,cls:"keyboard-help-description"})}let a=s.createEl("button",{text:"Close",cls:"mod-cta",attr:{"aria-label":"Close keyboard shortcuts help"}});a.style.marginTop="16px",a.addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var ce=class extends V.ItemView{constructor(e,t){super(e);this.filteredTasks=[];this.selectedTasks=new Set;this.keyboardHandler=null;this.taskListContainer=null;this.liveRegion=null;this.plugin=t,this.taskCache=t.taskCache,this.taskUpdater=t.taskUpdater}getViewType(){return Y}getDisplayText(){return"Task Consolidator"}getIcon(){return"list-checks"}async onOpen(){this.containerEl.empty(),this.containerEl.addClass("task-consolidator-view"),this.liveRegion=this.containerEl.createDiv({cls:"sr-only",attr:{role:"status","aria-live":"polite","aria-atomic":"true"}}),this.setupGlobalKeyboardShortcuts(),await this.render()}async onClose(){this.selectedTasks.clear(),this.keyboardHandler&&(this.keyboardHandler.destroy(),this.keyboardHandler=null)}setupGlobalKeyboardShortcuts(){this.containerEl.addEventListener("keydown",e=>{var t;if(e.key===j.SLASH&&!this.isInputFocused()){e.preventDefault();let a=this.containerEl.querySelector(".task-search-input");a&&(a.focus(),this.announce("Search focused"))}if(e.key===j.QUESTION_MARK&&e.shiftKey&&!this.isInputFocused()&&(e.preventDefault(),this.showKeyboardHelp()),e.key===j.ESCAPE){let a=document.activeElement;(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)&&(a.blur(),(t=this.taskListContainer)==null||t.focus())}})}isInputFocused(){let e=document.activeElement;return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement}announce(e){this.liveRegion&&(this.liveRegion.textContent=e,setTimeout(()=>{this.liveRegion&&(this.liveRegion.textContent="")},1e3)),rt(e)}showKeyboardHelp(){new Se(this.app).open()}async refresh(){await this.render()}async render(){this.containerEl.empty(),this.renderHeader(),this.renderControls(),this.renderFilters(),this.applyFilters(),this.renderTaskSections()}renderHeader(){let t=this.containerEl.createDiv({cls:"task-consolidator-header"}).createDiv({cls:"task-header-title-row"});t.createEl("h4",{text:"All Tasks"});let a=this.taskCache.getTaskStats();t.createSpan({cls:"task-header-stats"}).setText(`${a.active} active, ${a.completed} completed`),a.overdue>0&&t.createSpan({cls:"task-header-overdue"}).setText(`${a.overdue} overdue`)}renderControls(){let e=this.containerEl.createDiv({cls:"task-consolidator-controls"});e.createSpan({text:"Sort: "});let t=e.createEl("select",{cls:"dropdown"});for(let i of ue){let n=t.createEl("option",{text:G(i),value:i});i===this.plugin.settings.sortBy&&(n.selected=!0)}t.addEventListener("change",async()=>{this.plugin.settings.sortBy=t.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Group: "});let a=e.createEl("select",{cls:"dropdown"});for(let i of he){let n=a.createEl("option",{text:G(i),value:i});i===this.plugin.settings.groupBy&&(n.selected=!0)}a.addEventListener("change",async()=>{this.plugin.settings.groupBy=a.value,await this.plugin.saveSettings(),await this.refresh()}),e.createEl("button",{text:"\u21BB Refresh",attr:{"aria-label":"Refresh tasks"}}).addEventListener("click",async()=>{await this.plugin.refreshTasks(),await this.refresh(),new V.Notice("Tasks refreshed")}),e.createEl("button",{text:"+ Add Task",cls:"task-add-btn",attr:{"aria-label":"Add new task"}}).addEventListener("click",()=>{this.plugin.openQuickAdd()}),e.createEl("button",{text:"Kanban",cls:"kanban-btn",attr:{"aria-label":"Open Kanban board"}}).addEventListener("click",()=>{this.plugin.openKanban()}),e.createEl("button",{text:"Calendar",cls:"calendar-btn",attr:{"aria-label":"Open Calendar view"}}).addEventListener("click",()=>{this.plugin.openCalendar()}),this.plugin.settings.enableDailyNoteIntegration&&this.plugin.settings.showDailyNoteButton&&e.createEl("button",{text:"Daily Note",cls:"daily-note-btn",attr:{"aria-label":"Open today's daily note"}}).addEventListener("click",()=>{this.plugin.openDailyNote()}),e.createEl("button",{text:"Dashboard",cls:"dashboard-btn",attr:{"aria-label":"Open Project Dashboard"}}).addEventListener("click",()=>{this.plugin.openProjectDashboard()}),e.createEl("button",{text:"?",cls:"task-help-btn",attr:{"aria-label":"Show keyboard shortcuts"}}).addEventListener("click",()=>{this.showKeyboardHelp()})}renderFilters(){let e=this.containerEl.createDiv({cls:"task-consolidator-filters"}),a=e.createDiv({cls:"task-search-container"}).createEl("input",{type:"text",placeholder:"Search tasks...",cls:"task-search-input",value:this.plugin.settings.searchQuery});a.addEventListener("input",async()=>{this.plugin.settings.searchQuery=a.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Owner: "});let i=e.createEl("select",{cls:"dropdown"});i.createEl("option",{text:"All",value:""});for(let d of this.taskCache.getUniqueOwners()){let u=i.createEl("option",{text:d,value:d});d===this.plugin.settings.filterOwner&&(u.selected=!0)}i.addEventListener("change",async()=>{this.plugin.settings.filterOwner=i.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Project: "});let n=e.createEl("select",{cls:"dropdown"});n.createEl("option",{text:"All",value:""});for(let d of this.taskCache.getUniqueProjects()){let u=n.createEl("option",{text:d,value:d});d===this.plugin.settings.filterProject&&(u.selected=!0)}n.addEventListener("change",async()=>{this.plugin.settings.filterProject=n.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Stage: "});let l=e.createEl("select",{cls:"dropdown"});l.createEl("option",{text:"All",value:""});for(let d of L){let u=l.createEl("option",{text:d,value:d});d===this.plugin.settings.filterStage&&(u.selected=!0)}l.addEventListener("change",async()=>{this.plugin.settings.filterStage=l.value,await this.plugin.saveSettings(),await this.refresh()});let r=this.containerEl.createDiv({cls:"task-quick-filters"}),c=this.taskCache.getTaskStats();r.createEl("button",{text:`Today (${c.dueToday})`,cls:"quick-filter-btn"}).addEventListener("click",async()=>{this.plugin.settings.filterDueDate="today",await this.plugin.saveSettings(),await this.refresh()}),r.createEl("button",{text:`Overdue (${c.overdue})`,cls:"quick-filter-btn overdue"}).addEventListener("click",async()=>{this.plugin.settings.filterDueDate="overdue",await this.plugin.saveSettings(),await this.refresh()}),r.createEl("button",{text:"Clear Filters",cls:"quick-filter-btn clear"}).addEventListener("click",async()=>{this.plugin.settings.filterOwner="",this.plugin.settings.filterProject="",this.plugin.settings.filterStage="",this.plugin.settings.filterDueDate="",this.plugin.settings.searchQuery="",await this.plugin.saveSettings(),await this.refresh()})}applyFilters(){let e=this.taskCache.getAllTasks(),t=this.plugin.settings;if(t.searchQuery){let a=t.searchQuery.toLowerCase();e=e.filter(i=>{var n,l;return i.text.toLowerCase().includes(a)||((n=i.owner)==null?void 0:n.toLowerCase().includes(a))||((l=i.project)==null?void 0:l.toLowerCase().includes(a))||i.tags.some(r=>r.toLowerCase().includes(a))})}t.filterOwner&&(e=e.filter(a=>a.owner===t.filterOwner)),t.filterProject&&(e=e.filter(a=>a.project===t.filterProject)),t.filterStage&&(e=e.filter(a=>a.stage===t.filterStage)),t.filterDueDate==="today"?e=e.filter(a=>$(a.dueDate)):t.filterDueDate==="overdue"?e=e.filter(a=>S(a.dueDate)&&!a.completed):t.filterDueDate&&(e=e.filter(a=>a.dueDate===t.filterDueDate)),t.filterPriority&&(e=e.filter(a=>a.priority===t.filterPriority)),this.filteredTasks=e}renderTaskSections(){this.keyboardHandler&&(this.keyboardHandler.destroy(),this.keyboardHandler=null);let e=this.filteredTasks.filter(c=>!c.completed),t=this.filteredTasks.filter(c=>c.completed),a=this.sortTasks(e),i=this.sortTasks(t),n=this.containerEl.createDiv({cls:"task-section"});if(n.createEl("h5",{text:`Active Tasks (${a.length})`,attr:{id:"active-tasks-heading"}}),a.length===0)n.createEl("p",{text:"No active tasks found",cls:"task-empty"});else if(this.plugin.settings.groupBy!=="none"){let c=this.groupTasks(a);this.renderGroupedTasks(n,c,"active")}else{let c=n.createDiv({cls:"task-list",attr:{role:"listbox","aria-labelledby":"active-tasks-heading",tabindex:"0"}});this.taskListContainer=c;for(let d of a)this.renderTask(c,d);this.setupKeyboardNavigation(c)}let l=this.containerEl.createDiv({cls:"task-section"}),r=l.createDiv({cls:"task-section-header"});if(r.createEl("span",{text:this.plugin.settings.showCompleted?"\u25BC":"\u25B6",cls:"task-section-toggle"}),r.createEl("h5",{text:`Completed Tasks (${i.length})`,cls:"task-section-title"}),r.addEventListener("click",async()=>{this.plugin.settings.showCompleted=!this.plugin.settings.showCompleted,await this.plugin.saveSettings(),await this.refresh()}),this.plugin.settings.showCompleted&&i.length>0)if(this.plugin.settings.groupBy!=="none"){let c=this.groupTasks(i);this.renderGroupedTasks(l,c,"completed")}else{let c=l.createDiv({cls:"task-list"});for(let d of i)this.renderTask(c,d)}}sortTasks(e){let t=[...e],a=this.plugin.settings.sortBy;return t.sort((i,n)=>{var l,r;switch(a){case"dueDate":return ae(i.dueDate,n.dueDate);case"owner":return!i.owner&&!n.owner?0:i.owner?n.owner?i.owner.localeCompare(n.owner):-1:1;case"priority":{let c={high:0,medium:1,low:2},d=i.priority?c[i.priority]:3,u=n.priority?c[n.priority]:3;return d-u}case"project":return!i.project&&!n.project?0:i.project?n.project?i.project.localeCompare(n.project):-1:1;case"created":return ae(i.createdDate,n.createdDate);case"stage":{let c=L.reduce((p,h,g)=>({...p,[h]:g}),{}),d=i.stage&&(l=c[i.stage])!=null?l:99,u=n.stage&&(r=c[n.stage])!=null?r:99;return d-u}default:return 0}}),t}groupTasks(e){var i,n,l,r,c;let t=new Map,a=this.plugin.settings.groupBy;for(let d of e){let u;switch(a){case"dueDate":u=(i=d.dueDate)!=null?i:"No Date";break;case"owner":u=(n=d.owner)!=null?n:"No Owner";break;case"project":u=(l=d.project)!=null?l:"No Project";break;case"stage":u=(r=d.stage)!=null?r:"Unassigned";break;case"priority":u=(c=d.priority)!=null?c:"No Priority";break;default:u="All"}t.has(u)||t.set(u,[]),t.get(u).push(d)}return t}renderGroupedTasks(e,t,a){var n;let i=this.plugin.settings.groupBy;for(let[l,r]of t){let c=`${a}-${l}`,d=(n=this.plugin.settings.collapsedGroups[c])!=null?n:!1,u=e.createDiv({cls:"task-group"}),p=u.createDiv({cls:"task-group-header"});p.createEl("span",{text:d?"\u25B6":"\u25BC",cls:"task-group-toggle"});let h=ze[i];if(p.createEl("span",{text:`${h} ${l} (${r.length})`,cls:"task-group-title"}),p.addEventListener("click",async()=>{this.plugin.settings.collapsedGroups[c]=!d,await this.plugin.saveSettings(),await this.refresh()}),!d){let g=u.createDiv({cls:"task-list"});for(let C of r)this.renderTask(g,C)}}}renderTask(e,t){let a=e.createDiv({cls:"task-item",attr:{role:"option","aria-selected":"false",tabindex:"-1"}});S(t.dueDate)&&!t.completed&&a.addClass("overdue"),$(t.dueDate)&&!t.completed&&a.addClass("due-today"),t.priority&&a.addClass(`priority-${t.priority}`);let i=[t.text];if(t.priority&&i.push(`Priority: ${t.priority}`),t.dueDate){let p=X(t.dueDate);i.push(`Due: ${p}`),S(t.dueDate)&&!t.completed&&i.push("Overdue")}t.owner&&i.push(`Owner: ${t.owner}`),t.project&&i.push(`Project: ${t.project}`),a.setAttribute("aria-label",i.join(", "));let n=a.createEl("input",{type:"checkbox",attr:{"aria-label":`Toggle task: ${t.text}`}});n.checked=t.completed,n.addEventListener("change",async()=>{let p=await this.taskUpdater.toggleTask(t);p.success?(new V.Notice(t.completed?"Task unchecked":"Task checked"),await this.plugin.refreshTasks(),await this.refresh()):(new V.Notice(`Error: ${p.error}`),n.checked=t.completed)});let l=a.createDiv({cls:"task-content"}),r=l.createDiv({cls:"task-text"});r.setText(t.text),t.completed&&r.addClass("task-completed");let c=l.createDiv({cls:"task-metadata"});if(t.priority&&c.createSpan({text:`${se[t.priority]} ${t.priority}`,cls:`task-priority priority-${t.priority}`}),t.dueDate){let p=X(t.dueDate),h=c.createSpan({text:`\u{1F4C5} ${p}`,cls:"task-due-date"});S(t.dueDate)&&!t.completed&&h.addClass("overdue")}t.owner&&c.createSpan({text:`\u{1F464} ${t.owner}`,cls:"task-owner"}),t.project&&c.createSpan({text:`\u{1F4C1} ${t.project}`,cls:"task-project"}),t.stage&&c.createSpan({text:`\u{1F4CB} ${t.stage}`,cls:"task-stage"}),t.recurrence&&c.createSpan({text:"\u{1F504}",cls:"task-recurring",attr:{title:"Recurring task"}});let d=this.taskCache.getFilteredTasks({}),u=ne(t,d);if(u.isBlocked){let p=u.blockedByTasks.map(h=>Ve(h)).join(", ");a.addClass("task-blocked"),c.createSpan({text:`\u{1F6AB} Blocked (${u.blockedByCount})`,cls:"task-dependency task-blocked-indicator",attr:{title:`Blocked by: ${p}`}})}if(u.blocksCount>0&&!t.completed){let p=u.blocksTasks.map(h=>Ve(h)).join(", ");a.addClass("task-blocker"),c.createSpan({text:`\u23F3 Blocks (${u.blocksCount})`,cls:"task-dependency task-blocker-indicator",attr:{title:`Blocks: ${p}`}})}if(t.tags.length>0){let p=c.createDiv({cls:"task-tags"});for(let h of t.tags)p.createSpan({text:`#${h}`,cls:"task-tag"})}c.createEl("a",{text:`\u{1F4C4} ${t.file.basename}`,cls:"task-file-link",attr:{"aria-label":`Open ${t.file.name}`}}).addEventListener("click",async p=>{p.preventDefault(),await this.openTaskInEditor(t)})}async openTaskInEditor(e){await this.app.workspace.getLeaf(!1).openFile(e.file);let t=this.app.workspace.getActiveViewOfType(V.MarkdownView);if(t!=null&&t.editor){let a=t.editor;a.setCursor({line:e.lineNumber,ch:0}),a.scrollIntoView({from:{line:e.lineNumber,ch:0},to:{line:e.lineNumber,ch:0}},!0)}}setupKeyboardNavigation(e){this.keyboardHandler=new be(e,{itemSelector:".task-item",onSelect:async(t,a)=>{let i=this.filteredTasks.filter(n=>!n.completed)[a];if(i){let n=await this.taskUpdater.toggleTask(i);if(n.success){let l=i.completed?"unchecked":"checked";this.announce(`Task ${l}: ${i.text}`),new V.Notice(`Task ${l}`),await this.plugin.refreshTasks(),await this.refresh()}else new V.Notice(`Error: ${n.error}`)}},onActivate:async(t,a)=>{let i=this.filteredTasks.filter(n=>!n.completed)[a];i&&(this.announce(`Opening task: ${i.text}`),await this.openTaskInEditor(i))}})}};var B=require("obsidian");var xe=class extends B.Modal{constructor(s,e){super(s),this.plugin=e,this.taskCache=e.taskCache,this.taskUpdater=e.taskUpdater,this.settings=e.settings,this.filteredProject=this.settings.kanbanFilterProject}onOpen(){let{contentEl:s,modalEl:e}=this;e.addClass("kanban-modal"),s.addClass("kanban-modal-content"),this.renderHeader(s),this.renderBoard(s)}onClose(){let{contentEl:s}=this;s.empty()}renderHeader(s){let e=s.createDiv({cls:"kanban-header"});e.createEl("h2",{text:"Kanban Board"});let t=e.createDiv({cls:"kanban-filter"});t.createSpan({text:"Project: "});let a=t.createEl("select");a.createEl("option",{text:"All Projects",value:""});let i=this.taskCache.getUniqueProjects();for(let n of i){let l=a.createEl("option",{text:n,value:n});n===this.filteredProject&&(l.selected=!0)}a.addEventListener("change",async()=>{this.filteredProject=a.value,this.settings.kanbanFilterProject=this.filteredProject,await this.plugin.saveSettings(),this.refreshBoard()}),e.createEl("button",{text:"\u2715 Close",cls:"kanban-close-btn"}).addEventListener("click",()=>this.close())}renderBoard(s){let e=s.querySelector(".kanban-board");e&&e.remove();let t=s.createDiv({cls:"kanban-board"});for(let a of Ye)this.renderColumn(t,a)}renderColumn(s,e){var l;let t=s.createDiv({cls:"kanban-column"});t.dataset.stage=(l=e.stage)!=null?l:"unassigned";let a=this.getTasksForColumn(e);t.createDiv({cls:"kanban-column-header"}).createEl("h3",{text:`${e.title} (${a.length})`});let n=t.createDiv({cls:"kanban-column-body"});this.setupDropZone(n,e.stage);for(let r of a)this.renderTaskCard(n,r)}getTasksForColumn(s){let e=this.taskCache.getAllTasks();this.filteredProject&&(e=e.filter(a=>a.project===this.filteredProject));let t;return s.stage===null?t=e.filter(a=>!a.stage&&!a.completed):s.stage==="Completed"?t=e.filter(a=>a.completed||a.stage==="Completed"):t=e.filter(a=>a.stage===s.stage&&!a.completed),s.stage==="Completed"?t.sort((a,i)=>ae(i.completedDate,a.completedDate)):t.sort((a,i)=>ae(a.dueDate,i.dueDate)),t}renderTaskCard(s,e){let t=s.createDiv({cls:"kanban-card"});t.draggable=!0,t.dataset.filePath=e.file.path,t.dataset.lineNumber=String(e.lineNumber),S(e.dueDate)&&!e.completed&&t.addClass("overdue"),e.priority&&t.addClass(`priority-${e.priority}`),t.createDiv({cls:"kanban-card-title"}).setText(e.text);let a=t.createDiv({cls:"kanban-card-meta"});if(e.priority&&a.createSpan({cls:"kanban-card-priority",text:se[e.priority]}),e.owner&&a.createSpan({cls:"kanban-card-owner",text:`\u{1F464} ${e.owner}`}),e.dueDate){let i=X(e.dueDate),n=a.createSpan({cls:"kanban-card-date",text:`\u{1F4C5} ${i}`});S(e.dueDate)&&!e.completed&&n.addClass("overdue")}e.project&&a.createSpan({cls:"kanban-card-project",text:`\u{1F4C1} ${e.project}`}),e.recurrence&&a.createSpan({cls:"kanban-card-recurring",text:"\u{1F504}"}),a.createEl("a",{cls:"kanban-card-file",text:`\u{1F4C4} ${e.file.basename}`}).addEventListener("click",i=>{i.stopPropagation(),this.openTaskInEditor(e)}),this.setupDragEvents(t,e)}setupDragEvents(s,e){s.addEventListener("dragstart",t=>{var a;s.classList.add("dragging"),(a=t.dataTransfer)==null||a.setData("text/plain",JSON.stringify({filePath:e.file.path,lineNumber:e.lineNumber,taskId:e.id})),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}),s.addEventListener("dragend",()=>{s.classList.remove("dragging"),this.contentEl.querySelectorAll(".drag-over").forEach(t=>{t.classList.remove("drag-over")})})}setupDropZone(s,e){s.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move"),s.classList.add("drag-over")}),s.addEventListener("dragleave",t=>{s.contains(t.relatedTarget)||s.classList.remove("drag-over")}),s.addEventListener("drop",async t=>{var a,i;t.preventDefault(),s.classList.remove("drag-over");try{let n=JSON.parse((i=(a=t.dataTransfer)==null?void 0:a.getData("text/plain"))!=null?i:"{}"),l=this.taskCache.getAllTasks().find(c=>c.id===n.taskId);if(!l){new B.Notice("Task not found");return}let r=await this.taskUpdater.updateTaskStage(l,e);r.success?(new B.Notice(`Task moved to ${e!=null?e:"Unassigned"}`),await this.plugin.refreshTasks(),this.refreshBoard()):new B.Notice(`Error: ${r.error}`)}catch(n){console.error("Error handling drop:",n),new B.Notice("Error moving task")}})}refreshBoard(){this.renderBoard(this.contentEl)}async openTaskInEditor(s){await this.app.workspace.getLeaf(!1).openFile(s.file);let e=this.app.workspace.getActiveViewOfType(B.MarkdownView);if(e!=null&&e.editor){let t=e.editor;t.setCursor({line:s.lineNumber,ch:0}),t.scrollIntoView({from:{line:s.lineNumber,ch:0},to:{line:s.lineNumber,ch:0}},!0)}this.close()}};var x=require("obsidian");var re=require("obsidian");function ct(o,s){let e=o.getFullYear().toString(),t=(o.getMonth()+1).toString(),a=o.getDate().toString(),i=t.padStart(2,"0"),n=a.padStart(2,"0");return s.replace("YYYY",e).replace("MM",i).replace("DD",n).replace("M",t).replace("D",a)}function Mt(o,s){let e=ct(o,s.dailyNoteDateFormat),t=s.dailyNoteFolder.trim();return t?(0,re.normalizePath)(`${t}/${e}.md`):(0,re.normalizePath)(`${e}.md`)}async function Be(o,s,e){let t=Mt(s,e),a=o.vault.getAbstractFileByPath(t);if(a instanceof re.TFile)return a;let i=e.dailyNoteFolder.trim();if(i){let r=(0,re.normalizePath)(i);o.vault.getAbstractFileByPath(r)||await o.vault.createFolder(r)}let l=`# ${ct(s,e.dailyNoteDateFormat)}

${e.dailyNoteTasksHeading}

`;return await o.vault.create(t,l)}function At(o,s){let e=o.split(`
`),t=s.trim().toLowerCase();for(let a=0;a<e.length;a++)if(e[a].trim().toLowerCase()===t)return a;return-1}async function dt(o,s,e,t){let a=await Be(o,s,t),i=await o.vault.read(a),n=i.split(`
`),l=At(i,t.dailyNoteTasksHeading),r;if(l===-1)r=i.trim()+`

`+t.dailyNoteTasksHeading+`
- [ ] `+e+`
`;else{let c=l+1;for(;c<n.length&&n[c].trim()==="";)c++;n.splice(c,0,"- [ ] "+e),r=n.join(`
`)}return await o.vault.modify(a,r),a}var de=class extends x.Modal{constructor(e,t,a={}){var i;super(e);this.taskText="";this.selectedOwner="";this.selectedDueDate="";this.selectedProject="";this.selectedStage="";this.selectedPriority="";this.selectedTags=[];this.selectedFile=null;this.useQuickSyntax=!0;this.targetDailyNote=!1;if(this.plugin=t,this.taskCache=t.taskCache,this.taskUpdater=t.taskUpdater,this.settings=t.settings,this.options=a,this.targetDailyNote=(i=a.targetDailyNote)!=null?i:!1,this.selectedOwner=this.settings.defaultOwner,this.selectedProject=this.settings.defaultProject,this.targetDailyNote)this.selectedDueDate=new Date().toISOString().split("T")[0];else if(this.settings.defaultTargetFile){let n=this.app.vault.getAbstractFileByPath(this.settings.defaultTargetFile);n instanceof x.TFile&&(this.selectedFile=n)}}onOpen(){this.modalEl.addClass("quick-add-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty();let t=this.targetDailyNote?"Add Task to Daily Note":"Quick Add Task";e.createEl("h2",{text:t}),new x.Setting(e).setName("Quick Syntax Mode").setDesc("Use @owner, #project, !date, ^priority, +tag in the task text").addToggle(l=>l.setValue(this.useQuickSyntax).onChange(r=>{this.useQuickSyntax=r,this.render()}));let i=e.createDiv({cls:"quick-add-input-container"}).createEl("textarea",{cls:"quick-add-task-input",placeholder:this.useQuickSyntax?"Buy groceries @John !tomorrow #personal ^high +shopping":"Enter task description..."});if(i.value=this.taskText,i.addEventListener("input",()=>{this.taskText=i.value,this.useQuickSyntax&&(this.parseQuickSyntax(),this.updatePreview())}),setTimeout(()=>i.focus(),50),this.useQuickSyntax){let l=e.createDiv({cls:"quick-add-preview"});l.id="quick-add-preview",this.updatePreview()}this.useQuickSyntax||this.renderExpandedFields(e),this.targetDailyNote?e.createDiv({cls:"quick-add-daily-note-info"}).createEl("p",{text:"Task will be added to today's daily note",cls:"setting-item-description"}):new x.Setting(e).setName("Target File").setDesc("File where the task will be created").addDropdown(l=>{l.addOption("","Select a file...");let r=this.app.vault.getMarkdownFiles().sort((c,d)=>c.path.localeCompare(d.path));for(let c of r)l.addOption(c.path,c.path);this.selectedFile&&l.setValue(this.selectedFile.path),l.onChange(c=>{let d=this.app.vault.getAbstractFileByPath(c);this.selectedFile=d instanceof x.TFile?d:null})});let n=e.createDiv({cls:"quick-add-buttons"});n.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"Create Task",cls:"mod-cta"}).addEventListener("click",()=>void this.createTask()),i.addEventListener("keydown",l=>{l.key==="Enter"&&(l.ctrlKey||l.metaKey)&&(l.preventDefault(),this.createTask())})}renderExpandedFields(e){new x.Setting(e).setName("Owner").addDropdown(t=>{t.addOption("","None");for(let a of this.taskCache.getUniqueOwners())t.addOption(a,a);t.setValue(this.selectedOwner),t.onChange(a=>this.selectedOwner=a)}).addText(t=>t.setPlaceholder("Or enter new...").onChange(a=>{a&&(this.selectedOwner=a)})),new x.Setting(e).setName("Due Date").addText(t=>t.setPlaceholder('YYYY-MM-DD or "tomorrow"').setValue(this.selectedDueDate).onChange(a=>{let i=je(a);this.selectedDueDate=i!=null?i:a})),new x.Setting(e).setName("Project").addDropdown(t=>{t.addOption("","None");for(let a of this.taskCache.getUniqueProjects())t.addOption(a,a);t.setValue(this.selectedProject),t.onChange(a=>this.selectedProject=a)}).addText(t=>t.setPlaceholder("Or enter new...").onChange(a=>{a&&(this.selectedProject=a)})),new x.Setting(e).setName("Stage").addDropdown(t=>{t.addOption("","None");for(let a of L)t.addOption(a,a);t.setValue(this.selectedStage),t.onChange(a=>this.selectedStage=a)}),new x.Setting(e).setName("Priority").addDropdown(t=>{t.addOption("","None");for(let a of U)t.addOption(a,a.charAt(0).toUpperCase()+a.slice(1));t.setValue(this.selectedPriority),t.onChange(a=>this.selectedPriority=a)}),new x.Setting(e).setName("Tags").setDesc("Comma-separated tags").addText(t=>t.setPlaceholder("tag1, tag2, tag3").setValue(this.selectedTags.join(", ")).onChange(a=>{this.selectedTags=a.split(",").map(i=>i.trim().replace(/^#/,"")).filter(i=>i.length>0)}))}parseQuickSyntax(){let e=this.taskText,t=e.match(b.OWNER);t&&(this.selectedOwner=t[1].trim(),e=e.replace(b.OWNER,""));let a=e.match(b.PROJECT);a&&(this.selectedProject=a[1],e=e.replace(b.PROJECT,""));let i=e.match(b.DATE);if(i){let r=je(i[1]);this.selectedDueDate=r!=null?r:"",e=e.replace(b.DATE,"")}let n=e.match(b.PRIORITY);if(n){let r=n[1].toLowerCase();r==="h"||r==="high"?this.selectedPriority="high":r==="m"||r==="med"||r==="medium"?this.selectedPriority="medium":(r==="l"||r==="low")&&(this.selectedPriority="low"),e=e.replace(b.PRIORITY,"")}let l=[...e.matchAll(b.TAG)];this.selectedTags=l.map(r=>r[1].toLowerCase()),e=e.replace(b.TAG,""),this.taskText=e.replace(/\s+/g," ").trim()}updatePreview(){let e=document.getElementById("quick-add-preview");if(!e)return;e.empty(),e.createEl("strong",{text:"Preview: "});let t=[],a=this.taskText;if(a=a.replace(b.OWNER,""),a=a.replace(b.PROJECT,""),a=a.replace(b.DATE,""),a=a.replace(b.PRIORITY,""),a=a.replace(b.TAG,""),a=a.replace(/\s+/g," ").trim(),a&&t.push(`"${a}"`),this.selectedOwner&&t.push(`\u{1F464} ${this.selectedOwner}`),this.selectedDueDate&&t.push(`\u{1F4C5} ${this.selectedDueDate}`),this.selectedProject&&t.push(`\u{1F4C1} ${this.selectedProject}`),this.selectedPriority){let i={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"};t.push(`${i[this.selectedPriority]} ${this.selectedPriority}`)}this.selectedTags.length>0&&t.push(`\u{1F3F7}\uFE0F ${this.selectedTags.map(i=>`#${i}`).join(" ")}`),e.createSpan({text:t.join(" | ")||"Enter task text..."})}async createTask(){var n;let e=this.taskText;this.useQuickSyntax&&(e=e.replace(b.OWNER,""),e=e.replace(b.PROJECT,""),e=e.replace(b.DATE,""),e=e.replace(b.PRIORITY,""),e=e.replace(b.TAG,""),e=e.replace(/\s+/g," ").trim());let t=ie(e);if(!t.isValid){new x.Notice((n=t.error)!=null?n:"Invalid task text");return}let a=[e];if(this.selectedOwner&&a.push(`@${this.selectedOwner}`),this.selectedDueDate&&a.push(`\u{1F4C5} ${this.selectedDueDate}`),this.selectedProject&&a.push(`#${this.selectedProject}`),this.selectedStage&&a.push(`[${this.selectedStage}]`),this.selectedPriority){let l={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"};a.push(l[this.selectedPriority]||"")}for(let l of this.selectedTags)a.push(`+${l}`);let i=a.filter(l=>l).join(" ");if(this.targetDailyNote)try{await dt(this.app,D(),i,this.settings),new x.Notice("Task added to daily note"),await this.plugin.refreshTasks(),this.close()}catch(l){new x.Notice(`Error: ${l.message}`)}else{if(!this.selectedFile){new x.Notice("Please select a target file");return}let l=await this.taskUpdater.createTask(this.selectedFile,e,{owner:this.selectedOwner||void 0,dueDate:this.selectedDueDate||void 0,project:this.selectedProject||void 0,stage:this.selectedStage||void 0,priority:this.selectedPriority||void 0,tags:this.selectedTags.length>0?this.selectedTags:void 0});l.success?(new x.Notice("Task created successfully"),await this.plugin.refreshTasks(),this.close()):new x.Notice(`Error: ${l.error}`)}}};var Z=require("obsidian");var Ce=class extends Z.Modal{constructor(e,t){super(e);this.viewMode="month";this.selectedDate=null;this.draggedTask=null;this.plugin=t,this.taskCache=t.taskCache,this.taskUpdater=t.taskUpdater,this.settings=t.settings,this.currentDate=D()}onOpen(){let{contentEl:e,modalEl:t}=this;t.addClass("calendar-modal"),e.addClass("calendar-modal-content"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;switch(e.empty(),this.renderHeader(e),this.renderViewToggle(e),this.viewMode){case"month":this.renderMonthView(e);break;case"week":this.renderWeekView(e);break;case"day":this.renderDayView(e);break}this.selectedDate&&this.renderSelectedDateTasks(e)}renderHeader(e){let t=e.createDiv({cls:"calendar-header"}),a=t.createDiv({cls:"calendar-nav"});a.createEl("button",{text:"\u25C0",cls:"calendar-nav-btn"}).addEventListener("click",()=>this.navigatePrevious()),a.createEl("h2",{cls:"calendar-title"}).setText(this.getHeaderTitle()),a.createEl("button",{text:"\u25B6",cls:"calendar-nav-btn"}).addEventListener("click",()=>this.navigateNext()),a.createEl("button",{text:"Today",cls:"calendar-today-btn"}).addEventListener("click",()=>{this.currentDate=D(),this.selectedDate=m(D()),this.render()}),t.createEl("button",{text:"\u2715 Close",cls:"calendar-close-btn"}).addEventListener("click",()=>this.close())}getHeaderTitle(){let e=q[this.currentDate.getMonth()],t=this.currentDate.getFullYear();switch(this.viewMode){case"month":return`${e.charAt(0).toUpperCase()+e.slice(1)} ${t}`;case"week":let a=Q(this.currentDate,this.settings.firstDayOfWeek),i=v(a,6);return`${this.formatShortDate(a)} - ${this.formatShortDate(i)}`;case"day":return this.formatFullDate(this.currentDate);default:return""}}formatShortDate(e){return`${q[e.getMonth()].slice(0,3)} ${e.getDate()}`}formatFullDate(e){let t=te[e.getDay()],a=q[e.getMonth()];return`${t.charAt(0).toUpperCase()+t.slice(1)}, ${a.charAt(0).toUpperCase()+a.slice(1)} ${e.getDate()}, ${e.getFullYear()}`}renderViewToggle(e){let t=e.createDiv({cls:"calendar-view-toggle"}),a=["month","week","day"];for(let i of a)t.createEl("button",{text:i.charAt(0).toUpperCase()+i.slice(1),cls:`calendar-view-btn ${this.viewMode===i?"active":""}`}).addEventListener("click",()=>{this.viewMode=i,this.render()})}navigatePrevious(){switch(this.viewMode){case"month":this.currentDate=K(this.currentDate,-1);break;case"week":this.currentDate=v(this.currentDate,-7);break;case"day":this.currentDate=v(this.currentDate,-1);break}this.render()}navigateNext(){switch(this.viewMode){case"month":this.currentDate=K(this.currentDate,1);break;case"week":this.currentDate=v(this.currentDate,7);break;case"day":this.currentDate=v(this.currentDate,1);break}this.render()}renderMonthView(e){let t=e.createDiv({cls:"calendar-month"}),a=t.createDiv({cls:"calendar-header-row"}),i=this.getOrderedDayNames();for(let l of i)a.createDiv({cls:"calendar-header-cell",text:l});let n=this.getMonthWeeks();for(let l of n){let r=t.createDiv({cls:"calendar-week-row"});for(let c of l.days)this.renderMonthCell(r,c)}}renderMonthCell(e,t){let a=e.createDiv({cls:`calendar-cell ${t.isCurrentMonth?"":"other-month"} ${t.isToday?"today":""} ${t.isWeekend?"weekend":""} ${this.selectedDate===t.dateStr?"selected":""}`});if(a.createDiv({cls:"calendar-date-num"}).setText(String(t.date.getDate())),t.tasks.length>0){let l=a.createDiv({cls:"calendar-task-indicators"}),r=t.tasks.slice(0,3);for(let c of r){let d=l.createDiv({cls:"calendar-task-dot"});c.priority&&d.addClass(`priority-${c.priority}`),S(c.dueDate)&&!c.completed&&d.addClass("overdue")}t.tasks.length>3&&l.createDiv({cls:"calendar-task-more",text:`+${t.tasks.length-3}`})}let n=this.getWorkloadIntensity(t.tasks.length);n>0&&(a.style.backgroundColor=`rgba(var(--interactive-accent-rgb), ${n*.15})`),a.addEventListener("click",()=>{this.selectedDate=t.dateStr,this.render()}),this.setupDropZone(a,t.dateStr)}getWorkloadIntensity(e){return e===0?0:e<=2?1:e<=4?2:e<=6?3:4}renderWeekView(e){let t=e.createDiv({cls:"calendar-week"}),a=Q(this.currentDate,this.settings.firstDayOfWeek),i=this.getOrderedDayNames(),n=t.createDiv({cls:"calendar-header-row"});for(let r=0;r<7;r++){let c=v(a,r),d=m(c)===m(D()),u=n.createDiv({cls:`calendar-header-cell ${d?"today":""}`});u.createDiv({cls:"calendar-header-day",text:i[r]}),u.createDiv({cls:"calendar-header-date",text:String(c.getDate())})}let l=t.createDiv({cls:"calendar-week-body"});for(let r=0;r<7;r++){let c=v(a,r),d=m(c),u=this.getTasksForDate(d),p=d===m(D()),h=l.createDiv({cls:`calendar-day-column ${p?"today":""} ${this.selectedDate===d?"selected":""}`});this.setupDropZone(h,d),h.addEventListener("click",g=>{g.target===h&&(this.selectedDate=d,this.render())});for(let g of u.slice(0,5))this.renderTaskCard(h,g);u.length>5&&h.createDiv({cls:"calendar-more-tasks",text:`+${u.length-5} more`}).addEventListener("click",()=>{this.selectedDate=d,this.render()})}}renderDayView(e){let t=e.createDiv({cls:"calendar-day"}),a=m(this.currentDate),i=this.getTasksForDate(a);if(this.setupDropZone(t,a),i.length===0)t.createDiv({cls:"calendar-empty",text:"No tasks scheduled for this day"});else for(let n of i)this.renderTaskCard(t,n,!0)}renderTaskCard(e,t,a=!1){let i=e.createDiv({cls:"calendar-task-card"});i.draggable=!0,t.priority&&i.addClass(`priority-${t.priority}`),S(t.dueDate)&&!t.completed&&i.addClass("overdue"),t.completed&&i.addClass("completed");let n=i.createDiv({cls:"calendar-task-title"});if(t.priority&&n.createSpan({text:se[t.priority]+" "}),n.createSpan({text:t.text}),a){let l=i.createDiv({cls:"calendar-task-meta"});t.owner&&l.createSpan({text:`\u{1F464} ${t.owner}`,cls:"calendar-task-owner"}),t.project&&l.createSpan({text:`\u{1F4C1} ${t.project}`,cls:"calendar-task-project"}),t.stage&&l.createSpan({text:`\u{1F4CB} ${t.stage}`,cls:"calendar-task-stage"}),l.createEl("a",{cls:"calendar-task-file",text:`\u{1F4C4} ${t.file.basename}`}).addEventListener("click",r=>{r.stopPropagation(),this.openTaskInEditor(t)})}i.addEventListener("dragstart",l=>{var r;this.draggedTask=t,i.addClass("dragging"),(r=l.dataTransfer)==null||r.setData("text/plain",t.id)}),i.addEventListener("dragend",()=>{this.draggedTask=null,i.removeClass("dragging")}),i.addEventListener("click",()=>{this.openTaskInEditor(t)})}renderSelectedDateTasks(e){if(!this.selectedDate)return;let t=this.getTasksForDate(this.selectedDate),a=R(this.selectedDate);if(!a)return;let i=e.createDiv({cls:"calendar-selected-panel"}),n=i.createDiv({cls:"calendar-selected-header"});n.createEl("h3",{text:this.formatFullDate(a)}),n.createEl("button",{text:"\u2715",cls:"calendar-panel-close"}).addEventListener("click",()=>{this.selectedDate=null,this.render()});let l=i.createDiv({cls:"calendar-selected-tasks"});if(t.length===0)l.createDiv({cls:"calendar-empty",text:"No tasks for this date"});else{let r=t.filter(d=>!d.completed),c=t.filter(d=>d.completed);if(r.length>0){l.createEl("h4",{text:`Active (${r.length})`});for(let d of r)this.renderTaskCard(l,d,!0)}if(c.length>0){l.createEl("h4",{text:`Completed (${c.length})`});for(let d of c)this.renderTaskCard(l,d,!0)}}}setupDropZone(e,t){e.addEventListener("dragover",a=>{a.preventDefault(),a.dataTransfer&&(a.dataTransfer.dropEffect="move"),e.addClass("drag-over")}),e.addEventListener("dragleave",a=>{e.contains(a.relatedTarget)||e.removeClass("drag-over")}),e.addEventListener("drop",async a=>{if(a.preventDefault(),e.removeClass("drag-over"),!this.draggedTask)return;let i=await this.taskUpdater.updateTask(this.draggedTask,{dueDate:t});i.success?(new Z.Notice(`Task rescheduled to ${X(t)}`),await this.plugin.refreshTasks(),this.render()):new Z.Notice(`Error: ${i.error}`)})}getOrderedDayNames(){let e=[...te],t=this.settings.firstDayOfWeek;return[...e.slice(t),...e.slice(0,t)].map(a=>a.charAt(0).toUpperCase()+a.slice(1))}getMonthWeeks(){let e=[],t=this.currentDate.getFullYear(),a=this.currentDate.getMonth(),i=new Date(t,a,1),n=new Date(t,a+1,0),l=Q(i,this.settings.firstDayOfWeek),r=D(),c=m(r);for(;l<=n||e.length<6;){let d={days:[]};for(let u=0;u<7;u++){let p=m(l),h=l.getDay();d.days.push({date:new Date(l),dateStr:p,isCurrentMonth:l.getMonth()===a,isToday:p===c,isWeekend:h===0||h===6,tasks:this.getTasksForDate(p)}),l=v(l,1)}if(e.push(d),l>n&&e.length>=5)break}return e}getTasksForDate(e){return this.taskCache.getAllTasks().filter(t=>t.dueDate===e).sort((t,a)=>{if(t.completed!==a.completed)return t.completed?1:-1;let i={high:0,medium:1,low:2},n=t.priority?i[t.priority]:3,l=a.priority?i[a.priority]:3;return n-l})}async openTaskInEditor(e){await this.app.workspace.getLeaf(!1).openFile(e.file);let t=this.app.workspace.getActiveViewOfType(Z.MarkdownView);if(t!=null&&t.editor){let a=t.editor;a.setCursor({line:e.lineNumber,ch:0}),a.scrollIntoView({from:{line:e.lineNumber,ch:0},to:{line:e.lineNumber,ch:0}},!0)}this.close()}};var ut=require("obsidian");var Ee=class extends ut.Modal{constructor(e,t){super(e);this.selectedProject=null;this.plugin=t,this.taskCache=t.taskCache}onOpen(){this.modalEl.addClass("project-dashboard-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty(),e.createDiv({cls:"dashboard-header"}).createEl("h2",{text:"Project Dashboard"}),this.renderOverallStats(e),this.renderProjectGrid(e),this.selectedProject&&this.renderProjectDetails(e,this.selectedProject)}renderOverallStats(e){let t=this.taskCache.getFilteredTasks({}),a=this.calculateOverallStats(t),i=e.createDiv({cls:"dashboard-overall-stats"}),n=[{label:"Total Tasks",value:a.total,icon:"\u{1F4CB}",cls:""},{label:"Completed",value:a.completed,icon:"\u2705",cls:"stat-completed"},{label:"Active",value:a.active,icon:"\u{1F504}",cls:"stat-active"},{label:"Overdue",value:a.overdue,icon:"\u{1F534}",cls:"stat-overdue"},{label:"Due Today",value:a.dueToday,icon:"\u{1F7E1}",cls:"stat-today"},{label:"Blocked",value:ve(t).length,icon:"\u{1F6AB}",cls:"stat-blocked"}];for(let l of n){let r=i.createDiv({cls:`stat-card ${l.cls}`});r.createDiv({cls:"stat-icon",text:l.icon}),r.createDiv({cls:"stat-value",text:String(l.value)}),r.createDiv({cls:"stat-label",text:l.label})}}renderProjectGrid(e){let t=e.createDiv({cls:"dashboard-projects"});t.createEl("h3",{text:"Projects"});let a=this.taskCache.getUniqueProjects(),i=this.taskCache.getFilteredTasks({});if(a.length===0){t.createDiv({cls:"no-projects",text:"No projects found. Add #project tags to your tasks to see them here."});return}let n=t.createDiv({cls:"project-grid"}),l=this.calculateProjectStats("All Tasks",i);this.renderProjectCard(n,l,null);let r=i.filter(c=>!c.project);if(r.length>0){let c=this.calculateProjectStats("No Project",r);this.renderProjectCard(n,c,"")}for(let c of a){let d=i.filter(p=>p.project===c),u=this.calculateProjectStats(c,d);this.renderProjectCard(n,u,c)}}renderProjectCard(e,t,a){let i=e.createDiv({cls:`project-card ${this.selectedProject===a?"selected":""}`});i.createDiv({cls:"project-name",text:t.name});let n=i.createDiv({cls:"project-progress"}),r=n.createDiv({cls:"progress-bar"}).createDiv({cls:"progress-fill",attr:{style:`width: ${t.completionPercent}%`}});n.createDiv({cls:"progress-text",text:`${t.completionPercent}% complete`});let c=i.createDiv({cls:"project-quick-stats"});c.createSpan({text:`${t.completed}/${t.total} tasks`}),t.overdue>0&&c.createSpan({cls:"stat-overdue",text:`\u{1F534} ${t.overdue}`}),t.dueToday>0&&c.createSpan({cls:"stat-today",text:`\u{1F7E1} ${t.dueToday}`}),t.blocked>0&&c.createSpan({cls:"stat-blocked",text:`\u{1F6AB} ${t.blocked}`}),i.addEventListener("click",()=>{this.selectedProject=a,this.render()})}renderProjectDetails(e,t){let a=this.taskCache.getFilteredTasks({}),i=t===null?a:t===""?a.filter(y=>!y.project):a.filter(y=>y.project===t),n=t===null?"All Tasks":t||"No Project",l=this.calculateProjectStats(n,i),r=e.createDiv({cls:"project-details"}),c=r.createDiv({cls:"details-header"});c.createEl("h3",{text:`Project: ${n}`}),c.createEl("button",{text:"\xD7",cls:"close-details"}).addEventListener("click",()=>{this.selectedProject=null,this.render()});let u=r.createDiv({cls:"details-section"});u.createEl("h4",{text:"By Stage"});let p=u.createDiv({cls:"stage-grid"});for(let[y,E]of Object.entries(l.byStage))if(E>0){let w=p.createDiv({cls:"stage-item"});w.createSpan({cls:"stage-name",text:y||"Unassigned"}),w.createSpan({cls:"stage-count",text:String(E)})}let h=r.createDiv({cls:"details-section"});h.createEl("h4",{text:"By Priority"});let g=h.createDiv({cls:"priority-grid"}),C={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}",none:"\u26AA"};for(let[y,E]of Object.entries(l.byPriority))if(E>0){let w=g.createDiv({cls:`priority-item priority-${y}`});w.createSpan({text:`${C[y]||""} ${y.charAt(0).toUpperCase()+y.slice(1)}`}),w.createSpan({cls:"priority-count",text:String(E)})}if(l.recentlyCompleted.length>0){let y=r.createDiv({cls:"details-section"});y.createEl("h4",{text:"Recently Completed"});let E=y.createDiv({cls:"task-mini-list"});for(let w of l.recentlyCompleted.slice(0,5)){let k=E.createDiv({cls:"task-mini-item"});k.createSpan({text:"\u2705",cls:"task-mini-icon"}),k.createSpan({text:w.text,cls:"task-mini-text"}),w.completedDate&&k.createSpan({text:w.completedDate,cls:"task-mini-date"})}}if(l.upcomingTasks.length>0){let y=r.createDiv({cls:"details-section"});y.createEl("h4",{text:"Upcoming Tasks"});let E=y.createDiv({cls:"task-mini-list"});for(let w of l.upcomingTasks.slice(0,5)){let k=E.createDiv({cls:"task-mini-item"}),A=S(w.dueDate)?"\u{1F534}":$(w.dueDate)?"\u{1F7E1}":"\u{1F4C5}";k.createSpan({text:A,cls:"task-mini-icon"}),k.createSpan({text:w.text,cls:"task-mini-text"}),w.dueDate&&k.createSpan({text:w.dueDate,cls:"task-mini-date"})}}let P=i.filter(y=>!y.completed&&ne(y,a).isBlocked);if(P.length>0){let y=r.createDiv({cls:"details-section"});y.createEl("h4",{text:"Blocked Tasks"});let E=y.createDiv({cls:"task-mini-list"});for(let w of P.slice(0,5)){let k=E.createDiv({cls:"task-mini-item blocked"});k.createSpan({text:"\u{1F6AB}",cls:"task-mini-icon"}),k.createSpan({text:w.text,cls:"task-mini-text"})}}}calculateOverallStats(e){var C,P,y,E,w;let t=e.length,a=e.filter(k=>k.completed).length,i=t-a,n=e.filter(k=>!k.completed&&S(k.dueDate)).length,l=e.filter(k=>!k.completed&&$(k.dueDate)).length,r=D(),c=v(r,7),d=e.filter(k=>{if(k.completed||!k.dueDate)return!1;let A=R(k.dueDate);return A&&A>=r&&A<=c}).length,u={},p={},h={},g={high:0,medium:0,low:0};for(let k of e){let A=(C=k.stage)!=null?C:"Unassigned";u[A]=((P=u[A])!=null?P:0)+1,k.owner&&(p[k.owner]=((y=p[k.owner])!=null?y:0)+1),k.project&&(h[k.project]=((E=h[k.project])!=null?E:0)+1),k.priority&&(g[k.priority]=((w=g[k.priority])!=null?w:0)+1)}return{total:t,completed:a,active:i,overdue:n,dueToday:l,dueThisWeek:d,byStage:u,byOwner:p,byProject:h,byPriority:g}}calculateProjectStats(e,t){var w,k,A,oe;let a=t.length,i=t.filter(T=>T.completed).length,n=a-i,l=t.filter(T=>!T.completed&&S(T.dueDate)).length,r=t.filter(T=>!T.completed&&$(T.dueDate)).length,c=this.taskCache.getFilteredTasks({}),d=t.filter(T=>!T.completed&&ne(T,c).isBlocked).length,u=D(),p=v(u,7),h=t.filter(T=>{if(T.completed||!T.dueDate)return!1;let I=R(T.dueDate);return I&&I>=u&&I<=p}).length,g=a>0?Math.round(i/a*100):0,C={},P={high:0,medium:0,low:0,none:0};for(let T of t){let I=(w=T.stage)!=null?w:"Unassigned";C[I]=((k=C[I])!=null?k:0)+1;let F=(A=T.priority)!=null?A:"none";P[F]=((oe=P[F])!=null?oe:0)+1}let y=t.filter(T=>T.completed&&T.completedDate).sort((T,I)=>{var F,H;return((F=I.completedDate)!=null?F:"").localeCompare((H=T.completedDate)!=null?H:"")}).slice(0,5),E=t.filter(T=>!T.completed&&T.dueDate).sort((T,I)=>{var F,H;return((F=T.dueDate)!=null?F:"").localeCompare((H=I.dueDate)!=null?H:"")}).slice(0,5);return{name:e,total:a,completed:i,active:n,overdue:l,dueToday:r,dueThisWeek:h,blocked:d,completionPercent:g,byStage:C,byPriority:P,recentlyCompleted:y,upcomingTasks:E}}};var O=require("obsidian");var Ne=class extends O.Modal{constructor(e,t,a,i){var r,c,d,u,p;super(e);this.existingTask=null;this.isEditMode=!1;this.taskText="";this.selectedOwner="";this.selectedDueDate="";this.selectedProject="";this.selectedStage="";this.selectedPriority="";this.selectedTags=[];this.plugin=t,this.editor=a,this.view=i,this.cursorLine=a.getCursor().line;let n=a.getLine(this.cursorLine),l=i.file;l&&(this.existingTask=Le(n,l,this.cursorLine,t.settings.customStages)),this.existingTask?(this.isEditMode=!0,this.taskText=this.existingTask.text,this.selectedOwner=(r=this.existingTask.owner)!=null?r:"",this.selectedDueDate=(c=this.existingTask.dueDate)!=null?c:"",this.selectedProject=(d=this.existingTask.project)!=null?d:"",this.selectedStage=(u=this.existingTask.stage)!=null?u:"",this.selectedPriority=(p=this.existingTask.priority)!=null?p:"",this.selectedTags=[...this.existingTask.tags]):(this.selectedOwner=t.settings.defaultOwner,this.selectedProject=t.settings.defaultProject)}onOpen(){this.modalEl.addClass("task-agent-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.isEditMode?"Edit Task":"Create Task at Cursor"}),this.isEditMode&&e.createEl("p",{text:`Editing task on line ${this.cursorLine+1}`,cls:"task-agent-subtitle"});let a=e.createDiv({cls:"task-agent-input-container"}).createEl("textarea",{cls:"task-agent-task-input",placeholder:"Enter task description..."});a.value=this.taskText,a.addEventListener("input",()=>{this.taskText=a.value,this.updatePreview()}),setTimeout(()=>a.focus(),50),a.addEventListener("keydown",h=>{h.key==="Enter"&&(h.ctrlKey||h.metaKey)&&(h.preventDefault(),this.saveTask())});let i=e.createDiv({cls:"task-agent-fields"});new O.Setting(i).setName("Owner").addDropdown(h=>{h.addOption("","None");for(let g of this.plugin.taskCache.getUniqueOwners())h.addOption(g,g);h.setValue(this.selectedOwner),h.onChange(g=>{this.selectedOwner=g,this.updatePreview()})}).addText(h=>h.setPlaceholder("Or enter new...").onChange(g=>{g&&(this.selectedOwner=g,this.updatePreview())}));let l=new O.Setting(i).setName("Due Date").controlEl.createEl("input",{type:"date",cls:"task-agent-date-input",value:this.selectedDueDate});l.addEventListener("input",()=>{this.selectedDueDate=l.value,this.updatePreview()}),new O.Setting(i).setName("Project").addDropdown(h=>{h.addOption("","None");for(let g of this.plugin.taskCache.getUniqueProjects())h.addOption(g,g);h.setValue(this.selectedProject),h.onChange(g=>{this.selectedProject=g,this.updatePreview()})}).addText(h=>h.setPlaceholder("Or enter new...").onChange(g=>{g&&(this.selectedProject=g,this.updatePreview())}));let r=[...L,...this.plugin.settings.customStages];new O.Setting(i).setName("Stage").addDropdown(h=>{h.addOption("","None");for(let g of r)h.addOption(g,g);h.setValue(this.selectedStage),h.onChange(g=>{this.selectedStage=g,this.updatePreview()})}),new O.Setting(i).setName("Priority").addDropdown(h=>{h.addOption("","None");for(let g of U)h.addOption(g,g.charAt(0).toUpperCase()+g.slice(1));h.setValue(this.selectedPriority),h.onChange(g=>{this.selectedPriority=g,this.updatePreview()})}),new O.Setting(i).setName("Tags").setDesc("Comma-separated tags").addText(h=>h.setPlaceholder("tag1, tag2, tag3").setValue(this.selectedTags.join(", ")).onChange(g=>{this.selectedTags=g.split(",").map(C=>C.trim().replace(/^#/,"")).filter(C=>C.length>0),this.updatePreview()}));let c=e.createDiv({cls:"task-agent-preview"});c.id="task-agent-preview",this.updatePreview();let d=e.createDiv({cls:"task-agent-buttons"});d.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),d.createEl("button",{text:this.isEditMode?"Save Changes":"Create Task",cls:"mod-cta"}).addEventListener("click",()=>void this.saveTask());let p=d.createEl("span",{text:"Ctrl+Enter to save",cls:"task-agent-shortcut-hint"});this.modalEl.addEventListener("keydown",h=>{h.key==="Enter"&&(h.ctrlKey||h.metaKey)&&(h.preventDefault(),this.saveTask())})}buildPreviewLine(){var l,r,c,d,u;let e=this.isEditMode&&((l=this.existingTask)!=null&&l.completed)?"x":" ",t=this.isEditMode&&(c=(r=this.existingTask)==null?void 0:r.indent)!=null?c:"",a=this.taskText||"...",i=[];this.selectedOwner&&i.push(this.selectedOwner),this.selectedDueDate&&i.push(this.selectedDueDate),this.selectedStage&&i.push(this.selectedStage),this.selectedProject&&i.push(this.selectedProject);let n=a;return i.length>0&&(n=`**${i.join(" | ")}:** ${a}`),this.selectedPriority&&(n+=` [priority:${this.selectedPriority}]`),this.isEditMode&&((d=this.existingTask)!=null&&d.recurrence)&&(n+=` [repeat:${(u=this.existingTask.recurrence.rawString)!=null?u:this.existingTask.recurrence.type}]`),this.selectedTags.length>0&&(n+=" "+this.selectedTags.map(p=>`#${p}`).join(" ")),`${t}- [${e}] ${n}`}updatePreview(){let e=document.getElementById("task-agent-preview");e&&(e.empty(),e.createEl("strong",{text:"Preview: "}),e.createEl("code",{text:this.buildPreviewLine(),cls:"task-agent-preview-code"}))}async saveTask(){var a;let e=ie(this.taskText);if(!e.isValid){new O.Notice((a=e.error)!=null?a:"Invalid task text");return}let t=this.view.file;if(!t){new O.Notice("No active file");return}if(this.isEditMode&&this.existingTask){let i=await this.plugin.taskUpdater.updateTask(this.existingTask,{text:this.taskText,owner:this.selectedOwner||null,dueDate:this.selectedDueDate||null,stage:this.selectedStage||null,project:this.selectedProject||null,priority:this.selectedPriority||null,tags:this.selectedTags});i.success?(new O.Notice("Task updated"),await this.plugin.refreshTasks(),this.close()):new O.Notice(`Error: ${i.error}`)}else{let i=await this.plugin.taskUpdater.createTask(t,this.taskText,{owner:this.selectedOwner||void 0,dueDate:this.selectedDueDate||void 0,project:this.selectedProject||void 0,stage:this.selectedStage||void 0,priority:this.selectedPriority||void 0,tags:this.selectedTags.length>0?this.selectedTags:void 0,atLine:this.cursorLine});i.success?(new O.Notice("Task created at cursor"),await this.plugin.refreshTasks(),this.close()):new O.Notice(`Error: ${i.error}`)}}};var Pe=class extends M.Plugin{constructor(){super(...arguments);this.fileWatcherRegistered=!1;this.notificationCheckInterval=null;this.debouncedRefresh=(0,M.debounce)(async()=>{await this.refreshTasks(),await this.refreshView()},300,!0)}async onload(){await this.loadSettings(),this.taskCache=new ye(this.app,this.settings),this.taskUpdater=new Te(this.app,this.settings),this.notificationService=new we(this.app,this.settings),this.registerView(Y,e=>new ce(e,this)),this.addRibbonIcon("list-checks","Task Consolidator",()=>{this.activateView()}),this.addCommand({id:"open-task-consolidator",name:"Open Task Consolidator",callback:()=>{this.activateView()}}),this.addCommand({id:"open-kanban-board",name:"Open Kanban Board",callback:()=>{this.openKanban()}}),this.addCommand({id:"quick-add-task",name:"Quick Add Task",callback:()=>{this.openQuickAdd()}}),this.addCommand({id:"refresh-tasks",name:"Refresh All Tasks",callback:()=>{this.refreshTasks()}}),this.addCommand({id:"open-calendar",name:"Open Calendar View",callback:()=>{this.openCalendar()}}),this.addCommand({id:"open-daily-note",name:"Open Today's Daily Note",callback:()=>{this.openDailyNote()}}),this.addCommand({id:"add-task-to-daily-note",name:"Add Task to Today's Daily Note",callback:()=>{this.addTaskToDailyNote()}}),this.addCommand({id:"show-task-summary",name:"Show Task Summary",callback:()=>{this.showTaskSummary()}}),this.addCommand({id:"open-project-dashboard",name:"Open Project Dashboard",callback:()=>{this.openProjectDashboard()}}),this.addCommand({id:"open-task-agent",name:"Open Task Agent (Edit/Create at Cursor)",editorCallback:(e,t)=>{new Ne(this.app,this,e,t).open()}}),this.addSettingTab(new pe(this.app,this)),await this.taskCache.initialize(),this.setupFileWatchers(),this.setupNotifications(),this.settings.debugMode&&(console.log("Task Consolidator loaded"),console.log("Cache stats:",this.taskCache.getCacheStats()))}onunload(){this.app.workspace.detachLeavesOfType(Y),this.taskCache.clear(),this.notificationService.destroy(),this.notificationCheckInterval&&(window.clearInterval(this.notificationCheckInterval),this.notificationCheckInterval=null),this.settings.debugMode&&console.log("Task Consolidator unloaded")}async loadSettings(){let e=await this.loadData();this.settings=Qe(e!=null?e:{})}async saveSettings(){await this.saveData(this.settings),this.taskCache.updateSettings(this.settings),this.taskUpdater.updateSettings(this.settings),this.notificationService.updateSettings(this.settings),this.debouncedRefresh=(0,M.debounce)(async()=>{await this.refreshTasks(),await this.refreshView()},this.settings.refreshDebounceMs,!0),this.setupNotifications()}async activateView(){let{workspace:e}=this.app,t=e.getLeavesOfType(Y)[0];if(!t){let a=e.getRightLeaf(!1);a&&(await a.setViewState({type:Y,active:!0}),t=a)}t&&e.revealLeaf(t)}openKanban(){new xe(this.app,this).open()}openQuickAdd(){new de(this.app,this).open()}openCalendar(){new Ce(this.app,this).open()}openProjectDashboard(){new Ee(this.app,this).open()}async openDailyNote(){if(!this.settings.enableDailyNoteIntegration){new M.Notice("Daily note integration is disabled. Enable it in settings.");return}try{let e=await Be(this.app,D(),this.settings);await this.app.workspace.getLeaf().openFile(e)}catch(e){new M.Notice("Failed to open daily note: "+e.message)}}async addTaskToDailyNote(){if(!this.settings.enableDailyNoteIntegration){new M.Notice("Daily note integration is disabled. Enable it in settings.");return}new de(this.app,this,{targetDailyNote:!0}).open()}async refreshTasks(){await this.taskCache.refreshAll(),this.settings.debugMode&&console.log("Tasks refreshed:",this.taskCache.getCacheStats())}async refreshView(){let e=this.app.workspace.getLeavesOfType(Y);for(let t of e){let a=t.view;a instanceof ce&&await a.refresh()}}setupFileWatchers(){this.fileWatcherRegistered||!this.settings.autoRefresh||(this.registerEvent(this.app.vault.on("modify",e=>{e instanceof M.TFile&&e.extension==="md"&&(this.taskCache.refreshFile(e),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("create",e=>{e instanceof M.TFile&&e.extension==="md"&&(this.taskCache.refreshFile(e),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof M.TFile&&e.extension==="md"&&(this.taskCache.removeFile(e.path),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("rename",(e,t)=>{e instanceof M.TFile&&e.extension==="md"&&(this.taskCache.renameFile(t,e.path),this.debouncedRefresh())})),this.fileWatcherRegistered=!0,this.settings.debugMode&&console.log("File watchers registered"))}setupNotifications(){if(this.notificationCheckInterval&&(window.clearInterval(this.notificationCheckInterval),this.notificationCheckInterval=null),!!this.settings.enableNotifications&&(this.settings.notifyOnStartup&&setTimeout(()=>{let e=this.taskCache.getFilteredTasks({}),t=this.notificationService.getNotificationSummary(e);this.notificationService.showStartupNotification(t)},2e3),this.settings.reminderCheckIntervalMinutes>0)){let e=this.settings.reminderCheckIntervalMinutes*60*1e3;this.notificationCheckInterval=window.setInterval(()=>{let t=this.taskCache.getFilteredTasks({});this.notificationService.checkAndNotify(t)},e),this.settings.debugMode&&console.log(`Notification check interval set: ${this.settings.reminderCheckIntervalMinutes} minutes`)}}showTaskSummary(){let e=this.taskCache.getFilteredTasks({}),t=this.notificationService.getNotificationSummary(e),a=this.notificationService.formatSummaryText(t);a?new M.Notice(a,8e3):new M.Notice("No tasks with due dates found.",4e3)}};
