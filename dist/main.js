/*
Task Consolidator v2.0.0
Obsidian Plugin for consolidated task management
*/

var ne=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var ze=Object.getOwnPropertyNames;var Qe=Object.prototype.hasOwnProperty;var Xe=(n,t)=>{for(var e in t)ne(n,e,{get:t[e],enumerable:!0})},Je=(n,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ze(t))!Qe.call(n,a)&&a!==e&&ne(n,a,{get:()=>t[a],enumerable:!(s=qe(t,a))||s.enumerable});return n};var Ze=n=>Je(ne({},"__esModule",{value:!0}),n);var pt={};Xe(pt,{default:()=>re});module.exports=Ze(pt);var C=require("obsidian");var D=["Requested","Staged","In-Progress","In-Review","Completed"],V=["high","medium","low"],Ce=["daily","weekly","monthly","yearly","custom"],be=[{id:"unassigned",title:"Unassigned",stage:null},{id:"requested",title:"Requested",stage:"Requested"},{id:"staged",title:"Staged",stage:"Staged"},{id:"in-progress",title:"In-Progress",stage:"In-Progress"},{id:"in-review",title:"In-Review",stage:"In-Review"},{id:"completed",title:"Completed",stage:"Completed"}],U=["dueDate","owner","priority","project","created","stage"],Y=["none","dueDate","owner","project","stage","priority"],Pe=["YYYY-MM-DD","MM/DD/YYYY","DD-MM-YYYY","locale"],Ae=["full","filename","hidden"],Oe=["panel","kanban","calendar"],P="task-consolidator-view",W=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Re=["sun","mon","tue","wed","thu","fri","sat"],oe=["january","february","march","april","may","june","july","august","september","october","november","december"],Ne=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],N={MAX_TASK_TEXT_LENGTH:1e3,MAX_OWNER_LENGTH:50,MAX_PROJECT_LENGTH:100,MAX_TAG_LENGTH:50,MAX_TAGS_COUNT:20,MAX_LINE_LENGTH:2e3},k={TASK_LINE:/^(\s*)-\s+\[([ xX])\]\s+(.+)$/,METADATA:/^\*\*(.+?):\*\*\s*(.*)$/,DATE:/^\d{4}-\d{2}-\d{2}$/,DATE_WITH_PREFIX:/^(?:Due\s+)?(\d{4}-\d{2}-\d{2})$/i,COMPLETED_DATE:/\s*\[done:(\d{4}-\d{2}-\d{2})\]\s*$/,CREATED_DATE:/\s*\[created:(\d{4}-\d{2}-\d{2})\]\s*$/,PRIORITY:/\[priority:(high|medium|low)\]/i,RECURRENCE:/\[repeat:([^\]]+)\]/i,TAGS:/#([\w\-_]+)/g,QUICK_OWNER:/@([\w\s\-.']+?)(?=\s+[#!@]|\s*$)/,QUICK_PROJECT:/^#([\w\-_]+)/,QUICK_DATE:/!([\w\-/]+)/},m={OWNER:/@([\w\s\-.']+?)(?=\s+[@#!^+]|\s*$)/,PROJECT:/\s#([\w\-_]+)(?=\s|$)/,DATE:/!([\w\-/\s]+?)(?=\s+[@#!^+]|\s*$)/,PRIORITY:/\^(high|med|medium|low|h|m|l)/i,TAG:/\+([\w\-_]+)/g},w={ENTER:"Enter",SPACE:" ",ESCAPE:"Escape",TAB:"Tab",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",HOME:"Home",END:"End",DELETE:"Delete",BACKSPACE:"Backspace",QUESTION_MARK:"?",SLASH:"/"},G={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"},Me={none:"\u{1F4CC}",dueDate:"\u{1F4C5}",owner:"\u{1F464}",project:"\u{1F4C1}",stage:"\u{1F4CB}",priority:"\u26A1"};var A={sortBy:"dueDate",groupBy:"dueDate",showCompleted:!0,completedTasksLimit:0,dateFormat:"YYYY-MM-DD",firstDayOfWeek:0,defaultView:"panel",requireMetadataFormat:!1,metadataDelimiter:"|",customStages:[],excludedFolders:[],excludedPatterns:[],autoRefresh:!0,refreshDebounceMs:300,parentCompletionBehavior:"manual",confirmDestructiveActions:!0,recurringAutoCreate:!0,recurringCreateDaysBefore:1,compactMode:!1,showFilePath:"filename",taskCountInRibbon:!1,showOverdueIndicator:!0,showDueTodayIndicator:!0,defaultTargetFile:"",quickAddHotkey:"Ctrl+Shift+T",defaultOwner:"",defaultProject:"",filterOwner:"",filterDueDate:"",filterProject:"",filterPriority:"",filterStage:"",filterTags:[],searchQuery:"",collapsedGroups:{},kanbanFilterProject:"",debugMode:!1,maxTasksToRender:0,enableVirtualScrolling:!0,enableTaskCache:!0};function Ie(n){var t,e,s,a,i;return{...A,...n,customStages:(t=n.customStages)!=null?t:A.customStages,excludedFolders:(e=n.excludedFolders)!=null?e:A.excludedFolders,excludedPatterns:(s=n.excludedPatterns)!=null?s:A.excludedPatterns,filterTags:(a=n.filterTags)!=null?a:A.filterTags,collapsedGroups:(i=n.collapsedGroups)!=null?i:A.collapsedGroups}}var p=require("obsidian");var et=/[.*+?^${}()|[\]\\]/g,tt=/\*\*/g;function Le(n){return n.replace(et,"\\$&")}function Ve(n){return n.replace(tt,"").replace(/\|/g,"-").replace(/:/g,"-").replace(/\[/g,"(").replace(/\]/g,")").replace(/\n/g," ").replace(/\r/g,"").trim()}function le(n){return n&&Ve(n).replace(/<[^>]*>/g,"").replace(/[^\w\s\-.']/gu,"").substring(0,50).trim()||null}function ce(n){return n&&Ve(n).replace(/[^\w\s\-_]/gu,"").substring(0,100).trim()||null}function de(n){return n.replace(/\n/g," ").replace(/\r/g,"").replace(/\t/g," ").replace(/\s+/g," ").substring(0,1e3).trim()}function Fe(n){let t=n.replace(/\t/g,"  ").length;return Math.floor(t/2)}function O(n){return n.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,t=>t.toUpperCase()).trim()}function F(n,t){return n===null&&t===null?0:n===null?1:t===null?-1:n.localeCompare(t)}var B=class extends p.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h1",{text:"Task Consolidator Settings"}),this.renderDisplaySection(t),this.renderDetectionSection(t),this.renderBehaviorSection(t),this.renderRecurringSection(t),this.renderAppearanceSection(t),this.renderQuickAddSection(t),this.renderAdvancedSection(t),this.renderResetSection(t)}renderDisplaySection(t){t.createEl("h2",{text:"Display"}),new p.Setting(t).setName("Default Sort Order").setDesc("How tasks should be sorted by default").addDropdown(e=>{for(let s of U)e.addOption(s,O(s));e.setValue(this.plugin.settings.sortBy),e.onChange(async s=>{this.plugin.settings.sortBy=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Default Group By").setDesc("How tasks should be grouped by default").addDropdown(e=>{for(let s of Y)e.addOption(s,O(s));e.setValue(this.plugin.settings.groupBy),e.onChange(async s=>{this.plugin.settings.groupBy=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Show Completed Tasks").setDesc("Show the completed tasks section by default").addToggle(e=>{e.setValue(this.plugin.settings.showCompleted),e.onChange(async s=>{this.plugin.settings.showCompleted=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Completed Tasks Limit").setDesc("Limit completed tasks display (0 = unlimited, or last N days)").addText(e=>{e.setValue(String(this.plugin.settings.completedTasksLimit)),e.setPlaceholder("0"),e.onChange(async s=>{let a=parseInt(s,10);this.plugin.settings.completedTasksLimit=isNaN(a)?0:Math.max(0,a),await this.plugin.saveSettings()})}),new p.Setting(t).setName("Date Format").setDesc("Format for displaying dates").addDropdown(e=>{for(let s of Pe)e.addOption(s,s);e.setValue(this.plugin.settings.dateFormat),e.onChange(async s=>{this.plugin.settings.dateFormat=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("First Day of Week").setDesc("Which day starts the week").addDropdown(e=>{e.addOption("0","Sunday"),e.addOption("1","Monday"),e.setValue(String(this.plugin.settings.firstDayOfWeek)),e.onChange(async s=>{this.plugin.settings.firstDayOfWeek=parseInt(s,10),await this.plugin.saveSettings()})}),new p.Setting(t).setName("Default View").setDesc("Default view when opening Task Consolidator").addDropdown(e=>{for(let s of Oe)e.addOption(s,O(s));e.setValue(this.plugin.settings.defaultView),e.onChange(async s=>{this.plugin.settings.defaultView=s,await this.plugin.saveSettings()})})}renderDetectionSection(t){t.createEl("h2",{text:"Task Detection"}),new p.Setting(t).setName("Require Metadata Format").setDesc("Only detect tasks with **metadata:** format").addToggle(e=>{e.setValue(this.plugin.settings.requireMetadataFormat),e.onChange(async s=>{this.plugin.settings.requireMetadataFormat=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Metadata Delimiter").setDesc("Character used to separate metadata fields (default: |)").addText(e=>{e.setValue(this.plugin.settings.metadataDelimiter),e.setPlaceholder("|"),e.onChange(async s=>{this.plugin.settings.metadataDelimiter=s||"|",await this.plugin.saveSettings()})}),new p.Setting(t).setName("Custom Stages").setDesc("Additional workflow stages (comma-separated)").addText(e=>{e.setValue(this.plugin.settings.customStages.join(", ")),e.setPlaceholder("Review, QA, Deploy"),e.onChange(async s=>{this.plugin.settings.customStages=s.split(",").map(a=>a.trim()).filter(a=>a.length>0),await this.plugin.saveSettings()})}),new p.Setting(t).setName("Excluded Folders").setDesc("Folders to exclude from task scanning (comma-separated)").addText(e=>{e.setValue(this.plugin.settings.excludedFolders.join(", ")),e.setPlaceholder("Templates, Archive"),e.onChange(async s=>{this.plugin.settings.excludedFolders=s.split(",").map(a=>a.trim()).filter(a=>a.length>0),await this.plugin.saveSettings()})}),new p.Setting(t).setName("Excluded Patterns").setDesc("File patterns to exclude (glob format, comma-separated)").addText(e=>{e.setValue(this.plugin.settings.excludedPatterns.join(", ")),e.setPlaceholder("*.template.md, _*"),e.onChange(async s=>{this.plugin.settings.excludedPatterns=s.split(",").map(a=>a.trim()).filter(a=>a.length>0),await this.plugin.saveSettings()})})}renderBehaviorSection(t){t.createEl("h2",{text:"Behavior"}),new p.Setting(t).setName("Auto Refresh").setDesc("Automatically refresh tasks when files change").addToggle(e=>{e.setValue(this.plugin.settings.autoRefresh),e.onChange(async s=>{this.plugin.settings.autoRefresh=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Refresh Debounce (ms)").setDesc("Delay before refreshing after file change").addText(e=>{e.setValue(String(this.plugin.settings.refreshDebounceMs)),e.setPlaceholder("300"),e.onChange(async s=>{let a=parseInt(s,10);this.plugin.settings.refreshDebounceMs=isNaN(a)?300:Math.max(100,a),await this.plugin.saveSettings()})}),new p.Setting(t).setName("Parent Task Completion").setDesc("How completing a parent task affects children").addDropdown(e=>{e.addOption("manual","Manual - No automatic behavior"),e.addOption("auto","Auto - Complete parent when all children done"),e.addOption("cascade","Cascade - Complete children when parent done"),e.setValue(this.plugin.settings.parentCompletionBehavior),e.onChange(async s=>{this.plugin.settings.parentCompletionBehavior=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Confirm Destructive Actions").setDesc("Show confirmation dialogs for bulk delete operations").addToggle(e=>{e.setValue(this.plugin.settings.confirmDestructiveActions),e.onChange(async s=>{this.plugin.settings.confirmDestructiveActions=s,await this.plugin.saveSettings()})})}renderRecurringSection(t){t.createEl("h2",{text:"Recurring Tasks"}),new p.Setting(t).setName("Auto-Create Next Occurrence").setDesc("Automatically create next occurrence when completing recurring task").addToggle(e=>{e.setValue(this.plugin.settings.recurringAutoCreate),e.onChange(async s=>{this.plugin.settings.recurringAutoCreate=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Create Days Before").setDesc("Days before due date to create next occurrence (0 = on completion)").addText(e=>{e.setValue(String(this.plugin.settings.recurringCreateDaysBefore)),e.setPlaceholder("1"),e.onChange(async s=>{let a=parseInt(s,10);this.plugin.settings.recurringCreateDaysBefore=isNaN(a)?1:Math.max(0,a),await this.plugin.saveSettings()})})}renderAppearanceSection(t){t.createEl("h2",{text:"Appearance"}),new p.Setting(t).setName("Compact Mode").setDesc("Use smaller, denser task display").addToggle(e=>{e.setValue(this.plugin.settings.compactMode),e.onChange(async s=>{this.plugin.settings.compactMode=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Show File Path").setDesc("How to display file paths in task list").addDropdown(e=>{for(let s of Ae)e.addOption(s,O(s));e.setValue(this.plugin.settings.showFilePath),e.onChange(async s=>{this.plugin.settings.showFilePath=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Task Count in Ribbon").setDesc("Show active task count as badge on ribbon icon").addToggle(e=>{e.setValue(this.plugin.settings.taskCountInRibbon),e.onChange(async s=>{this.plugin.settings.taskCountInRibbon=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Show Overdue Indicator").setDesc("Highlight overdue tasks with red accent").addToggle(e=>{e.setValue(this.plugin.settings.showOverdueIndicator),e.onChange(async s=>{this.plugin.settings.showOverdueIndicator=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Show Due Today Indicator").setDesc("Highlight tasks due today with amber accent").addToggle(e=>{e.setValue(this.plugin.settings.showDueTodayIndicator),e.onChange(async s=>{this.plugin.settings.showDueTodayIndicator=s,await this.plugin.saveSettings()})})}renderQuickAddSection(t){t.createEl("h2",{text:"Quick Add"}),new p.Setting(t).setName("Default Target File").setDesc("Default file for new tasks created via Quick Add").addDropdown(e=>{e.addOption("","None");let s=this.app.vault.getMarkdownFiles().sort((a,i)=>a.path.localeCompare(i.path));for(let a of s)e.addOption(a.path,a.path);e.setValue(this.plugin.settings.defaultTargetFile),e.onChange(async a=>{this.plugin.settings.defaultTargetFile=a,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Default Owner").setDesc("Default owner for new tasks").addText(e=>{e.setValue(this.plugin.settings.defaultOwner),e.setPlaceholder("Your name"),e.onChange(async s=>{this.plugin.settings.defaultOwner=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Default Project").setDesc("Default project for new tasks").addText(e=>{e.setValue(this.plugin.settings.defaultProject),e.setPlaceholder("Project name"),e.onChange(async s=>{this.plugin.settings.defaultProject=s,await this.plugin.saveSettings()})})}renderAdvancedSection(t){t.createEl("h2",{text:"Advanced"}),new p.Setting(t).setName("Debug Mode").setDesc("Enable debug logging to console").addToggle(e=>{e.setValue(this.plugin.settings.debugMode),e.onChange(async s=>{this.plugin.settings.debugMode=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Enable Task Cache").setDesc("Cache parsed tasks for better performance").addToggle(e=>{e.setValue(this.plugin.settings.enableTaskCache),e.onChange(async s=>{this.plugin.settings.enableTaskCache=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Enable Virtual Scrolling").setDesc("Use virtual scrolling for large task lists").addToggle(e=>{e.setValue(this.plugin.settings.enableVirtualScrolling),e.onChange(async s=>{this.plugin.settings.enableVirtualScrolling=s,await this.plugin.saveSettings()})}),new p.Setting(t).setName("Max Tasks to Render").setDesc("Maximum tasks to render at once (0 = unlimited)").addText(e=>{e.setValue(String(this.plugin.settings.maxTasksToRender)),e.setPlaceholder("0"),e.onChange(async s=>{let a=parseInt(s,10);this.plugin.settings.maxTasksToRender=isNaN(a)?0:Math.max(0,a),await this.plugin.saveSettings()})})}renderResetSection(t){t.createEl("h2",{text:"Reset"}),new p.Setting(t).setName("Clear All Filters").setDesc("Reset owner, date, project, and stage filters").addButton(e=>{e.setButtonText("Clear Filters"),e.onClick(async()=>{this.plugin.settings.filterOwner="",this.plugin.settings.filterDueDate="",this.plugin.settings.filterProject="",this.plugin.settings.filterStage="",this.plugin.settings.filterPriority="",this.plugin.settings.filterTags=[],this.plugin.settings.searchQuery="",await this.plugin.saveSettings(),new p.Notice("Filters cleared")})}),new p.Setting(t).setName("Reset All Settings").setDesc("Reset all settings to default values").addButton(e=>{e.setButtonText("Reset to Defaults"),e.setWarning(),e.onClick(async()=>{let s=this.plugin.settings.collapsedGroups;this.plugin.settings={...A,collapsedGroups:s},await this.plugin.saveSettings(),this.display(),new p.Notice("Settings reset to defaults")})})}};var st=/^\d{4}-\d{2}-\d{2}$/,at=/^[\w\s\-.']+$/u,it=/^[\w\s\-_]+$/u;function K(n){if(n==null||n==="")return{isValid:!0,sanitizedValue:void 0};let t=n.trim();if(!st.test(t))return{isValid:!1,error:"Date must be in YYYY-MM-DD format"};let[e,s,a]=t.split("-").map(Number),i=new Date(e,s-1,a);return i.getFullYear()!==e||i.getMonth()!==s-1||i.getDate()!==a?{isValid:!1,error:"Invalid date value"}:{isValid:!0,sanitizedValue:t}}function q(n){if(n==null)return{isValid:!1,error:"Task text is required"};let t=n.trim();return t.length===0?{isValid:!1,error:"Task text cannot be empty"}:t.length>N.MAX_TASK_TEXT_LENGTH?{isValid:!1,error:`Task text exceeds maximum length of ${N.MAX_TASK_TEXT_LENGTH} characters`}:{isValid:!0,sanitizedValue:t}}function z(n){if(n==null||n==="")return{isValid:!0,sanitizedValue:void 0};let t=n.trim();return t.length>N.MAX_OWNER_LENGTH?{isValid:!1,error:`Owner name exceeds maximum length of ${N.MAX_OWNER_LENGTH} characters`}:at.test(t)?{isValid:!0,sanitizedValue:t}:{isValid:!1,error:"Owner name contains invalid characters"}}function Q(n){if(n==null||n==="")return{isValid:!0,sanitizedValue:void 0};let t=n.trim();return t.length>N.MAX_PROJECT_LENGTH?{isValid:!1,error:`Project name exceeds maximum length of ${N.MAX_PROJECT_LENGTH} characters`}:it.test(t)?{isValid:!0,sanitizedValue:t}:{isValid:!1,error:"Project name contains invalid characters"}}function je(n,t=[]){if(n==null||n==="")return{isValid:!0,sanitizedValue:void 0};let e=n.trim(),s=[...D,...t];return s.includes(e)?{isValid:!0,sanitizedValue:e}:{isValid:!1,error:`Invalid stage. Valid stages are: ${s.join(", ")}`}}function $e(n,t){return n==null?{isValid:!1,error:"Line number is required"}:!Number.isInteger(n)||n<0?{isValid:!1,error:"Line number must be a non-negative integer"}:t!==void 0&&n>=t?{isValid:!1,error:"Line number exceeds file length"}:{isValid:!0}}function rt(n){let t=n.toLowerCase().trim();if(Ce.includes(t))return{type:t,rawString:n};let e=t.match(/^every\s+(\d+)\s+(day|days|week|weeks|month|months|year|years)$/);if(e){let a=parseInt(e[1],10),i=e[2],r="custom";return i.startsWith("day")?r="daily":i.startsWith("week")?r="weekly":i.startsWith("month")?r="monthly":i.startsWith("year")&&(r="yearly"),{type:r,interval:a,rawString:n}}let s=t.match(/^every\s+((?:mon|tue|wed|thu|fri|sat|sun)(?:day)?(?:,\s*(?:mon|tue|wed|thu|fri|sat|sun)(?:day)?)*)$/);if(s){let a={sun:0,sunday:0,mon:1,monday:1,tue:2,tuesday:2,wed:3,wednesday:3,thu:4,thursday:4,fri:5,friday:5,sat:6,saturday:6};return{type:"weekly",daysOfWeek:s[1].split(",").map(r=>r.trim()).map(r=>a[r.replace(/day$/,"")]).filter(r=>r!==void 0),rawString:n}}return t==="weekdays"?{type:"weekly",daysOfWeek:[1,2,3,4,5],rawString:n}:t==="weekends"?{type:"weekly",daysOfWeek:[0,6],rawString:n}:null}function nt(n,t=[]){let e={owner:null,dueDate:null,stage:null,project:null,priority:null,tags:[],recurrence:null,completedDate:null,createdDate:null},s=[...D,...t],a="|";if(n.includes(a)){let i=n.split(a).map(r=>r.trim()).filter(r=>r);for(let r of i){let o=r.match(k.DATE_WITH_PREFIX);if(o){let c=K(o[1]);c.isValid&&c.sanitizedValue&&(e.dueDate=c.sanitizedValue);continue}if(s.includes(r)){e.stage=r;continue}let l=r.toLowerCase();if(V.includes(l)){e.priority=l;continue}if(!e.owner){let c=z(r);if(c.isValid&&c.sanitizedValue){e.owner=c.sanitizedValue;continue}}if(!e.project){let c=Q(r);c.isValid&&c.sanitizedValue&&(e.project=c.sanitizedValue)}}}else k.DATE.test(n)?e.dueDate=n:s.includes(n)?e.stage=n:V.includes(n.toLowerCase())?e.priority=n.toLowerCase():e.owner=n;return e}function ot(n){let t=n,e={tags:[]},s=t.match(k.COMPLETED_DATE);s&&(e.completedDate=s[1],t=t.replace(k.COMPLETED_DATE,"").trim());let a=t.match(k.CREATED_DATE);a&&(e.createdDate=a[1],t=t.replace(k.CREATED_DATE,"").trim());let i=t.match(k.PRIORITY);i&&(e.priority=i[1].toLowerCase(),t=t.replace(k.PRIORITY,"").trim());let r=t.match(k.RECURRENCE);r&&(e.recurrence=rt(r[1]),t=t.replace(k.RECURRENCE,"").trim());let o=t.matchAll(k.TAGS);for(let l of o)l[1]&&e.tags.push(l[1].toLowerCase());return t=t.replace(k.TAGS,"").trim(),t=t.replace(/\s+/g," ").trim(),{cleanText:t,metadata:e}}function lt(n,t,e,s=[]){var y,f,R,I,me,Te,ye,ke,ve,we,De,Ee,Se,xe;let a=n.match(k.TASK_LINE);if(!a)return null;let i=(y=a[1])!=null?y:"",r=((f=a[2])==null?void 0:f.toLowerCase())==="x",o=(R=a[3])!=null?R:"",{cleanText:l,metadata:c}=ot(o);o=l;let d={owner:null,dueDate:null,stage:null,project:null,priority:(I=c.priority)!=null?I:null,tags:(me=c.tags)!=null?me:[],recurrence:(Te=c.recurrence)!=null?Te:null,completedDate:(ye=c.completedDate)!=null?ye:null,createdDate:(ke=c.createdDate)!=null?ke:null},u=o,g=o.match(k.METADATA);if(g){let Ke=g[1].trim();u=(we=(ve=g[2])==null?void 0:ve.trim())!=null?we:"";let L=nt(Ke,s);d={...d,...L,priority:(De=d.priority)!=null?De:L.priority,tags:[...new Set([...d.tags,...L.tags])],recurrence:(Ee=d.recurrence)!=null?Ee:L.recurrence,completedDate:(Se=d.completedDate)!=null?Se:L.completedDate,createdDate:(xe=d.createdDate)!=null?xe:L.createdDate}}return{id:`${t.path}:${e}`,file:t,lineNumber:e,text:u,completed:r,dueDate:d.dueDate,owner:d.owner,stage:d.stage,project:d.project,completedDate:d.completedDate,rawLine:n,priority:d.priority,tags:d.tags,recurrence:d.recurrence,parentId:null,children:[],depth:Fe(i),indent:i,createdDate:d.createdDate}}async function ue(n,t,e){let s=[];try{let i=(await n.vault.read(t)).split(`
`);for(let r=0;r<i.length;r++){let o=i[r],l=lt(o,t,r,e.customStages);l&&s.push(l)}}catch(a){console.error(`Error parsing tasks from ${t.path}:`,a)}return s}function _e(n){let t=[...n].sort((a,i)=>a.file.path!==i.file.path?a.file.path.localeCompare(i.file.path):a.lineNumber-i.lineNumber),e=[],s=[];for(let a of t){for(a.children=[],a.parentId=null;s.length>0&&(s[s.length-1].file.path!==a.file.path||s[s.length-1].depth>=a.depth);)s.pop();if(s.length>0&&a.depth>0){let i=s[s.length-1];a.parentId=i.id,i.children.push(a)}else e.push(a);s.push(a)}return e}function h(n){let t=n.getFullYear(),e=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${t}-${e}-${s}`}function j(n){let t=n.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let[,e,s,a]=t,i=parseInt(e,10),r=parseInt(s,10)-1,o=parseInt(a,10),l=new Date(i,r,o);return l.getFullYear()!==i||l.getMonth()!==r||l.getDate()!==o?null:l}function S(){let n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate())}function v(n,t){let e=new Date(n);return e.setDate(e.getDate()+t),e}function X(n,t){return v(n,t*7)}function J(n,t){let e=new Date(n);return e.setMonth(e.getMonth()+t),e}function he(n,t){let e=new Date(n);return e.setFullYear(e.getFullYear()+t),e}function pe(n,t=S()){let e=new Date(t),s=e.getDay(),a=(n-s+7)%7||7;return e.setDate(e.getDate()+a),e}function He(n,t=0){let e=new Date(n),s=e.getDay(),a=(s<t?7:0)+s-t;return e.setDate(e.getDate()-a),e}function Ue(n,t=0){let e=He(n,t);return v(e,6)}function ct(n){return new Date(n.getFullYear(),n.getMonth()+1,0)}function Ye(n){let t=S();return n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()}function dt(n){return n<S()}function E(n){if(!n)return!1;let t=j(n);return t?dt(t)&&!Ye(t):!1}function $(n){if(!n)return!1;let t=j(n);return t?Ye(t):!1}function ge(n,t=0){if(!n)return!1;let e=j(n);if(!e)return!1;let s=S(),a=He(s,t),i=Ue(s,t);return e>=a&&e<=i}function fe(n){let t=n.toLowerCase().trim(),e=S();if(/^\d{4}-\d{2}-\d{2}$/.test(t)){let r=j(t);return r?h(r):null}let s=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(s){let[,r,o,l]=s,c=new Date(parseInt(l,10),parseInt(r,10)-1,parseInt(o,10));if(!isNaN(c.getTime()))return h(c)}let a=t.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(a){let[,r,o,l]=a,c=new Date(parseInt(l,10),parseInt(o,10)-1,parseInt(r,10));if(!isNaN(c.getTime()))return h(c)}if(t==="today")return h(e);if(t==="tomorrow")return h(v(e,1));if(t==="yesterday")return h(v(e,-1));let i=t.match(/^in\s+(\d+)\s+(day|days|week|weeks|month|months|year|years)$/);if(i){let r=parseInt(i[1],10),o=i[2];if(o.startsWith("day"))return h(v(e,r));if(o.startsWith("week"))return h(X(e,r));if(o.startsWith("month"))return h(J(e,r));if(o.startsWith("year"))return h(he(e,r))}for(let r=0;r<W.length;r++){let o=W[r],l=Re[r];if(t===o||t===l)return h(pe(r,e));if(t===`next ${o}`||t===`next ${l}`)return h(pe(r,v(e,7)));if(t===`this ${o}`||t===`this ${l}`){let c=pe(r,e);return e.getDay()===r?h(e):h(c)}}if(t==="next week")return h(X(e,1));if(t==="next month")return h(J(e,1));if(t==="end of week"||t==="eow")return h(Ue(e));if(t==="end of month"||t==="eom")return h(ct(e));if(t==="weekday"||t==="next weekday"){let r=v(e,1);for(;r.getDay()===0||r.getDay()===6;)r=v(r,1);return h(r)}for(let r=0;r<oe.length;r++){let o=oe[r],l=Ne[r],c=t.match(new RegExp(`^(${o}|${l})\\s+(\\d{1,2})(?:\\s+(\\d{4}))?$`));if(c){let d=parseInt(c[2],10),u=c[3]?parseInt(c[3],10):e.getFullYear(),g=new Date(u,r,d);if(!c[3]&&g<e&&g.setFullYear(g.getFullYear()+1),!isNaN(g.getTime()))return h(g)}}return null}function ut(n,t="YYYY-MM-DD"){if(!n)return"";let e=j(n);if(!e)return n;switch(t){case"MM/DD/YYYY":return`${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")}/${e.getFullYear()}`;case"DD-MM-YYYY":return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${e.getFullYear()}`;case"locale":return e.toLocaleDateString();case"YYYY-MM-DD":default:return n}}function _(n){if(!n)return"";let t=j(n);if(!t)return n;let e=S(),s=t.getTime()-e.getTime(),a=Math.round(s/(1e3*60*60*24));if(a===0)return"Today";if(a===1)return"Tomorrow";if(a===-1)return"Yesterday";if(a>1&&a<=7){let i=W[t.getDay()];return i.charAt(0).toUpperCase()+i.slice(1)}return a<-1&&a>=-7?`${Math.abs(a)} days ago`:a>7&&a<=14?"Next week":ut(n)}var Z=class{constructor(t,e){this.cache=new Map;this.allTasks=[];this.isInitialized=!1;this.stats={totalFiles:0,cachedFiles:0,totalTasks:0,completedTasks:0,incompleteTasks:0,hits:0,misses:0,lastRefresh:0};this.app=t,this.settings=e}updateSettings(t){this.settings=t}async initialize(){await this.refreshAll(),this.isInitialized=!0}get initialized(){return this.isInitialized}getAllTasks(){return this.allTasks}getCacheStats(){let t=0,e=0;for(let s of this.allTasks)s.completed?t++:e++;return{...this.stats,completedTasks:t,incompleteTasks:e}}async refreshFile(t){if(!this.shouldParseFile(t)){this.cache.delete(t.path),this.rebuildAllTasks();return}let e={tasks:await ue(this.app,t,this.settings),lastModified:t.stat.mtime};this.cache.set(t.path,e),this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size}removeFile(t){this.cache.delete(t),this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size}renameFile(t,e){let s=this.cache.get(t);s&&(this.cache.delete(t),this.cache.set(e,s))}async refreshAll(){this.cache.clear();let t=this.app.vault.getMarkdownFiles();this.stats.totalFiles=t.length;for(let e of t){if(!this.shouldParseFile(e))continue;let s=this.cache.get(e.path);if(s&&s.lastModified===e.stat.mtime){this.stats.hits++;continue}this.stats.misses++;let a={tasks:await ue(this.app,e,this.settings),lastModified:e.stat.mtime};this.cache.set(e.path,a)}this.rebuildAllTasks(),this.stats.cachedFiles=this.cache.size,this.stats.lastRefresh=Date.now()}shouldParseFile(t){var s,a;if(!t.path.endsWith(".md"))return!1;let e=(a=(s=t.parent)==null?void 0:s.path)!=null?a:"";for(let i of this.settings.excludedFolders)if(e===i||e.startsWith(`${i}/`))return!1;for(let i of this.settings.excludedPatterns)if(this.matchGlob(t.path,i))return!1;return!0}matchGlob(t,e){let s=e.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${s}$`).test(t)}rebuildAllTasks(){let t=[];for(let e of this.cache.values())t.push(...e.tasks);this.allTasks=_e(t),this.stats.totalTasks=this.allTasks.length}getTasksForFile(t){var s;let e=this.cache.get(t);return(s=e==null?void 0:e.tasks)!=null?s:[]}getFilteredTasks(t){let e=[...this.allTasks];t.showCompleted===!1?e=e.filter(a=>!a.completed):t.completed!==void 0&&(e=e.filter(a=>a.completed===t.completed)),t.owner&&(e=e.filter(a=>a.owner===t.owner)),t.project&&(e=e.filter(a=>a.project===t.project)),t.stage&&(e=e.filter(a=>a.stage===t.stage)),t.priority&&(e=e.filter(a=>a.priority===t.priority)),t.tags&&t.tags.length>0&&(e=e.filter(a=>t.tags.every(i=>a.tags.includes(i)))),t.filePath&&(e=e.filter(a=>a.file.path.includes(t.filePath)));let s=t.searchText||t.search;if(s){let a=Le(s),i=new RegExp(a,"i");e=e.filter(r=>i.test(r.text)||r.owner&&i.test(r.owner)||r.project&&i.test(r.project))}if(t.dueDateFilter)switch(t.dueDateFilter){case"today":e=e.filter(a=>$(a.dueDate));break;case"thisWeek":e=e.filter(a=>ge(a.dueDate,this.settings.firstDayOfWeek));break;case"overdue":e=e.filter(a=>E(a.dueDate));break;case"noDueDate":e=e.filter(a=>!a.dueDate);break}return t.dueDateRange&&(e=e.filter(a=>a.dueDate?a.dueDate>=t.dueDateRange.start&&a.dueDate<=t.dueDateRange.end:!1)),t.dueDate&&(e=e.filter(a=>a.dueDate===t.dueDate)),e}clear(){this.cache.clear(),this.allTasks=[],this.stats={totalFiles:0,cachedFiles:0,totalTasks:0,completedTasks:0,incompleteTasks:0,hits:0,misses:0,lastRefresh:0},this.isInitialized=!1}getTaskStats(){var s,a;let t=this.allTasks,e={total:t.length,completed:0,active:0,overdue:0,dueToday:0,dueThisWeek:0,byStage:{Requested:0,Staged:0,"In-Progress":0,"In-Review":0,Completed:0,unassigned:0},byOwner:{},byProject:{},byPriority:{high:0,medium:0,low:0}};for(let i of t)i.completed?e.completed++:(e.active++,E(i.dueDate)&&e.overdue++,$(i.dueDate)&&e.dueToday++,ge(i.dueDate,this.settings.firstDayOfWeek)&&e.dueThisWeek++),i.stage&&D.includes(i.stage)?e.byStage[i.stage]++:e.byStage.unassigned++,i.owner&&(e.byOwner[i.owner]=((s=e.byOwner[i.owner])!=null?s:0)+1),i.project&&(e.byProject[i.project]=((a=e.byProject[i.project])!=null?a:0)+1),i.priority&&e.byPriority[i.priority]++;return e}getUniqueOwners(){let t=new Set;for(let e of this.allTasks)e.owner&&t.add(e.owner);return[...t].sort()}getUniqueProjects(){let t=new Set;for(let e of this.allTasks)e.project&&t.add(e.project);return[...t].sort()}getUniqueDueDates(){let t=new Set;for(let e of this.allTasks)e.dueDate&&t.add(e.dueDate);return[...t].sort()}getUniqueTags(){let t=new Set;for(let e of this.allTasks)for(let s of e.tags)t.add(s);return[...t].sort()}};var M=require("obsidian");var ee=class{constructor(t,e){this.undoStack=[];this.maxUndoEntries=50;this.app=t,this.settings=e}updateSettings(t){this.settings=t}async toggleTask(t){let e=!t.completed;return this.updateTask(t,{completed:e,stage:e?"Completed":t.stage==="Completed"?null:t.stage})}async updateTask(t,e){var s,a,i;try{let r=this.app.vault.getAbstractFileByPath(t.file.path);if(!r||!(r instanceof M.TFile))return{success:!1,error:"File not found"};let l=(await this.app.vault.read(r)).split(`
`),c=$e(t.lineNumber,l.length);if(!c.isValid)return{success:!1,error:c.error};let d=l[t.lineNumber];if(d!==t.rawLine)return{success:!1,error:"Task has been modified. Please refresh and try again."};let u=this.buildUpdatedLine(t,e);this.pushUndo({filePath:t.file.path,lineNumber:t.lineNumber,originalLine:d,newLine:u,timestamp:Date.now()}),l[t.lineNumber]=u;let g=l.join(`
`);return await this.app.vault.modify(r,g),e.completed&&t.recurrence&&!t.completed&&await this.createNextRecurrence(t),{success:!0,task:{...t,rawLine:u,completed:(s=e.completed)!=null?s:t.completed,text:(a=e.text)!=null?a:t.text,owner:e.owner!==void 0?e.owner:t.owner,dueDate:e.dueDate!==void 0?e.dueDate:t.dueDate,stage:e.stage!==void 0?e.stage:t.stage,project:e.project!==void 0?e.project:t.project,priority:e.priority!==void 0?e.priority:t.priority,tags:(i=e.tags)!=null?i:t.tags}}}catch(r){let o=r instanceof Error?r.message:"Unknown error";return console.error("Error updating task:",r),{success:!1,error:o}}}buildUpdatedLine(t,e){var f,R;let s=(f=e.completed)!=null?f:t.completed,a=s?"x":" ",i=e.owner!==void 0?le(e.owner):t.owner,r=e.dueDate!==void 0?e.dueDate:t.dueDate,o=e.stage!==void 0?e.stage:t.stage,l=e.project!==void 0?ce(e.project):t.project,c=e.priority!==void 0?e.priority:t.priority,d=e.text!==void 0?de(e.text):t.text,u=e.tags!==void 0?e.tags:t.tags,g=[];i&&g.push(i),r&&g.push(r),o&&g.push(o),l&&g.push(l);let y=d;if(g.length>0&&(y=`**${g.join(" | ")}:** ${d}`),c&&(y+=` [priority:${c}]`),t.recurrence&&(y+=` [repeat:${(R=t.recurrence.rawString)!=null?R:t.recurrence.type}]`),u.length>0&&(y+=" "+u.map(I=>`#${I}`).join(" ")),s&&!t.completed){let I=h(S());y+=` [done:${I}]`}else t.completedDate&&s&&(y+=` [done:${t.completedDate}]`);return t.createdDate&&(y+=` [created:${t.createdDate}]`),`${t.indent}- [${a}] ${y}`}async createTask(t,e,s={}){var a;try{let i=q(e);if(!i.isValid)return{success:!1,error:i.error};if(s.owner){let f=z(s.owner);if(!f.isValid)return{success:!1,error:f.error}}if(s.dueDate){let f=K(s.dueDate);if(!f.isValid)return{success:!1,error:f.error}}if(s.project){let f=Q(s.project);if(!f.isValid)return{success:!1,error:f.error}}if(s.stage){let f=je(s.stage,this.settings.customStages);if(!f.isValid)return{success:!1,error:f.error}}let r=[];s.owner&&r.push(le(s.owner)),s.dueDate&&r.push(s.dueDate),s.stage&&r.push(s.stage),s.project&&r.push(ce(s.project));let o=de(e);r.length>0&&(o=`**${r.join(" | ")}:** ${o}`),s.priority&&(o+=` [priority:${s.priority}]`),s.tags&&s.tags.length>0&&(o+=" "+s.tags.map(f=>`#${f}`).join(" "));let l=h(S());o+=` [created:${l}]`;let c=`- [ ] ${o}`,u=(await this.app.vault.read(t)).split(`
`),g=(a=s.atLine)!=null?a:u.length;u.splice(g,0,c);let y=u.join(`
`);return await this.app.vault.modify(t,y),new M.Notice("Task created"),{success:!0}}catch(i){let r=i instanceof Error?i.message:"Unknown error";return console.error("Error creating task:",i),{success:!1,error:r}}}async deleteTask(t){try{let s=(await this.app.vault.read(t.file)).split(`
`);if(s[t.lineNumber]!==t.rawLine)return{success:!1,error:"Task has been modified. Please refresh and try again."};this.pushUndo({filePath:t.file.path,lineNumber:t.lineNumber,originalLine:t.rawLine,newLine:"",timestamp:Date.now()}),s.splice(t.lineNumber,1);let a=s.join(`
`);return await this.app.vault.modify(t.file,a),{success:!0}}catch(e){let s=e instanceof Error?e.message:"Unknown error";return console.error("Error deleting task:",e),{success:!1,error:s}}}async createNextRecurrence(t){var s,a,i;if(!t.recurrence||!this.settings.recurringAutoCreate)return;let e=this.calculateNextDueDate(t.dueDate,t.recurrence);e&&(t.recurrence.endDate&&e>t.recurrence.endDate||(await this.createTask(t.file,t.text,{owner:(s=t.owner)!=null?s:void 0,dueDate:e,project:(a=t.project)!=null?a:void 0,stage:"Requested",priority:(i=t.priority)!=null?i:void 0,tags:t.tags}),new M.Notice("Created next occurrence for recurring task")))}calculateNextDueDate(t,e){var i;let s=t?new Date(t):S(),a=(i=e.interval)!=null?i:1;switch(e.type){case"daily":return h(v(s,a));case"weekly":if(e.daysOfWeek&&e.daysOfWeek.length>0){let r=s.getDay(),o=[...e.daysOfWeek].sort((d,u)=>d-u),l=o.find(d=>d>r);if(l!==void 0){let d=l-r;return h(v(s,d))}l=o[0];let c=7-r+l;return h(v(s,c))}return h(X(s,a));case"monthly":return h(J(s,a));case"yearly":return h(he(s,a));case"custom":return h(v(s,a));default:return null}}pushUndo(t){this.undoStack.push(t),this.undoStack.length>this.maxUndoEntries&&this.undoStack.shift()}async undo(){let t=this.undoStack.pop();if(!t)return{success:!1,error:"Nothing to undo"};try{let e=this.app.vault.getAbstractFileByPath(t.filePath);if(!e||!(e instanceof M.TFile))return{success:!1,error:"File not found"};let a=(await this.app.vault.read(e)).split(`
`);t.newLine===""?a.splice(t.lineNumber,0,t.originalLine):a[t.lineNumber]=t.originalLine;let i=a.join(`
`);return await this.app.vault.modify(e,i),new M.Notice("Undo successful"),{success:!0}}catch(e){let s=e instanceof Error?e.message:"Unknown error";return console.error("Error undoing:",e),{success:!1,error:s}}}canUndo(){return this.undoStack.length>0}clearUndoStack(){this.undoStack=[]}async updateTaskStage(t,e){let s={stage:e};return e==="Completed"?s.completed=!0:t.completed&&(s.completed=!1),this.updateTask(t,s)}async bulkUpdate(t,e){let s={successful:0,failed:0,errors:[]};for(let a of t){let i=await this.updateTask(a,e);i.success?s.successful++:(s.failed++,i.error&&s.errors.push(`${a.text}: ${i.error}`))}return s}async bulkDelete(t){let e={successful:0,failed:0,errors:[]},s=[...t].sort((a,i)=>a.file.path!==i.file.path?a.file.path.localeCompare(i.file.path):i.lineNumber-a.lineNumber);for(let a of s){let i=await this.deleteTask(a);i.success?e.successful++:(e.failed++,i.error&&e.errors.push(`${a.text}: ${i.error}`))}return e}};var x=require("obsidian");var te=class{constructor(t,e={}){this.focusedIndex=-1;var s;this.container=t,this.itemSelector=(s=e.itemSelector)!=null?s:".task-item",this.onSelect=e.onSelect,this.onActivate=e.onActivate,this.setupKeyboardNavigation()}getItems(){return Array.from(this.container.querySelectorAll(this.itemSelector))}setupKeyboardNavigation(){this.container.addEventListener("keydown",t=>this.handleKeyDown(t)),this.container.hasAttribute("tabindex")||this.container.setAttribute("tabindex","0"),this.container.setAttribute("role","listbox"),this.container.setAttribute("aria-label","Task list")}handleKeyDown(t){var s,a;let e=this.getItems();if(e.length!==0)switch(t.key){case w.ARROW_DOWN:t.preventDefault(),this.focusNext(e);break;case w.ARROW_UP:t.preventDefault(),this.focusPrevious(e);break;case w.HOME:t.preventDefault(),this.focusFirst(e);break;case w.END:t.preventDefault(),this.focusLast(e);break;case w.ENTER:this.focusedIndex>=0&&e[this.focusedIndex]&&(t.preventDefault(),(s=this.onActivate)==null||s.call(this,e[this.focusedIndex],this.focusedIndex));break;case w.SPACE:this.focusedIndex>=0&&e[this.focusedIndex]&&(t.preventDefault(),(a=this.onSelect)==null||a.call(this,e[this.focusedIndex],this.focusedIndex));break;case w.ESCAPE:t.preventDefault(),this.clearFocus(e);break}}focusNext(t){this.focusedIndex<t.length-1&&this.setFocus(t,this.focusedIndex+1)}focusPrevious(t){this.focusedIndex>0?this.setFocus(t,this.focusedIndex-1):this.focusedIndex===-1&&t.length>0&&this.setFocus(t,t.length-1)}focusFirst(t){t.length>0&&this.setFocus(t,0)}focusLast(t){t.length>0&&this.setFocus(t,t.length-1)}setFocus(t,e){if(this.focusedIndex>=0&&t[this.focusedIndex]){let a=t[this.focusedIndex];a.classList.remove("task-focused"),a.removeAttribute("aria-selected")}this.focusedIndex=e;let s=t[e];s&&(s.classList.add("task-focused"),s.setAttribute("aria-selected","true"),s.scrollIntoView({block:"nearest",behavior:"smooth"}),this.container.setAttribute("aria-activedescendant",s.id||`task-item-${e}`),s.id||(s.id=`task-item-${e}`))}clearFocus(t){if(this.focusedIndex>=0&&t[this.focusedIndex]){let e=t[this.focusedIndex];e.classList.remove("task-focused"),e.removeAttribute("aria-selected")}this.focusedIndex=-1,this.container.removeAttribute("aria-activedescendant")}destroy(){this.container.removeAttribute("role"),this.container.removeAttribute("aria-label"),this.container.removeAttribute("aria-activedescendant")}};function We(n,t="polite"){let e=document.createElement("div");e.setAttribute("role","status"),e.setAttribute("aria-live",t),e.setAttribute("aria-atomic","true"),e.classList.add("sr-only"),e.textContent=n,document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},1e3)}function Ge(){return[{shortcut:"\u2191/\u2193",description:"Navigate tasks"},{shortcut:"Home/End",description:"Jump to first/last task"},{shortcut:"Enter",description:"Open task in editor"},{shortcut:"Space",description:"Toggle task selection"},{shortcut:"Escape",description:"Clear selection"},{shortcut:"Ctrl+Shift+T",description:"Quick add task"},{shortcut:"/",description:"Focus search"},{shortcut:"?",description:"Show keyboard shortcuts"}]}var Be=require("obsidian");var se=class extends Be.Modal{constructor(t){super(t)}onOpen(){let{contentEl:t}=this;t.addClass("keyboard-help-modal"),t.createEl("h2",{text:"Keyboard Shortcuts"});let e=t.createEl("ul",{cls:"keyboard-help-list"}),s=Ge();for(let{shortcut:i,description:r}of s){let o=e.createEl("li",{cls:"keyboard-help-item"});o.createEl("kbd",{text:i,cls:"keyboard-help-key"}),o.createEl("span",{text:r,cls:"keyboard-help-description"})}let a=t.createEl("button",{text:"Close",cls:"mod-cta",attr:{"aria-label":"Close keyboard shortcuts help"}});a.style.marginTop="16px",a.addEventListener("click",()=>this.close())}onClose(){this.contentEl.empty()}};var H=class extends x.ItemView{constructor(e,s){super(e);this.filteredTasks=[];this.selectedTasks=new Set;this.keyboardHandler=null;this.taskListContainer=null;this.liveRegion=null;this.plugin=s,this.taskCache=s.taskCache,this.taskUpdater=s.taskUpdater}getViewType(){return P}getDisplayText(){return"Task Consolidator"}getIcon(){return"checkmark"}async onOpen(){this.containerEl.empty(),this.containerEl.addClass("task-consolidator-view"),this.liveRegion=this.containerEl.createDiv({cls:"sr-only",attr:{role:"status","aria-live":"polite","aria-atomic":"true"}}),this.setupGlobalKeyboardShortcuts(),await this.render()}async onClose(){this.selectedTasks.clear(),this.keyboardHandler&&(this.keyboardHandler.destroy(),this.keyboardHandler=null)}setupGlobalKeyboardShortcuts(){this.containerEl.addEventListener("keydown",e=>{var s;if(e.key===w.SLASH&&!this.isInputFocused()){e.preventDefault();let a=this.containerEl.querySelector(".task-search-input");a&&(a.focus(),this.announce("Search focused"))}if(e.key===w.QUESTION_MARK&&e.shiftKey&&!this.isInputFocused()&&(e.preventDefault(),this.showKeyboardHelp()),e.key===w.ESCAPE){let a=document.activeElement;(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)&&(a.blur(),(s=this.taskListContainer)==null||s.focus())}})}isInputFocused(){let e=document.activeElement;return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement}announce(e){this.liveRegion&&(this.liveRegion.textContent=e,setTimeout(()=>{this.liveRegion&&(this.liveRegion.textContent="")},1e3)),We(e)}showKeyboardHelp(){new se(this.app).open()}async refresh(){await this.render()}async render(){this.containerEl.empty(),this.renderHeader(),this.renderControls(),this.renderFilters(),this.applyFilters(),this.renderTaskSections()}renderHeader(){let s=this.containerEl.createDiv({cls:"task-consolidator-header"}).createDiv({cls:"task-header-title-row"});s.createEl("h4",{text:"All Tasks"});let a=this.taskCache.getTaskStats();s.createSpan({cls:"task-header-stats"}).setText(`${a.active} active, ${a.completed} completed`),a.overdue>0&&s.createSpan({cls:"task-header-overdue"}).setText(`${a.overdue} overdue`)}renderControls(){let e=this.containerEl.createDiv({cls:"task-consolidator-controls"});e.createSpan({text:"Sort: "});let s=e.createEl("select",{cls:"dropdown"});for(let i of U){let r=s.createEl("option",{text:O(i),value:i});i===this.plugin.settings.sortBy&&(r.selected=!0)}s.addEventListener("change",async()=>{this.plugin.settings.sortBy=s.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Group: "});let a=e.createEl("select",{cls:"dropdown"});for(let i of Y){let r=a.createEl("option",{text:O(i),value:i});i===this.plugin.settings.groupBy&&(r.selected=!0)}a.addEventListener("change",async()=>{this.plugin.settings.groupBy=a.value,await this.plugin.saveSettings(),await this.refresh()}),e.createEl("button",{text:"\u21BB Refresh",attr:{"aria-label":"Refresh tasks"}}).addEventListener("click",async()=>{await this.plugin.refreshTasks(),await this.refresh(),new x.Notice("Tasks refreshed")}),e.createEl("button",{text:"+ Add Task",cls:"task-add-btn",attr:{"aria-label":"Add new task"}}).addEventListener("click",()=>{this.plugin.openQuickAdd()}),e.createEl("button",{text:"Kanban",cls:"kanban-btn",attr:{"aria-label":"Open Kanban board"}}).addEventListener("click",()=>{this.plugin.openKanban()}),e.createEl("button",{text:"?",cls:"task-help-btn",attr:{"aria-label":"Show keyboard shortcuts"}}).addEventListener("click",()=>{this.showKeyboardHelp()})}renderFilters(){let e=this.containerEl.createDiv({cls:"task-consolidator-filters"}),a=e.createDiv({cls:"task-search-container"}).createEl("input",{type:"text",placeholder:"Search tasks...",cls:"task-search-input",value:this.plugin.settings.searchQuery});a.addEventListener("input",async()=>{this.plugin.settings.searchQuery=a.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Owner: "});let i=e.createEl("select",{cls:"dropdown"});i.createEl("option",{text:"All",value:""});for(let d of this.taskCache.getUniqueOwners()){let u=i.createEl("option",{text:d,value:d});d===this.plugin.settings.filterOwner&&(u.selected=!0)}i.addEventListener("change",async()=>{this.plugin.settings.filterOwner=i.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Project: "});let r=e.createEl("select",{cls:"dropdown"});r.createEl("option",{text:"All",value:""});for(let d of this.taskCache.getUniqueProjects()){let u=r.createEl("option",{text:d,value:d});d===this.plugin.settings.filterProject&&(u.selected=!0)}r.addEventListener("change",async()=>{this.plugin.settings.filterProject=r.value,await this.plugin.saveSettings(),await this.refresh()}),e.createSpan({text:"Stage: "});let o=e.createEl("select",{cls:"dropdown"});o.createEl("option",{text:"All",value:""});for(let d of D){let u=o.createEl("option",{text:d,value:d});d===this.plugin.settings.filterStage&&(u.selected=!0)}o.addEventListener("change",async()=>{this.plugin.settings.filterStage=o.value,await this.plugin.saveSettings(),await this.refresh()});let l=this.containerEl.createDiv({cls:"task-quick-filters"}),c=this.taskCache.getTaskStats();l.createEl("button",{text:`Today (${c.dueToday})`,cls:"quick-filter-btn"}).addEventListener("click",async()=>{this.plugin.settings.filterDueDate="today",await this.plugin.saveSettings(),await this.refresh()}),l.createEl("button",{text:`Overdue (${c.overdue})`,cls:"quick-filter-btn overdue"}).addEventListener("click",async()=>{this.plugin.settings.filterDueDate="overdue",await this.plugin.saveSettings(),await this.refresh()}),l.createEl("button",{text:"Clear Filters",cls:"quick-filter-btn clear"}).addEventListener("click",async()=>{this.plugin.settings.filterOwner="",this.plugin.settings.filterProject="",this.plugin.settings.filterStage="",this.plugin.settings.filterDueDate="",this.plugin.settings.searchQuery="",await this.plugin.saveSettings(),await this.refresh()})}applyFilters(){let e=this.taskCache.getAllTasks(),s=this.plugin.settings;if(s.searchQuery){let a=s.searchQuery.toLowerCase();e=e.filter(i=>{var r,o;return i.text.toLowerCase().includes(a)||((r=i.owner)==null?void 0:r.toLowerCase().includes(a))||((o=i.project)==null?void 0:o.toLowerCase().includes(a))||i.tags.some(l=>l.toLowerCase().includes(a))})}s.filterOwner&&(e=e.filter(a=>a.owner===s.filterOwner)),s.filterProject&&(e=e.filter(a=>a.project===s.filterProject)),s.filterStage&&(e=e.filter(a=>a.stage===s.filterStage)),s.filterDueDate==="today"?e=e.filter(a=>$(a.dueDate)):s.filterDueDate==="overdue"?e=e.filter(a=>E(a.dueDate)&&!a.completed):s.filterDueDate&&(e=e.filter(a=>a.dueDate===s.filterDueDate)),s.filterPriority&&(e=e.filter(a=>a.priority===s.filterPriority)),this.filteredTasks=e}renderTaskSections(){this.keyboardHandler&&(this.keyboardHandler.destroy(),this.keyboardHandler=null);let e=this.filteredTasks.filter(c=>!c.completed),s=this.filteredTasks.filter(c=>c.completed),a=this.sortTasks(e),i=this.sortTasks(s),r=this.containerEl.createDiv({cls:"task-section"});if(r.createEl("h5",{text:`Active Tasks (${a.length})`,attr:{id:"active-tasks-heading"}}),a.length===0)r.createEl("p",{text:"No active tasks found",cls:"task-empty"});else if(this.plugin.settings.groupBy!=="none"){let c=this.groupTasks(a);this.renderGroupedTasks(r,c,"active")}else{let c=r.createDiv({cls:"task-list",attr:{role:"listbox","aria-labelledby":"active-tasks-heading",tabindex:"0"}});this.taskListContainer=c;for(let d of a)this.renderTask(c,d);this.setupKeyboardNavigation(c)}let o=this.containerEl.createDiv({cls:"task-section"}),l=o.createDiv({cls:"task-section-header"});if(l.createEl("span",{text:this.plugin.settings.showCompleted?"\u25BC":"\u25B6",cls:"task-section-toggle"}),l.createEl("h5",{text:`Completed Tasks (${i.length})`,cls:"task-section-title"}),l.addEventListener("click",async()=>{this.plugin.settings.showCompleted=!this.plugin.settings.showCompleted,await this.plugin.saveSettings(),await this.refresh()}),this.plugin.settings.showCompleted&&i.length>0)if(this.plugin.settings.groupBy!=="none"){let c=this.groupTasks(i);this.renderGroupedTasks(o,c,"completed")}else{let c=o.createDiv({cls:"task-list"});for(let d of i)this.renderTask(c,d)}}sortTasks(e){let s=[...e],a=this.plugin.settings.sortBy;return s.sort((i,r)=>{var o,l;switch(a){case"dueDate":return F(i.dueDate,r.dueDate);case"owner":return!i.owner&&!r.owner?0:i.owner?r.owner?i.owner.localeCompare(r.owner):-1:1;case"priority":{let c={high:0,medium:1,low:2},d=i.priority?c[i.priority]:3,u=r.priority?c[r.priority]:3;return d-u}case"project":return!i.project&&!r.project?0:i.project?r.project?i.project.localeCompare(r.project):-1:1;case"created":return F(i.createdDate,r.createdDate);case"stage":{let c=D.reduce((g,y,f)=>({...g,[y]:f}),{}),d=i.stage&&(o=c[i.stage])!=null?o:99,u=r.stage&&(l=c[r.stage])!=null?l:99;return d-u}default:return 0}}),s}groupTasks(e){var i,r,o,l,c;let s=new Map,a=this.plugin.settings.groupBy;for(let d of e){let u;switch(a){case"dueDate":u=(i=d.dueDate)!=null?i:"No Date";break;case"owner":u=(r=d.owner)!=null?r:"No Owner";break;case"project":u=(o=d.project)!=null?o:"No Project";break;case"stage":u=(l=d.stage)!=null?l:"Unassigned";break;case"priority":u=(c=d.priority)!=null?c:"No Priority";break;default:u="All"}s.has(u)||s.set(u,[]),s.get(u).push(d)}return s}renderGroupedTasks(e,s,a){var r;let i=this.plugin.settings.groupBy;for(let[o,l]of s){let c=`${a}-${o}`,d=(r=this.plugin.settings.collapsedGroups[c])!=null?r:!1,u=e.createDiv({cls:"task-group"}),g=u.createDiv({cls:"task-group-header"});g.createEl("span",{text:d?"\u25B6":"\u25BC",cls:"task-group-toggle"});let y=Me[i];if(g.createEl("span",{text:`${y} ${o} (${l.length})`,cls:"task-group-title"}),g.addEventListener("click",async()=>{this.plugin.settings.collapsedGroups[c]=!d,await this.plugin.saveSettings(),await this.refresh()}),!d){let f=u.createDiv({cls:"task-list"});for(let R of l)this.renderTask(f,R)}}}renderTask(e,s){let a=e.createDiv({cls:"task-item",attr:{role:"option","aria-selected":"false",tabindex:"-1"}});E(s.dueDate)&&!s.completed&&a.addClass("overdue"),$(s.dueDate)&&!s.completed&&a.addClass("due-today"),s.priority&&a.addClass(`priority-${s.priority}`);let i=[s.text];if(s.priority&&i.push(`Priority: ${s.priority}`),s.dueDate){let d=_(s.dueDate);i.push(`Due: ${d}`),E(s.dueDate)&&!s.completed&&i.push("Overdue")}s.owner&&i.push(`Owner: ${s.owner}`),s.project&&i.push(`Project: ${s.project}`),a.setAttribute("aria-label",i.join(", "));let r=a.createEl("input",{type:"checkbox",attr:{"aria-label":`Toggle task: ${s.text}`}});r.checked=s.completed,r.addEventListener("change",async()=>{let d=await this.taskUpdater.toggleTask(s);d.success?(new x.Notice(s.completed?"Task unchecked":"Task checked"),await this.plugin.refreshTasks(),await this.refresh()):(new x.Notice(`Error: ${d.error}`),r.checked=s.completed)});let o=a.createDiv({cls:"task-content"}),l=o.createDiv({cls:"task-text"});l.setText(s.text),s.completed&&l.addClass("task-completed");let c=o.createDiv({cls:"task-metadata"});if(s.priority&&c.createSpan({text:`${G[s.priority]} ${s.priority}`,cls:`task-priority priority-${s.priority}`}),s.dueDate){let d=_(s.dueDate),u=c.createSpan({text:`\u{1F4C5} ${d}`,cls:"task-due-date"});E(s.dueDate)&&!s.completed&&u.addClass("overdue")}if(s.owner&&c.createSpan({text:`\u{1F464} ${s.owner}`,cls:"task-owner"}),s.project&&c.createSpan({text:`\u{1F4C1} ${s.project}`,cls:"task-project"}),s.stage&&c.createSpan({text:`\u{1F4CB} ${s.stage}`,cls:"task-stage"}),s.recurrence&&c.createSpan({text:"\u{1F504}",cls:"task-recurring",attr:{title:"Recurring task"}}),s.tags.length>0){let d=c.createDiv({cls:"task-tags"});for(let u of s.tags)d.createSpan({text:`#${u}`,cls:"task-tag"})}c.createEl("a",{text:`\u{1F4C4} ${s.file.basename}`,cls:"task-file-link",attr:{"aria-label":`Open ${s.file.name}`}}).addEventListener("click",async d=>{d.preventDefault(),await this.openTaskInEditor(s)})}async openTaskInEditor(e){await this.app.workspace.getLeaf(!1).openFile(e.file);let s=this.app.workspace.getActiveViewOfType(x.MarkdownView);if(s!=null&&s.editor){let a=s.editor;a.setCursor({line:e.lineNumber,ch:0}),a.scrollIntoView({from:{line:e.lineNumber,ch:0},to:{line:e.lineNumber,ch:0}},!0)}}setupKeyboardNavigation(e){this.keyboardHandler=new te(e,{itemSelector:".task-item",onSelect:async(s,a)=>{let i=this.filteredTasks.filter(r=>!r.completed)[a];if(i){let r=await this.taskUpdater.toggleTask(i);if(r.success){let o=i.completed?"unchecked":"checked";this.announce(`Task ${o}: ${i.text}`),new x.Notice(`Task ${o}`),await this.plugin.refreshTasks(),await this.refresh()}else new x.Notice(`Error: ${r.error}`)}},onActivate:async(s,a)=>{let i=this.filteredTasks.filter(r=>!r.completed)[a];i&&(this.announce(`Opening task: ${i.text}`),await this.openTaskInEditor(i))}})}};var b=require("obsidian");var ae=class extends b.Modal{constructor(t,e){super(t),this.plugin=e,this.taskCache=e.taskCache,this.taskUpdater=e.taskUpdater,this.settings=e.settings,this.filteredProject=this.settings.kanbanFilterProject}onOpen(){let{contentEl:t,modalEl:e}=this;e.addClass("kanban-modal"),t.addClass("kanban-modal-content"),this.renderHeader(t),this.renderBoard(t)}onClose(){let{contentEl:t}=this;t.empty()}renderHeader(t){let e=t.createDiv({cls:"kanban-header"});e.createEl("h2",{text:"Kanban Board"});let s=e.createDiv({cls:"kanban-filter"});s.createSpan({text:"Project: "});let a=s.createEl("select");a.createEl("option",{text:"All Projects",value:""});let i=this.taskCache.getUniqueProjects();for(let r of i){let o=a.createEl("option",{text:r,value:r});r===this.filteredProject&&(o.selected=!0)}a.addEventListener("change",async()=>{this.filteredProject=a.value,this.settings.kanbanFilterProject=this.filteredProject,await this.plugin.saveSettings(),this.refreshBoard()}),e.createEl("button",{text:"\u2715 Close",cls:"kanban-close-btn"}).addEventListener("click",()=>this.close())}renderBoard(t){let e=t.querySelector(".kanban-board");e&&e.remove();let s=t.createDiv({cls:"kanban-board"});for(let a of be)this.renderColumn(s,a)}renderColumn(t,e){var o;let s=t.createDiv({cls:"kanban-column"});s.dataset.stage=(o=e.stage)!=null?o:"unassigned";let a=this.getTasksForColumn(e);s.createDiv({cls:"kanban-column-header"}).createEl("h3",{text:`${e.title} (${a.length})`});let r=s.createDiv({cls:"kanban-column-body"});this.setupDropZone(r,e.stage);for(let l of a)this.renderTaskCard(r,l)}getTasksForColumn(t){let e=this.taskCache.getAllTasks();this.filteredProject&&(e=e.filter(a=>a.project===this.filteredProject));let s;return t.stage===null?s=e.filter(a=>!a.stage&&!a.completed):t.stage==="Completed"?s=e.filter(a=>a.completed||a.stage==="Completed"):s=e.filter(a=>a.stage===t.stage&&!a.completed),t.stage==="Completed"?s.sort((a,i)=>F(i.completedDate,a.completedDate)):s.sort((a,i)=>F(a.dueDate,i.dueDate)),s}renderTaskCard(t,e){let s=t.createDiv({cls:"kanban-card"});s.draggable=!0,s.dataset.filePath=e.file.path,s.dataset.lineNumber=String(e.lineNumber),E(e.dueDate)&&!e.completed&&s.addClass("overdue"),e.priority&&s.addClass(`priority-${e.priority}`),s.createDiv({cls:"kanban-card-title"}).setText(e.text);let a=s.createDiv({cls:"kanban-card-meta"});if(e.priority&&a.createSpan({cls:"kanban-card-priority",text:G[e.priority]}),e.owner&&a.createSpan({cls:"kanban-card-owner",text:`\u{1F464} ${e.owner}`}),e.dueDate){let i=_(e.dueDate),r=a.createSpan({cls:"kanban-card-date",text:`\u{1F4C5} ${i}`});E(e.dueDate)&&!e.completed&&r.addClass("overdue")}e.project&&a.createSpan({cls:"kanban-card-project",text:`\u{1F4C1} ${e.project}`}),e.recurrence&&a.createSpan({cls:"kanban-card-recurring",text:"\u{1F504}"}),a.createEl("a",{cls:"kanban-card-file",text:`\u{1F4C4} ${e.file.basename}`}).addEventListener("click",i=>{i.stopPropagation(),this.openTaskInEditor(e)}),this.setupDragEvents(s,e)}setupDragEvents(t,e){t.addEventListener("dragstart",s=>{var a;t.classList.add("dragging"),(a=s.dataTransfer)==null||a.setData("text/plain",JSON.stringify({filePath:e.file.path,lineNumber:e.lineNumber,taskId:e.id})),s.dataTransfer&&(s.dataTransfer.effectAllowed="move")}),t.addEventListener("dragend",()=>{t.classList.remove("dragging"),this.contentEl.querySelectorAll(".drag-over").forEach(s=>{s.classList.remove("drag-over")})})}setupDropZone(t,e){t.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer&&(s.dataTransfer.dropEffect="move"),t.classList.add("drag-over")}),t.addEventListener("dragleave",s=>{t.contains(s.relatedTarget)||t.classList.remove("drag-over")}),t.addEventListener("drop",async s=>{var a,i;s.preventDefault(),t.classList.remove("drag-over");try{let r=JSON.parse((i=(a=s.dataTransfer)==null?void 0:a.getData("text/plain"))!=null?i:"{}"),o=this.taskCache.getAllTasks().find(c=>c.id===r.taskId);if(!o){new b.Notice("Task not found");return}let l=await this.taskUpdater.updateTaskStage(o,e);l.success?(new b.Notice(`Task moved to ${e!=null?e:"Unassigned"}`),await this.plugin.refreshTasks(),this.refreshBoard()):new b.Notice(`Error: ${l.error}`)}catch(r){console.error("Error handling drop:",r),new b.Notice("Error moving task")}})}refreshBoard(){this.renderBoard(this.contentEl)}async openTaskInEditor(t){await this.app.workspace.getLeaf(!1).openFile(t.file);let e=this.app.workspace.getActiveViewOfType(b.MarkdownView);if(e!=null&&e.editor){let s=e.editor;s.setCursor({line:t.lineNumber,ch:0}),s.scrollIntoView({from:{line:t.lineNumber,ch:0},to:{line:t.lineNumber,ch:0}},!0)}this.close()}};var T=require("obsidian");var ie=class extends T.Modal{constructor(e,s){super(e);this.taskText="";this.selectedOwner="";this.selectedDueDate="";this.selectedProject="";this.selectedStage="";this.selectedPriority="";this.selectedTags=[];this.selectedFile=null;this.useQuickSyntax=!0;if(this.plugin=s,this.taskCache=s.taskCache,this.taskUpdater=s.taskUpdater,this.settings=s.settings,this.selectedOwner=this.settings.defaultOwner,this.selectedProject=this.settings.defaultProject,this.settings.defaultTargetFile){let a=this.app.vault.getAbstractFileByPath(this.settings.defaultTargetFile);a instanceof T.TFile&&(this.selectedFile=a)}}onOpen(){this.modalEl.addClass("quick-add-modal"),this.render()}onClose(){this.contentEl.empty()}render(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Quick Add Task"}),new T.Setting(e).setName("Quick Syntax Mode").setDesc("Use @owner, #project, !date, ^priority, +tag in the task text").addToggle(r=>r.setValue(this.useQuickSyntax).onChange(o=>{this.useQuickSyntax=o,this.render()}));let a=e.createDiv({cls:"quick-add-input-container"}).createEl("textarea",{cls:"quick-add-task-input",placeholder:this.useQuickSyntax?"Buy groceries @John !tomorrow #personal ^high +shopping":"Enter task description..."});if(a.value=this.taskText,a.addEventListener("input",()=>{this.taskText=a.value,this.useQuickSyntax&&(this.parseQuickSyntax(),this.updatePreview())}),setTimeout(()=>a.focus(),50),this.useQuickSyntax){let r=e.createDiv({cls:"quick-add-preview"});r.id="quick-add-preview",this.updatePreview()}this.useQuickSyntax||this.renderExpandedFields(e),new T.Setting(e).setName("Target File").setDesc("File where the task will be created").addDropdown(r=>{r.addOption("","Select a file...");let o=this.app.vault.getMarkdownFiles().sort((l,c)=>l.path.localeCompare(c.path));for(let l of o)r.addOption(l.path,l.path);this.selectedFile&&r.setValue(this.selectedFile.path),r.onChange(l=>{let c=this.app.vault.getAbstractFileByPath(l);this.selectedFile=c instanceof T.TFile?c:null})});let i=e.createDiv({cls:"quick-add-buttons"});i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),i.createEl("button",{text:"Create Task",cls:"mod-cta"}).addEventListener("click",()=>void this.createTask()),a.addEventListener("keydown",r=>{r.key==="Enter"&&(r.ctrlKey||r.metaKey)&&(r.preventDefault(),this.createTask())})}renderExpandedFields(e){new T.Setting(e).setName("Owner").addDropdown(s=>{s.addOption("","None");for(let a of this.taskCache.getUniqueOwners())s.addOption(a,a);s.setValue(this.selectedOwner),s.onChange(a=>this.selectedOwner=a)}).addText(s=>s.setPlaceholder("Or enter new...").onChange(a=>{a&&(this.selectedOwner=a)})),new T.Setting(e).setName("Due Date").addText(s=>s.setPlaceholder('YYYY-MM-DD or "tomorrow"').setValue(this.selectedDueDate).onChange(a=>{let i=fe(a);this.selectedDueDate=i!=null?i:a})),new T.Setting(e).setName("Project").addDropdown(s=>{s.addOption("","None");for(let a of this.taskCache.getUniqueProjects())s.addOption(a,a);s.setValue(this.selectedProject),s.onChange(a=>this.selectedProject=a)}).addText(s=>s.setPlaceholder("Or enter new...").onChange(a=>{a&&(this.selectedProject=a)})),new T.Setting(e).setName("Stage").addDropdown(s=>{s.addOption("","None");for(let a of D)s.addOption(a,a);s.setValue(this.selectedStage),s.onChange(a=>this.selectedStage=a)}),new T.Setting(e).setName("Priority").addDropdown(s=>{s.addOption("","None");for(let a of V)s.addOption(a,a.charAt(0).toUpperCase()+a.slice(1));s.setValue(this.selectedPriority),s.onChange(a=>this.selectedPriority=a)}),new T.Setting(e).setName("Tags").setDesc("Comma-separated tags").addText(s=>s.setPlaceholder("tag1, tag2, tag3").setValue(this.selectedTags.join(", ")).onChange(a=>{this.selectedTags=a.split(",").map(i=>i.trim().replace(/^#/,"")).filter(i=>i.length>0)}))}parseQuickSyntax(){let e=this.taskText,s=e.match(m.OWNER);s&&(this.selectedOwner=s[1].trim(),e=e.replace(m.OWNER,""));let a=e.match(m.PROJECT);a&&(this.selectedProject=a[1],e=e.replace(m.PROJECT,""));let i=e.match(m.DATE);if(i){let l=fe(i[1]);this.selectedDueDate=l!=null?l:"",e=e.replace(m.DATE,"")}let r=e.match(m.PRIORITY);if(r){let l=r[1].toLowerCase();l==="h"||l==="high"?this.selectedPriority="high":l==="m"||l==="med"||l==="medium"?this.selectedPriority="medium":(l==="l"||l==="low")&&(this.selectedPriority="low"),e=e.replace(m.PRIORITY,"")}let o=[...e.matchAll(m.TAG)];this.selectedTags=o.map(l=>l[1].toLowerCase()),e=e.replace(m.TAG,""),this.taskText=e.replace(/\s+/g," ").trim()}updatePreview(){let e=document.getElementById("quick-add-preview");if(!e)return;e.empty(),e.createEl("strong",{text:"Preview: "});let s=[],a=this.taskText;if(a=a.replace(m.OWNER,""),a=a.replace(m.PROJECT,""),a=a.replace(m.DATE,""),a=a.replace(m.PRIORITY,""),a=a.replace(m.TAG,""),a=a.replace(/\s+/g," ").trim(),a&&s.push(`"${a}"`),this.selectedOwner&&s.push(`\u{1F464} ${this.selectedOwner}`),this.selectedDueDate&&s.push(`\u{1F4C5} ${this.selectedDueDate}`),this.selectedProject&&s.push(`\u{1F4C1} ${this.selectedProject}`),this.selectedPriority){let i={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"};s.push(`${i[this.selectedPriority]} ${this.selectedPriority}`)}this.selectedTags.length>0&&s.push(`\u{1F3F7}\uFE0F ${this.selectedTags.map(i=>`#${i}`).join(" ")}`),e.createSpan({text:s.join(" | ")||"Enter task text..."})}async createTask(){var i;if(!this.selectedFile){new T.Notice("Please select a target file");return}let e=this.taskText;this.useQuickSyntax&&(e=e.replace(m.OWNER,""),e=e.replace(m.PROJECT,""),e=e.replace(m.DATE,""),e=e.replace(m.PRIORITY,""),e=e.replace(m.TAG,""),e=e.replace(/\s+/g," ").trim());let s=q(e);if(!s.isValid){new T.Notice((i=s.error)!=null?i:"Invalid task text");return}let a=await this.taskUpdater.createTask(this.selectedFile,e,{owner:this.selectedOwner||void 0,dueDate:this.selectedDueDate||void 0,project:this.selectedProject||void 0,stage:this.selectedStage||void 0,priority:this.selectedPriority||void 0,tags:this.selectedTags.length>0?this.selectedTags:void 0});a.success?(new T.Notice("Task created successfully"),await this.plugin.refreshTasks(),this.close()):new T.Notice(`Error: ${a.error}`)}};var re=class extends C.Plugin{constructor(){super(...arguments);this.fileWatcherRegistered=!1;this.debouncedRefresh=(0,C.debounce)(async()=>{await this.refreshTasks(),await this.refreshView()},300,!0)}async onload(){await this.loadSettings(),this.taskCache=new Z(this.app,this.settings),this.taskUpdater=new ee(this.app,this.settings),this.registerView(P,e=>new H(e,this)),this.addRibbonIcon("checkmark","Task Consolidator",()=>{this.activateView()}),this.addCommand({id:"open-task-consolidator",name:"Open Task Consolidator",callback:()=>{this.activateView()}}),this.addCommand({id:"open-kanban-board",name:"Open Kanban Board",callback:()=>{this.openKanban()}}),this.addCommand({id:"quick-add-task",name:"Quick Add Task",callback:()=>{this.openQuickAdd()}}),this.addCommand({id:"refresh-tasks",name:"Refresh All Tasks",callback:()=>{this.refreshTasks()}}),this.addSettingTab(new B(this.app,this)),await this.taskCache.initialize(),this.setupFileWatchers(),this.settings.debugMode&&(console.log("Task Consolidator loaded"),console.log("Cache stats:",this.taskCache.getCacheStats()))}onunload(){this.app.workspace.detachLeavesOfType(P),this.taskCache.clear(),this.settings.debugMode&&console.log("Task Consolidator unloaded")}async loadSettings(){let e=await this.loadData();this.settings=Ie(e!=null?e:{})}async saveSettings(){await this.saveData(this.settings),this.taskCache.updateSettings(this.settings),this.taskUpdater.updateSettings(this.settings),this.debouncedRefresh=(0,C.debounce)(async()=>{await this.refreshTasks(),await this.refreshView()},this.settings.refreshDebounceMs,!0)}async activateView(){let{workspace:e}=this.app,s=e.getLeavesOfType(P)[0];if(!s){let a=e.getRightLeaf(!1);a&&(await a.setViewState({type:P,active:!0}),s=a)}s&&e.revealLeaf(s)}openKanban(){new ae(this.app,this).open()}openQuickAdd(){new ie(this.app,this).open()}async refreshTasks(){await this.taskCache.refreshAll(),this.settings.debugMode&&console.log("Tasks refreshed:",this.taskCache.getCacheStats())}async refreshView(){let e=this.app.workspace.getLeavesOfType(P);for(let s of e){let a=s.view;a instanceof H&&await a.refresh()}}setupFileWatchers(){this.fileWatcherRegistered||!this.settings.autoRefresh||(this.registerEvent(this.app.vault.on("modify",e=>{e instanceof C.TFile&&e.extension==="md"&&(this.taskCache.refreshFile(e),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("create",e=>{e instanceof C.TFile&&e.extension==="md"&&(this.taskCache.refreshFile(e),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof C.TFile&&e.extension==="md"&&(this.taskCache.removeFile(e.path),this.debouncedRefresh())})),this.registerEvent(this.app.vault.on("rename",(e,s)=>{e instanceof C.TFile&&e.extension==="md"&&(this.taskCache.renameFile(s,e.path),this.debouncedRefresh())})),this.fileWatcherRegistered=!0,this.settings.debugMode&&console.log("File watchers registered"))}};
